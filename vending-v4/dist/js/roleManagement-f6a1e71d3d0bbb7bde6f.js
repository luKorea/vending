/*! 版权所有，翻版必究 */!function(c){function e(e){for(var n,t,o=e[0],i=e[1],a=e[2],s=0,r=[];s<o.length;s++)t=o[s],Object.prototype.hasOwnProperty.call(u,t)&&u[t]&&r.push(u[t][0]),u[t]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(c[n]=i[n]);for(d&&d(e);r.length;)r.shift()();return p.push.apply(p,a||[]),l()}function l(){for(var e,n=0;n<p.length;n++){for(var t=p[n],o=!0,i=1;i<t.length;i++){var a=t[i];0!==u[a]&&(o=!1)}o&&(p.splice(n--,1),e=s(s.s=t[0]))}return e}var t={},u={29:0},p=[];function s(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return c[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=c,s.c=t,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)s.d(t,o,function(e){return n[e]}.bind(null,o));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="";var n=window.webpackJsonp=window.webpackJsonp||[],o=n.push.bind(n);n.push=e,n=n.slice();for(var i=0;i<n.length;i++)e(n[i]);var d=o;p.push([135,0]),l()}({135:function(e,n,t){"use strict";t.r(n);n=t(384);layui.use(["table","form","layer","tree","util"],function(){var a=layui.form,s=layui.jquery,e=layui.table,t=layui.layer,t=layui.layer,r=(layui.util,layui.tree,sessionStorage.token),c=e.render({elem:"#tableTest",url:"".concat(vApi,"/role/findRole"),method:"post",contentType:"application/json",headers:{token:r},cols:[[{field:"name",width:180,title:"角色名",align:"center"},{field:"addUser",width:150,title:"添加人",align:"center"},{field:"addTime",width:200,title:"添加时间",align:"center"},{field:"lastUser",width:180,title:"最后修改人",align:"center"},{field:"lastTime",width:200,title:"最后修改时间",align:"center"},{field:"operation",position:"absolute",align:"center",right:0,width:200,title:"操作",toolbar:"#barDemo"}]],id:"tableId",page:!0,loading:!0,limits:[10,20,50],request:{pageName:"pageNum",limitName:"pageSize"},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code?window.parent.location.href="login.html":405==e.code&&s(".hangContent").show()}});s(".playHeader .close").click(function(){s(this).parent().parent().addClass("margin0"),s(this).parents(".maskContnet").fadeOut()});var n=null,o=[],i=[],l=[],u=[],p=[],d=[],f=[],m=[],h=[],g=null;function y(o,i,e){var t='<div>\n        <input type="checkbox" lay-filter="permissionsAll" name="'.concat(i,'" title="全选"\n            lay-skin="primary"  value="" >\n         </div>');o.forEach(function(e,n){t+='<div>\n                            <input type="checkbox" lay-filter="permissions" name="'.concat(e.id,'" title="').concat(e.name,'"\n                                lay-skin="primary"  value="').concat(e.id,'" >\n                        </div>')}),s(".".concat(i)).empty(),s(".".concat(i)).html(t),e.permissions.forEach(function(e,n){for(var t=1;t<s(".".concat(i," input")).length;t++)e.id==o[t-1].id&&s(".".concat(i," input")).eq(t).prop("checked",!0)}),a.render("checkbox")}e.on("tool(test)",function(e){g=e.data,console.log(g),s('.editInput input[name="userName"]').val(g.name),"operation"===e.event?(popupShow("editRold","editBox"),"100001"!=g.id?(s(".permissionsContList").show(),n||s.ajax({type:"post",url:"".concat(vApi,"/role/findPermission"),headers:{"Content-Type":"application/json",token:r},async:!1,data:JSON.stringify({pageNum:"1",pageSize:"1000"}),success:function(e){200==e.code&&(n=e.data.list.filter(function(e,n){return 6!=e.classify&&8!=e.classify&&9!=e.classify?e:""}),e.data.list.forEach(function(e,n){switch(e.classify){case 1:o.push(e);break;case 2:i.push(e);break;case 3:l.push(e);break;case 4:u.push(e);break;case 5:p.push(e);break;case 7:d.push(e);break;case 10:f.push(e);break;case 11:m.push(e);break;case 13:h.push(e)}}))}}),y(o,"permissionsASF",g),y(i,"permissionsGClass",g),y(l,"permissionsGoods",g),y(u,"permissionsGAF",g),y(p,"permissionsMachine",g),y(d,"permissionsASR",g),y(f,"permissionsGeneral",g),y(m,"permissionsOrder",g),y(h,"permissionsMarketing",g)):s(".permissionsContList").hide()):"delete"===e.event&&(k(g.id),t.confirm("确定删除？",function(n){s.ajax({type:"post",url:"".concat(vApi,"/role/deleteRole"),headers:{"Content-Type":"application/json",token:r},data:JSON.stringify({id:g.id}),success:function(e){t.close(n),console.log(e),200==e.code?(v(b),t.msg(e.message,{icon:1}),c.reload({where:{}})):403==e.code?window.parent.location.href="login.html":t.msg(e.message,{icon:2})},error:function(){t.msg("服务器请求超时",{icon:2})}})}))}),s(".addBtn").click(function(){popupShow("MemberOperation","MemberContent")}),s(".cancel_btn").click(function(){popupHide("MemberOperation","MemberContent")}),s(".submitBtn").click(function(){s('.addInput input[name="userName"]').val()?s.ajax({type:"post",url:"".concat(vApi,"/role/saveRole"),headers:{"Content-Type":"application/json",token:r},data:JSON.stringify({name:s('.addInput input[name="userName"]').val()}),success:function(e){popupHide("MemberOperation","MemberContent"),console.log(e),200==e.code?(t.msg(e.message,{icon:1}),s('.addInput input[name="userName"]').val(""),c.reload({where:{}})):403==e.code?window.history.go(-1):t.msg(e.message,{icon:2})},error:function(){t.msg("服务器请求超时",{icon:2})}}):t.msg("带*为必填",{icon:7})}),s(".edittBtn").click(function(){s(".mask").fadeIn(),s(".maskSpan").addClass("maskIcon");var o=[];if(s('.editInput input[name="userName"]').val()){var i=a.val("editInformation");console.log(i);for(var e in i)!function(t){n.forEach(function(e,n){e.id==i[t]&&o.push(e)})}(e);s.ajax({type:"post",url:"".concat(vApi,"/role/updateRole"),headers:{"Content-Type":"application/json",token:r},data:JSON.stringify({id:g.id,name:s('.editInput input[name="userName"]').val(),permissions:o}),success:function(e){s(".mask").fadeOut(),s(".maskSpan").removeClass("maskIcon"),popupHide("editRold","editBox"),200==e.code?(t.msg(e.message,{icon:1}),c.reload({where:{}}),"100001"!=g.id&&k(g.id,"true")):403==e.code?window.parent.location.href="login.html":t.msg(e.message,{icon:2})},error:function(){t.msg("服务器请求超时",{icon:2})}})}else t.msg("带*为必填",{icon:7})}),s(".editCancelbtn").click(function(){popupHide("editRold","editBox")}),s(".refreshBtn").click(function(){location.reload()}),s("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var b=[];function k(e,n){e=JSON.stringify({roleId:Number(e)});loadingAjax("/role/getRoleUser","post",e,r).then(function(e){b=e.data.map(Number),console.log(b),n&&v(b)}).catch(function(e){console.log(e)})}function v(e){e.forEach(function(e,n){console.log(e);e=JSON.stringify({uid:e,msg:"用户角色权限发生变更,请重新登录！",tag:1});loadingAjax("/pushWebMsg","post",e,sessionStorage.token).then(function(e){console.log(e)}).catch(function(e){console.log(e)})})}s(".queryBtnClick").click(function(){c.reload({where:{condition:s(".KyeText").val()}})}),a.on("checkbox(permissionsAll)",function(e){console.log(e.elem),console.log(e.elem.checked);var n=s(e.elem).attr("name");e.value||(e.elem.checked?s(".".concat(n," input")).prop("checked",!0):s(".".concat(n," input")).prop("checked",!1),a.render("checkbox"))})})},384:function(e,n){}});