/*! 版权所有，翻版必究 */!function(l){function e(e){for(var n,t,a=e[0],i=e[1],o=e[2],s=0,c=[];s<a.length;s++)t=a[s],Object.prototype.hasOwnProperty.call(r,t)&&r[t]&&c.push(r[t][0]),r[t]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(l[n]=i[n]);for(u&&u(e);c.length;)c.shift()();return m.push.apply(m,o||[]),d()}function d(){for(var e,n=0;n<m.length;n++){for(var t=m[n],a=!0,i=1;i<t.length;i++){var o=t[i];0!==r[o]&&(a=!1)}a&&(m.splice(n--,1),e=s(s.s=t[0]))}return e}var t={},r={16:0},m=[];function s(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return l[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=l,s.c=t,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)s.d(t,a,function(e){return n[e]}.bind(null,a));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="";var n=window.webpackJsonp=window.webpackJsonp||[],a=n.push.bind(n);n.push=e,n=n.slice();for(var i=0;i<n.length;i++)e(n[i]);var u=a;m.push([371,0]),d()}({371:function(e,n,Se){"use strict";Se.r(n);Se(379);var xe=null,_e=null;function Te(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}layui.use(["form"],function(){for(var i,o,s,c=layui.form,e=$(".province"),n=0;n<provinceList.length;n++)l(e,provinceList[n].name);function l(e,n){var t="<option value="+n+" >"+n+"</option>";e.append(t)}function d(e){e.find("option").remove();e.append("<option value=''>请选择</option>")}c.render("select"),c.on("select(province)",function(e){xe(e.value)}),xe=function(e){var t=$(".city"),n=$(".district");i=e,$.each(provinceList,function(e,n){if(i==n.name)return s=e}),d(t),d(n),$.each(provinceList[s].cityList,function(e,n){l(t,n.name)}),c.render("select")},c.on("select(city)",function(e){_e(e.value)}),_e=function(e){var a=$(".district");o=e,d(a),$.each(provinceList,function(e,n){if(i==n.name)return s=e}),$.each(provinceList[s].cityList,function(e,n){if(o==n.name)for(var t=0;t<n.areaList.length;t++)l(a,n.areaList[t])}),c.render("select")}}),layui.use(["table","form","layer","laydate","tree"],function(){var a=1,n=null;tooltip(".refreshBtnList",{transition:!0,time:200}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".on-left").show()}),$(".on-left").click(function(){$(".left-mian").show(),$(".on-left").hide()});var e=merchantsListMian(""),t=layui.table,i=sessionStorage.token,o=layui.layer,s=layui.form,c=layui.tree,l=layui.laydate,d=t.render({elem:"#machineTable",url:"".concat(vApi,"/machine/getMachineList"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"number",width:150,title:"售货机编号",align:"center",templet:function(e){return e.number||"-"}},{field:"info",width:330,title:"售货机名",align:"center",templet:function(e){return e.info||'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>\n                            <div><span style="color:red;">*</span>(序列号:'.concat(e.machineId,")</div>")}},{field:"location",width:350,title:"地址",align:"center",templet:function(e){return e.location||" - "}},{field:"trafficInfo",width:160,title:"流量使用情况(MB)",align:"center"},{field:"iot_card",width:160,title:"物联网卡号",align:"center"},{field:"warning",width:130,title:"缺货情况",align:"center",templet:function(e){return e.storage_warning[0].warning?' <div>\n                            <span class="'.concat(e.storage_warning[0].way_count<10?"tableStateCellTrue":e.storage_warning[0].way_count<30?"tableStateCellFalse":"red",'">').concat(e.storage_warning[0].warning,"</span>\n                        </div>"):"-"}},{field:"way_count",width:130,title:"缺货货道数量",align:"center",templet:function(e){return e.storage_warning[0].way_count}},{field:"onlineStatus",width:130,title:"在线状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.onlineStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.onlineStatus?"离线":"在线","</span></div>")}},{field:"trafficInfo",width:160,title:"离线时长",align:"center",templet:function(e){if(0!=e.onlineStatus)return"0天0小时0分";var n=(new Date).getTime()-e.offline_time,t=Math.floor(n/864e5),a=Math.floor((n-864e5*t)/36e5),n=Math.floor((n-864e5*t-36e5*a)/6e4);return e.offline_time?t+"天"+a+"小时"+n+"分钟":"-"}},{field:"actionStatus",width:130,title:"是否激活",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.actionStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.actionStatus?"未激活":"已激活","</span></div>")}},{field:"openStatus",width:130,title:"营业状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.openStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.openStatus?"无营业":"营业","</span></div>")}},{field:"merchantName",width:150,title:"所属商户",align:"center"},{field:"appVersion",width:135,title:"软件版本",align:"center"},{field:"connectTime",width:170,title:"联机时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.connectTime):"-"}},{field:"actionTime",width:170,title:"激活时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.actionTime):"-"}},{field:"description",width:250,title:"描述",align:"center"},{field:"operation",fixed:"right",right:0,width:250,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){E(),403==e.code?window.parent.location.href="login.html":405==e.code&&$(".hangContent").show(),fixedFun()}});$(".machineListKeyBtn").click(function(){var e=s.val("machineData");d.reload({where:{onlineStatus:e.onlineStatus?Number(e.onlineStatus):"",actionStatus:e.actionStatus?Number(e.actionStatus):"",openStatus:e.permissions?Number(e.permissions):"",stockStatus:e.CreationTime?Number(e.CreationTime):"",keyword:e.machineKeyText}})}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(C)&&(C=e,treeFun(c,"test1",d,C,"merchantId","condition",V,"","true"),d.reload({where:{merchantId:sessionStorage.machineID}})),o.msg("已刷新",{icon:1})}),$(".setNav li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this);switch($(".tabLine").animate({left:0!=e.index()?e.offset().left+"px":e.offset().left-20+"px",width:e.width()+"px"},500),$(".navSetCont li").eq($(this).index()).fadeIn().siblings().hide(),e.index()){case 1:W(r.machineId),n=1;break;case 2:e=r.machineId,I=t.render({elem:"#salesDateilsTable",url:"".concat(vApi,"/machine/getSalesList"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"time",width:200,title:"时间",templet:function(e){return timeStamp(e.time)}},{field:"number",width:250,title:"订单号"},{field:"payStatus",width:150,title:"支付状态",templet:function(e){return'<div><span class="'.concat(2==e.payStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(e.payResult,"</span></div>")}},{field:"payTypes",width:150,title:"支付类型"},{field:"payee",width:150,title:"收款方"},{field:"amount",width:150,title:"金额"}]],id:"salesId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:e,conditionTwo:f||null,conditionThree:v||null},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 3:r.machineId,w=t.render({elem:"#shipmentListTable",url:"".concat(vApi,"/machine/getShippingList"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"time",width:230,title:"出货时间",align:"center",templet:function(e){return e.create_time?timeStamp(e.create_time):"-"}},{field:"goods_Name",width:200,title:"商品名",align:"center"},{field:"ship_status",width:165,title:"出货状态",align:"center",templet:function(e){return 0==e.ship_status?"出货失败":1==e.ship_status?"出货成功":"货道故障"}},{field:"before_count",width:165,align:"center",title:"出货前数量"},{field:"before_count",width:165,align:"center",title:"出货后数量",templet:function(e){return 1==e.ship_status?e.before_count-1:e.before_count}},{field:"ship_type",width:165,align:"center",title:"出货类型",templet:function(e){return 1==e.ship_type?"订单":"取货码"}},{field:"way",width:120,align:"center",title:"出货货道"},{field:"order_code",width:210,align:"center",title:"订单号/取货码"}]],id:"shipmentId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId,conditionTwo:y,conditionThree:k},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 4:le(r.machineId,r.userNum);break;case 5:r.machineId,ue=t.render({elem:"#replenishmentTable",url:"".concat(vApi,"/machine/getReplenish"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"way",width:250,title:"补货人",align:"center",templet:function(e){return e.name+"("+e.username+")"}},{field:"replenish_time",width:230,title:"补货时间",align:"center",templet:function(e){return e.replenish_time?timeStamp(e.replenish_time):"-"}},{field:"way",width:100,title:"补货货道",align:"center"},{field:"goods_Name",width:180,title:"商品名",align:"center"},{field:"replenish_count",width:150,title:"补货前数量",align:"center",templet:function(e){return e.after_count-e.replenish_count}},{field:"replenish_count",width:150,title:"补货数量",align:"center"},{field:"after_count",width:150,title:"补货后数量",align:"center"}]],id:"shipmentId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId,start_time:pe||null,end_time:he||null},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 6:ve=t.render({elem:"#priceEdit",url:"".concat(vApi,"/machine/getPriceRecord"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"old_price",width:150,title:"修改前价格",align:"center"},{field:"new_price",width:150,title:"修改后价格",align:"center"},{field:"goods_Name",width:150,title:"商品名",align:"center"},{field:"user_name",width:150,title:"修改人",align:"center"},{field:"way",width:250,title:"修改时间",align:"center",templet:function(e){return e.change_time?timeStamp(e.change_time):"-"}}]],id:"priceId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId,startDate:ge,endDate:fe},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 7:$e=t.render({elem:"#openTheDoor",url:"".concat(vApi,"/machine/getDoorRecord"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"info",width:250,title:"售货机名",align:"center"},{field:"openType",width:150,title:"类型",align:"center"},{field:"username",width:150,title:"操作人",align:"center"},{field:"goods_Name",width:250,title:"开门时间",align:"center",templet:function(e){return e.open_time?timeStamp(e.open_time):"-"}}]],id:"openTheDoorId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 8:Ce=t.render({elem:"#panelTable",url:"".concat(vApi,"/machine/getDisplayGood"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"goods_Name",width:150,title:"图片",align:"center",templet:"#panelImg"},{field:"goods_Name",width:150,title:"商品名",align:"center"},{field:"goodCount",width:150,title:"数量",align:"center"},{field:"oldGoodCount",width:150,title:"原数量",align:"center"},{field:"last_user",width:150,title:"修改人",align:"center"},{field:"last_time",width:180,title:"修改时间",align:"center",templet:function(e){return e.last_time?timeStamp(e.last_time):"-"}},{field:"operation",fixed:"right",right:0,width:150,title:"操作",toolbar:"#panelId",align:"center"}]],id:"panelID",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.length,data:e.data}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){E(),403==e.code&&(window.parent.location.href="login.html")}}),n=2;break;case 9:t.render({elem:"#undoTable",url:"".concat(vApi,"/machine/findRemove"),method:"get",headers:{token:i},cols:[[{field:"goodName",width:150,title:"商品名",align:"center"},{field:"way",width:130,title:"货道",align:"center"},{field:"count",width:150,title:"数量",align:"center"},{field:"price",width:150,title:"价格",align:"center"},{field:"userName",width:215,title:"撤货人",align:"center"},{field:"removeDate",width:200,title:"撤货时间",align:"center"}]],id:"undoId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:r.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){E(),403==e.code&&(window.parent.location.href="login.html")}})}});var r=null;t.on("tool(machineTable)",function(e){var n;r=e.data,console.log(r),loadingAjax("/machine/findWay","get",{machineId:r.machineId},sessionStorage.token).then(function(e){var n='<option value="">全部</option>';e.data.forEach(function(e){n+='<option value="'.concat(e,'">').concat(e,"</option>")}),$('.shipmentRecord select[name="shipSelect"]').html(n),$('.replenishment select[name="shipSelect"]').html(n),s.render("select")}).catch(function(e){}),$(".maskHeader span").html(r.info?r.info+"详细信息":"-详细信息"),"set"==e.event?($(".setUpCont").show(),n=null,r.location&&(n=r.location.split(" ")),s.val("setDataVal",{info:r.info,appVersion:r.appVersion,longitude:r.longitude,latitude:r.latitude,location:r.location,setProvince:n?n[1]:"",setCity:n?n[2]:"",setArea:n?n[3]:"",setRegion:r.area}),$(".navSetCont li").eq(0).show().siblings().hide(),$(".setNav li").eq(0).addClass("active").siblings().removeClass("active"),$(".tabLine").animate({left:$(".setNav li").eq(0).offset().left-20+"px",width:$(".setNav li").eq(0).width()+"px"},1)):"edit"==e.event?(1==r.openStatus?o.msg("温馨提示！该售货机正在营业，不可进行编辑！",{icon:7}):b||o.msg("温馨提示！您没有编辑售货机的权限！",{icon:7}),n=null,r.location&&(n=r.location.split(" ")),$(".editMachineBox .layui-tree-txt").css({color:"#555"}),s.val("editmachine",{sNumber:r.number,tName:r.info,number:r.machineId,province:r.location?n[0]:"",mapVal:r.location?n[3]:"",area:r.area,longitude:r.longitude,latitude:r.latitude,headPhone:r.chargerPhone,describe:r.description,merchantsName:r.userNum,merchantsNametext:r.merchantName,max_ship:0==r.max_ship?"":r.max_ship}),r.location&&(xe(n[0]),console.log(n[0]),$(".city").val(n[1]),_e(n[1]),$(".district").val(n[2]),s.render("select")),$(".editMachineCont").show(),$(".editMachineCont").scrollTop(0),r.service_code?($(".ImgCont img").prop("src",r.service_code),$(".ImgCont").show()):($(".ImgCont img").prop("src",""),$(".ImgCont").hide()),de=1==r.is_service?($(".serviceTitle").show(),$('.listFlex input[name="machineOpen"]').prop("checked",!0),!0):($(".serviceTitle").hide(),$('.listFlex input[name="machineOpen"]').prop("checked",!1),!1),$('.serviceTitle input[name="service_phone"]').val(r.service_phone),r.custom_code?($(".customImgCont img").prop("src",r.custom_code),$(".customImgCont").show()):($(".customImgCont img").prop("src",""),$(".customImgCont").hide()),re=1==r.is_custom?($(".customTitle").show(),$('.listFlex input[name="customOpen"]').prop("checked",!0),!0):($(".customTitle").hide(),$('.listFlex input[name="customOpen"]').prop("checked",!1),!1),1==r.is_volume?$('.listFlex input[name="sound"]').prop("checked",!0):$('.listFlex input[name="sound"]').prop("checked",!1),1==r.is_light?$('.listFlex input[name="lamp"]').prop("checked",!0):$('.listFlex input[name="lamp"]').prop("checked",!1),function(n,e){var t=JSON.stringify({merchantId:n.userNum,pageSize:10,pageNum:e});1==e&&(me=[]);loadingAjax("/sales_manager/getSalesType","post",t,sessionStorage.token,"mask","","",o).then(function(e){!function(e,n){console.log(a);var t="";1==a&&($(".salseCont").html(""),t='<input type="radio" '.concat(0==n.is_sales?"checked":"",' name="salseClassName" value="-99" title="不启用" >\n            <input type="radio" name="salseClassName" ').concat(1!=n.is_sales||n.sales_type?"":"checked",' value="" title="默认" >'),a++);e.forEach(function(e){t+='<input type="radio" name="salseClassName" '.concat(1==n.is_sales&&r.sales_type==e.sm_classify?"checked":"",' value="').concat(e.sm_classify,'" title="').concat(e.sm_classify,'">')}),$(".salseCont").append(t),s.render()}(me=me.concat(e.data.list),n)}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}(r,a=1),$('.customTitle input[name="custom_phone"]').val(r.custom_phone),s.render(),h()):"activate"==e.event?S?o.confirm("确定激活该设备？",function(e){o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");e=JSON.stringify({machineId:r.machineId,actionStatus:"1"});loadingAjax("/machine/activeMachine","post",e,i,"mask","","",o).then(function(e){o.msg("激活成功",{icon:1}),d.reload({where:{}})}).catch(function(e){o.msg(res.message,{icon:2})})}):o.msg("您没有激活售货机的权限!"):"startThe"==e.event&&(S?o.confirm(1!=r.openStatus?"确定营业？":"确定暂停营业？",function(e){var n=1!=r.openStatus?"1":"0";o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/getStatus","post",JSON.stringify({machineId:r.machineId}),i).then(function(e){console.log(e),1==e.data.actionStatus?loadingAjax("/pushActive","post",JSON.stringify({machine:r.machineId,action:1!=r.openStatus?"true":"false"}),i).then(function(e){}).catch(function(e){loadingAjax("/machine/activeMachine","post",JSON.stringify({machineId:r.machineId,openStatus:n}),i,"mask").then(function(e){o.msg("操作成功",{icon:1}),d.reload({where:{}})}).catch(function(e){o.msg(e.message,{icon:2})})}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("操作失败",{icon:2}))}).catch(function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg(e.message,{icon:2})})}):o.msg("您没有更改营业状态的权限!"))}),$(".setUpCont .close").click(function(){$(".setUpCont").hide()}),$(".editMachineCont .close").click(function(){$(".editMachineCont").hide()}),$(".editMachineCont .editCancelBtn").click(function(){$(".editMachineCont").hide()});var m=new AMap.Map("machineMap",{resizeEnable:!0}),u=new AMap.Geocoder({city:"",radius:1e3}),p=new AMap.Marker;function h(){var e=$('.listFlex select[name="province"]').val()+$('.listFlex select[name="city"]').val()+$('.listFlex select[name="district"]').val()+$('.listFlex input[name="mapVal"]').val();u.getLocation(e,function(e,n){"complete"===e&&n.geocodes.length?(n=n.geocodes[0].location,console.log(n),$('.listFlex input[name="longitude"]').val(n.lng),$('.listFlex input[name="latitude"]').val(n.lat),p.setPosition(n),m.add(p),m.setFitView(p)):o.msg("根据地址查询位置失败",{icon:2})})}function g(){var e=[$('.listFlex input[name="longitude"]').val(),$('.listFlex input[name="latitude"]').val()];m.add(p),p.setPosition(e),m.setFitView(p),u.getAddress(e,function(e,n){"complete"===e&&n.regeocode?(n=n.regeocode,console.log(n),$('.listFlex input[name="mapVal"]').val(n.addressComponent.street+n.addressComponent.streetNumber),$('.listFlex select[name="province"]').val(n.addressComponent.province),xe(n.addressComponent.province),"北京市"==n.addressComponent.province||"天津"==n.addressComponent.province||"上海市"==n.addressComponent.province||"重庆市"==n.addressComponent.province?($('.listFlex select[name="city"]').val("市辖区"),_e("市辖区")):($('.listFlex select[name="city"]').val(n.addressComponent.city),_e(n.addressComponent.city)),$('.listFlex select[name="district"]').val(n.addressComponent.district),s.render("select")):o.msg("根据地址查询位置失败",{icon:2})})}m.on("click",function(e){console.log(e.lnglat),console.log(e.lnglat.Q),$('.listFlex input[name="longitude"]').val(e.lnglat.lng),$('.listFlex input[name="latitude"]').val(e.lnglat.lat),g()}),$('.listFlex input[name="mapVal"]').blur(function(){h()}),$('.listFlex input[name="longitude"]').blur(function(){g()}),$('.listFlex input[name="latitude"]').blur(function(){g()}),$('.listFlex input[name="userPhone"]').blur(function(){phoneRegular(this,o)}),$('.listFlex input[name="headPhone"]').blur(function(){phoneRegular(this,o)}),$(".editMachineCont .edittBtn").click(function(){var e;1!=r.openStatus?(e=s.val("editmachine")).sNumber&&e.tName&&e.number&&e.province&&e.city&&e.district&&e.mapVal&&e.area&&e.merchantsName?$('.serviceTitle input[name="service_phone"]').val()||$(".ImgCont img").attr("src")||!de?$('.customTitle input[name="custom_phone"]').val()||$(".customImgCont img").attr("src")||!re?!$('.listFlex input[name="max_ship"]').val()||0<$('.listFlex input[name="max_ship"]').val()&&Number.isInteger(Number($('.listFlex input[name="max_ship"]').val()))?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({number:e.sNumber,info:e.tName,machineId:e.number,location:e.province+" "+e.city+" "+e.district+" "+e.mapVal,area:e.area,longitude:e.longitude,latitude:e.latitude,userNum:r.userNum==Number(e.merchantsName)?0:Number(e.merchantsName),chargerPhone:e.headPhone,description:e.describe,is_service:de?1:0,service_phone:de?$('.serviceTitle input[name="service_phone"]').val():"",service_code:de?$(".ImgCont img").attr("src"):"",is_custom:re?1:0,custom_phone:re?$('.customTitle input[name="custom_phone"]').val():"",custom_code:re?$(".customImgCont img").attr("src"):"",is_sales:-99==$('.salseCont input[name="salseClassName"]:checked').val()?0:1,sales_type:-99==$('.salseCont input[name="salseClassName"]:checked').val()?"":$('.salseCont input[name="salseClassName"]:checked').val(),is_volume:$('.listFlex input[name="sound"]').prop("checked")?1:0,is_light:$('.listFlex input[name="lamp"]').prop("checked")?1:0,max_ship:$('.listFlex input[name="max_ship"]').val()?Number($('.listFlex input[name="max_ship"]').val()):null}),loadingAjax("/machine/updateMachine","post",e,sessionStorage.token,"mask").then(function(e){$(".editMachineCont").hide(),o.msg("编辑成功",{icon:1}),d.reload({where:{}})}).catch(function(e){o.msg(e.message,{icon:2})})):o.msg("最大出货数必须是正整数",{icon:7}):o.msg("请填写定制电话或上传定制二维码",{icon:7}):o.msg("请填写客服电话或上传客服微信二维码",{icon:7}):o.msg("带*为必填",{icon:7}):o.msg("正在营业的售货机不可进行编辑！",{icon:7})}),$(".fixedAccount").click(function(){$(".fixedAccount").removeClass("active"),$(this).addClass("active"),d.reload({where:{merchantId:$(this).attr("mid")}})});var f=getKeyTime().startTime,v=getKeyTime().endTime;l.render({elem:"#test6",range:!0,value:getKeyTime().keyTimeData,done:function(e){e=e.split(" - ");f=e[0],v=e[1]}});var y=getKeyTime().startTime,k=getKeyTime().endTime;l.render({elem:"#test7",range:!0,value:getKeyTime().keyTimeData,done:function(e){console.log(e);e=e.split(" - ");console.log(e),y=e[0],k=e[1]}});var I=null;$(".selesPushBtn").click(function(){var i;timeFlag(f,v)?o.msg("时间选择范围最多三个月",{icon:7}):($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),new Date,(i=new XMLHttpRequest).open("GET","".concat(vApi,"/exportMachineOrder?startDate=").concat(f,"&endDate=").concat(v,"&condition=").concat(r.machineId),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"(").concat(r.number,")销售详情(").concat(f,"-").concat(v,").xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send())}),$(".selesQueryBtn").click(function(){var e;timeFlag(f,v)?o.msg("时间选择范围最多三个月",{icon:7}):(e=s.val("salesDataVal"),console.log(e),I.reload({where:{conditionFive:e.shipmentStatus,conditionSix:e.payStatus,conditionSeven:e.payType,conditionTwo:f||null,conditionThree:v||null}}))});var w=null;$(".shipmentPushBtn").click(function(){var i;timeFlag(y,k)?o.msg("时间选择范围最多三个月",{icon:7}):($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(i=new XMLHttpRequest).open("GET","".concat(vApi,"/excelShipping?startDate=").concat(y,"&endDate=").concat(k,"&machineId=").concat(r.machineId,"&way=").concat($('.shipmentRecord select[name="shipSelect"]').val(),"&goods_Name=").concat($('.shipmentRecord input[name="shipGoodName"]').val()),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"(").concat(r.number,")出货记录(").concat(y,"-").concat(k,").xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send())}),$(".shipmentQueryBtn").click(function(){timeFlag(y,k)?o.msg("时间选择范围最多三个月",{icon:7}):w.reload({where:{way:$('.shipmentRecord select[name="shipSelect"]').val(),goods_Name:$('.shipmentRecord input[name="shipGoodName"]').val(),conditionTwo:y,conditionThree:k}})});var N=null,C=N=treeList();0==e.length&&(N=[]),treeFun(c,"test1",d,C,"merchantId","condition",V,"","true");c.render({elem:"#test2",id:"treelistEdit",showLine:!0,onlyIconControl:!0,isJump:!1,edit:!1,data:N,text:{defaultNodeName:"无数据",none:"您没有修改机器所属商户的权限。"},click:function(e){console.log(e),s.val("editmachine",{merchantsName:e.data.id,merchantsNametext:e.data.title});for(var n=$(".editMachineBox .layui-tree-txt"),t=0;t<n.length;t++)n[t].innerHTML===e.data.title?n[t].style.color="#be954a":n[t].style.color="#555"}});$(".editRefres").click(function(){var e=treeList();JSON.stringify(e)==JSON.stringify(N)||(N=e,c.reload("demoId",{data:N})),o.msg("已刷新",{icon:1})}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var b=!1,S=!1,x=!1,_=!1,T=!1,P=!1,B=!1,A=!1,O=!1,D=!1,F=!1,G=!1,M=!1,R=!1,j=!1,L=!1,q=!1,J=!1,H=!1;function E(){S?$(".activeMachineType").removeClass("hides"):$(".activeMachineType").addClass("hides"),_?$(".payTypeSet").removeClass("hide"):$(".payTypeSet").addClass("hide"),_?$(".sequence").removeClass("hide"):$(".sequence").addClass("hide"),T?$(".detailsDel").removeClass("hide"):$(".detailsDel").addClass("hide"),P?$("aisleDetailsTab").removeClass("hide"):$("aisleDetailsTab").addClass("hide"),B?$(".salesDetails").removeClass("hide"):$(".salesDetails").addClass("hide"),A?$(".shipmentDetails").removeClass("hide"):$(".shipmentDetails").addClass("hide"),O?$(".shmentSet").removeClass("hide"):$(".shmentSet").addClass("hide"),D?$(".selesPushBtn").removeClass("hide"):$(".selesPushBtn").addClass("hide"),F?$(".shipmentPushBtn").removeClass("hide"):$(".shipmentPushBtn").addClass("hide"),G?$(".replenishmentPushBtn").removeClass("hide"):$(".replenishmentPushBtn").addClass("hide"),M?$(".editPircePushBtn").removeClass("hide"):$(".editPircePushBtn").addClass("hide"),R?$(".openDoorPushBtn").removeClass("hide"):$(".openDoorPushBtn").addClass("hide"),j?$(".invoicePushBtn1").removeClass("hide"):$(".invoicePushBtn1").addClass("hide"),L?$(".panelFlagClass").removeClass("hide"):$(".panelFlagClass").addClass("hide"),q?$(".undoRecord").removeClass("hide"):$(".undoRecord").addClass("hide"),J?$(".undoPushBtn").removeClass("hide"):$(".undoPushBtn").addClass("hide"),H?$(".pushMachineBtn").removeClass("hide"):$(".pushMachineBtn").addClass("hide")}function V(e){loadingAjax("/classify/findAll","post",JSON.stringify({pageNum:1,pageSize:200,merchantId:e}),sessionStorage.token).then(function(e){var t='<option value="">全部</option>';$.each(e.data.list,function(e,n){t+='<option value="'.concat(n.classifyId,'">').concat(n.classifyName,"</option>")}),$("#GoodsType").html(t),s.render("select")}).catch(function(e){})}permissionsFun("/role/findUserPermission","post",sessionStorage.token,o).then(function(e){e.data.forEach(function(e){"396"==e.id&&(b=!0),"392"==e.id&&(S=!0),"424"==e.id&&(x=!0),"432"==e.id&&(_=!0),"426"==e.id&&(T=!0),e.id,"427"==e.id&&(P=!0),"401"==e.id&&(B=!0),"402"==e.id&&(A=!0),"456"==e.id&&(O=!0),"467"==e.id&&(D=!0),"466"==e.id&&(F=!0),"468"==e.id&&(G=!0),"469"==e.id&&(M=!0),"470"==e.id&&(R=!0),"472"==e.id&&(j=!0),"471"==e.id&&(L=!0),"473"==e.id&&(q=!0),"474"==e.id&&(J=!0),"475"==e.id&&(H=!0)}),E()}).catch(function(e){o.msg(e.message,{icon:2})}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),V(sessionStorage.machineID),sessionStorage.machineGoodsId=sessionStorage.machineID,sessionStorage.machineName=sessionStorage.marchantName;var U=null;function K(){var e;U=t.render({elem:"#goodsTable",url:"".concat(vApi,"/goods/findAll"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"goods_images",width:100,title:"图片",templet:"#imgtmp"},{field:"goods_Name",width:200,align:"center",title:"商品名",color:"#409eff",templet:function(e){return 1==e.mail?"(邮寄)"+e.goods_Name:e.goods_Name}},{field:"classifyName",align:"center",width:150,title:"商品类目"},(Te(e={field:"mail",align:"center",width:130,title:"是否邮寄商品"},"align","center"),Te(e,"templet",function(e){return 0==e.mail?"否":"是"}),e),{field:"goods_Core",align:"center",width:180,title:"商品编号"},{field:"operation",position:"absolute",right:0,width:80,title:"操作",toolbar:"#GoodsbarDemo"}]],id:"goodsID",page:!0,loading:!0,height:"480",request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineGoodsId,conditionFour:"1"},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}var z=[];function W(e){z=[];e=JSON.stringify({machineId:e});loadingAjax("/machine/getGoodWay","post",e,sessionStorage.token,"","","",o).then(function(e){X(e),console.log(e)}).catch(function(e){console.log(e),z=[],0;$(".aisleGoodsCont").html('<div style="text-align: center;">您没有权限访问货道详情！</div>')})}function X(e){var a;z=[[],[],[],[],[],[]],e.data,e.data.forEach(function(e){e.row&&z[e.row-1].push(e)}),a="",z.forEach(function(e,t){a+='<div class="aisleListCont flexTwo">\n                            <div class="listIndex">\n                                <span>'.concat(t+1,"</span>\n                            </div>"),e.forEach(function(e,n){0!=e.open?a+='<div class="aisleNumderGoods" >\n                                    <div class="aisleNumderClick" fireIndex="'.concat(t+","+n,'">\n                                    <div class="numderTop">                                   \n                                        <img class="').concat(1==e.status?"":"hide",'" src="').concat(e.goods_images||Se(67),'" alt=""> \n                                        <img class="').concat(1==e.status?"hide":"",'" src="').concat(Se(95),'" alt="">\n                                    <span>').concat(e.way,'</span>\n                                    </div>\n                                <div class="numderBottom">\n                                        <div class="status1 ').concat(1==e.status?"":"redF10",'">').concat(1==e.status?"正常":"货道故障","</div>\n                                    <div>数量:").concat(e.count,'</div>\n                                    </div>\n                                    </div>  \n                                    <div class="chooseCheck" data-tip="').concat(e.goods_Name||"",'" data-direction="bottom">\n                                        <span >').concat(e.mail?"(邮寄)":""," ").concat(e.goods_Name||"-","</span>\n                                    </div>\n                                </div>"):a+='<div class="aisleNumderGoods" >\n                                    <div class="aisleNumderClick" fireIndex="'.concat(t+","+n,'">\n                                    <div class="numderTop">\n                                    <img class="').concat(1==e.status?"":"hide",'" src="').concat(e.goods_images||Se(67),'" alt="">\n                                    <img class="').concat(1==e.status?"hide":"",'" src="').concat(Se(95),'" alt="">\n                                        <span>').concat(e.way,'</span>\n                                    </div>\n                                    <div class="numderBottom">\n                                        <div class="status2">').concat(1==e.status?"禁用":"货道故障","</div>\n                                        <div>数量:").concat(e.count,'</div>\n                                    </div>\n                                    </div>  \n                                    <div class="chooseCheck" data-tip="').concat(e.goods_Name||"",'" data-direction="bottom">\n                                        <span >').concat(1==e.mail?"(邮寄)":"").concat(e.goods_Name||"","</span>\n                                    </div>\n                                </div>")}),a+=" </div>"}),$(".aisleGoodsCont").html(a),s.render("checkbox"),tooltip(".chooseCheck",{transition:!0,time:200})}$(".relative").click(function(){popupShow("goodsCont","goodsBox"),U?U.reload({where:{condition:sessionStorage.machineGoodsId}}):K()}),$(".goodsCont .queryBtnClick").click(function(){U.reload({where:{conditionTwo:$('.goodsCont input[name="GoodsKyeText"]').val(),conditionThree:$("#GoodsType").val()}})});var Q=null;sessionStorage.independentPass="";var Y=null;$("body").on("click",".aisleNumderClick",function(){console.log($(this).attr("fireIndex")),Y=$(this).attr("fireIndex").split(","),console.log(Y),x?(Q=1,sessionStorage.independentPass?(ne(),popupShow("editAisle","editAisleBox")):popupShow("iPasswprd","passwordCont")):o.msg("您没有编辑货道的权限!",{icon:7})}),$(".passBtn").click(function(){var e=JSON.stringify({alonePwd:hex_md5($('.iPasswprd input[name="iPassword"]').val())});loadingAjax("/user/verifyAlonePwd","post",e,sessionStorage.token,"mask","iPasswprd","passwordCont",o).then(function(e){sessionStorage.independentPass="true",1==Q?(ne(),popupHide("iPasswprd","passwordCont"),popupShow("editAisle","editAisleBox")):2==Q&&($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/removeGoodWay","post",JSON.stringify({machineId:r.machineId}),sessionStorage.token,"mask","","").then(function(e){o.msg(e.message,{icon:1}),W(r.machineId)}).catch(function(e){o.msg(e.message,{icon:2})}))}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}),$(".iPasswprd .cancelBtn").click(function(){popupHide("iPasswprd","passwordCont")}),$(".editAisle .cancelBtn").click(function(){popupHide("editAisle","editAisleBox")});var Z=null,ee={};function ne(){Z=z[Y[0]][Y[1]],console.log(Z),$('.editAisle input[name="goodsName"]').val(Z.goods_Name?1==Z.mail?"(邮寄)"+Z.goods_Name:Z.goods_Name:""),$('.editAisle input[name="goodsName"]').attr("IVal",Z.goods_Id||""),$('.editAisle input[name="price"]').val(Z.price||""),$('.editAisle input[name="count"]').val(Z.count),$('.editAisle input[name="total"]').val(Z.total),s.val("testVal",{testSele:Z.open}),ee={machineId:r.machineId,way:Z.way,goodId:Number(Z.goods_Id),newGoodId:Number(Z.goods_Id),count:Number(Z.count),total:Number(Z.total),open:Number(Z.open),replenish:Z.count}}t.on("row(goodsTable)",function(e){console.log(n),1==n?($('.editAisle input[name="goodsName"]').val(1==e.data.mail?"(邮寄)"+e.data.goods_Name:e.data.goods_Name),$('.editAisle input[name="goodsName"]').attr("IVal",e.data.goods_Id),$('.editAisle input[name="price"]').val(e.data.goods_Price)):($('.addPanelBody input[name="panelGoodsName"]').val(1==e.data.mail?"(邮寄)"+e.data.goods_Name:e.data.goods_Name),$('.addPanelBody input[name="panelGoodsName"]').attr("IVal",e.data.goods_Id)),popupHide("goodsCont","goodsBox")}),$(".editAisle .ediaisleBtn").click(function(){var e;$('.editAisle input[name="goodsName"]').attr("IVal")?$('.editAisle input[name="price"]').val()?$('.editAisle input[name="count"]').val()&&$('.editAisle input[name="total"]').val()?Number($('.aisleList input[name="total"]').val())>=Number($('.aisleList input[name="count"]').val())?(e=JSON.stringify({machineId:r.machineId,way:Z.way,goodId:Number(Z.goods_Id||$('.editAisle input[name="goodsName"]').attr("IVal")),newGoodId:Number($('.editAisle input[name="goodsName"]').attr("IVal")),replenish:Z.goods_Id?Z.count:0,count:Number($('.editAisle input[name="count"]').val()),total:Number(Z.goods_Id?Z.total:0),newTotal:Number($('.editAisle input[name="total"]').val()),status:Z.open,newStatus:Number($('.editAisle select[name="testSele"]').val()),price:Z.goods_Id?Z.price+"":"0",newPrice:$('.editAisle input[name="price"]').val()+""}))!=JSON.stringify(ee)?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/updateGoodWay","post",e,sessionStorage.token,"mask","editAisle","editAisleBox",o).then(function(e){o.msg(e.message,{icon:1}),W(r.machineId),loadingAjax("/refreshGoods","post","",sessionStorage.token).then(function(e){}).catch(function(e){})}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})):popupHide("editAisle","editAisleBox"):o.msg("货道容量不能小于当前数量",{icon:7}):o.msg("数量和容量为为必填",{icon:7}):o.msg("请输入在售价格",{icon:2}):o.msg("请选择商品",{icon:7})});var te=null;$(".aisleDetails").on("click",".addAisle",function(){te=$(this).attr("indexVal"),sessionStorage.independentPass?popupShow("addDetalis","addCont"):popupShow("iPasswprd","passwordCont")}),$(".addCancelBtn").click(function(){popupHide("addDetalis","addCont")}),$(".addDetalisBtn").click(function(){var e;""!=$('.addDetalis input[name="addNum"]').val()&&0<$('.addDetalis input[name="addNum"]').val()?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({machineId:r.machineId,way:Number(te),count:Number($('.addDetalis input[name="addNum"]').val())}),loadingAjax("/machine/insertGoodWay","post",e,sessionStorage.token,"mask","addDetalis","addCont",o).then(function(e){console.log(e),o.msg(e.message,{icon:1}),X(e),$('.addDetalis input[name="addNum"]').val(" ")}).catch(function(e){o.msg(e.message,{icon:2})})):o.msg("数量必须大于0",{icon:7})});var ae=1;$('.addDetalis input[name="addNum"]').keyup(function(){var e=$(this).val();/^\d*$/.test(e)?(ae=$(this).val(),console.log(ae)):(o.msg("只能输入正整数",{icon:7}),$(this).val(ae))}),$(".testNumdev input").keyup(function(){var e=$(this).val();/^\d*$/.test(e)||(o.msg("只能输入正整数",{icon:7}),$(this).val(""))});var ie=[];$(".delBtn").click(function(){ie=[];var t=s.val("delDetalis");console.log(t),"{}"!=JSON.stringify(t)?o.confirm("确定删除？",function(e){for(var n in o.close(e),t)ie.push(Number(t[n]));sessionStorage.independentPass?(console.log(ie),e=JSON.stringify({machineId:r.machineId,ways:ie}),e=e,$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("api/machine/deleteGoodWay","post",e,sessionStorage.token,"mask","","",o).then(function(e){console.log(e),o.msg(e.message,{icon:1}),X(e)}).catch(function(e){o.msg(e.message,{icon:2})})):popupShow("iPasswprd","passwordCont")}):o.msg("请选择需要删除的货道",{icon:7})});var oe=null,se=null,ce=null;function le(e,n){e=JSON.stringify({machineId:e});loadingAjax("/pay/getMachinePayParam","post",e,sessionStorage.token).then(function(e){loadingAjax("/pay/getPayParam","post",JSON.stringify({merchantId:Number(n)}),sessionStorage.token).then(function(n){var a="";e.data.forEach(function(t,e){1==t.id?se=0<t.selectPay.length?t.selectPay[0].mpId:0:2==t.id?oe=0<t.selectPay.length?t.selectPay[0].mpId:0:3==t.id&&(ce=0<t.selectPay.length?t.selectPay[0].mpId:0),1==t.status&&(a+='<div class="layui-form-item">\n                                        <label class="layui-form-label">'.concat(t.tName,'：</label>\n                                    <div class="layui-input-block">'),0==t.selectPay.length?a+='<input type="radio" lay-filter="'.concat(3==t.id?"radioTest3":"radioTest",'" name="').concat(t.id,'" value="').concat("0-0",'" title="无" checked>'):a+='<input type="radio" lay-filter="'.concat(3==t.id?"radioTest3":"radioTest",'" name="').concat(t.id,'" value="').concat(t.selectPay[0].mpId+"-0",'" title="无" >'),n.data.forEach(function(e,n){t.id==e.payType&&(a+='<input type="radio" lay-filter="'.concat(3==t.id?"radioTest3":"radioTest",'" name="').concat(t.id,'" value="').concat((0<t.selectPay.length?t.selectPay[0].mpId:0)+"-"+e.id,'" title="').concat(e.payee,'" ').concat(!(t.selectPay.length<=0)&&t.selectPay[0].paramId==e.id?"checked":""," >"))}),a+="</div>\n                        </div>")}),$("#setPayList").html(a),s.render("radio")}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}).catch(function(e){o.msg(e.message,{icon:2})})}$(".paySet .paySetBtn").click(function(){var e=s.val("paySetData");console.log(e)}),s.on("radio(radioTest)",function(t){console.log(t),o.confirm("确定修改收款账户？(温馨提示：工行支付不能与微信支付、支付宝支付共用)",function(e){o.close(e),console.log(t);var n=t.value.split("-");console.log(n);e=JSON.stringify({machineId:r.machineId,paramId:Number(n[1]),mpId:Number(n[0])});loadingAjax("/pay/updateMachinePayParam","post",e,sessionStorage.token).then(function(e){o.msg(e.message,{icon:1}),"0"!=Number(n[1])&&"0"!=ce?(e=JSON.stringify({machineId:r.machineId,paramId:0,mpId:Number(ce)}),loadingAjax("/pay/updateMachinePayParam","post",e,sessionStorage.token).then(function(e){le(r.machineId,r.userNum)}).catch(function(e){})):le(r.machineId,r.userNum)}).catch(function(e){o.msg(e.message,{icon:2})})},function(){le(r.machineId,r.userNum)})}),s.on("radio(radioTest3)",function(n){o.confirm("确定修改收款账户？(温馨提示：工行支付不能与微信支付、支付宝支付共用)",function(e){o.close(e);var t=n.value.split("-"),e=JSON.stringify({machineId:r.machineId,paramId:Number(t[1]),mpId:Number(t[0])});loadingAjax("/pay/updateMachinePayParam","post",e,sessionStorage.token).then(function(e){var n;o.msg(e.message,{icon:1}),"0"!=Number(t[1])&&"0"!=oe&&(n=JSON.stringify({machineId:r.machineId,paramId:0,mpId:Number(oe)}),loadingAjax("/pay/updateMachinePayParam","post",n,sessionStorage.token).then(function(e){}).catch(function(e){})),"0"!=Number(t[1])&&"0"!=se?(n=JSON.stringify({machineId:r.machineId,paramId:0,mpId:Number(se)}),loadingAjax("/pay/updateMachinePayParam","post",n,sessionStorage.token).then(function(e){le(r.machineId,r.userNum)}).catch(function(e){})):le(r.machineId,r.userNum)}).catch(function(e){o.msg(e.message,{icon:2})})},function(){le(r.machineId,r.userNum)})});var de=!1;$(".uploadBtn input").change(function(e){var n,t;$(this).val()&&(n=this,(t=new FormData).append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:i},data:t,success:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".ImgCont img").prop("src",e.data.src),$(".ImgCont").show()):o.msg(e.message,{icon:7})},error:function(){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("上传失败",{icon:2})}}))}),$(".delImgBtn").click(function(){$(".ImgCont img").prop("src",""),$(".ImgCont").hide()}),s.on("switch(machineOpen)",function(e){de=e.elem.checked,e.elem.checked?$(".serviceTitle").slideDown():$(".serviceTitle").slideUp()});var re=!1;s.on("switch(customOpen)",function(e){re=e.elem.checked,e.elem.checked?$(".customTitle").slideDown():$(".customTitle").slideUp()}),$(".uploadBtn2 input").change(function(e){var n,t;$(this).val()&&(n=this,(t=new FormData).append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:i},data:t,success:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".customImgCont img").prop("src",e.data.src),$(".customImgCont").show()):o.msg(e.message,{icon:7})},error:function(){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("上传失败",{icon:2})}}))}),$(".delImgBtn2").click(function(){$(".customImgCont img").prop("src",""),$(".customImgCont").hide()});var me=[];var ue=null;var pe=getKeyTime().startTime,he=getKeyTime().endTime;l.render({elem:"#test8",range:!0,value:getKeyTime().keyTimeData,done:function(e){e=e.split(" - ");pe=e[0],he=e[1]}}),$(".replenishment .RQueryBtn").click(function(){timeFlag(pe,he)?o.msg("时间选择范围最多三个月",{icon:7}):ue.reload({where:{way:$('.replenishment select[name="shipSelect"]').val(),goods_Name:$('.replenishment input[name="replenishmentGoodName"]').val(),start_time:pe||null,end_time:he||null}})}),$(".replenishmentPushBtn").click(function(){var i;timeFlag(pe,he)?o.msg("时间选择范围最多三个月",{icon:7}):($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(i=new XMLHttpRequest).open("GET","".concat(vApi,"/excelReplenish?startDate=").concat(pe,"&endDate=").concat(he,"&machineId=").concat(r.machineId,"&way=").concat($('.replenishment select[name="shipSelect"]').val(),"&goods_Name=").concat($('.replenishment input[name="replenishmentGoodName"]').val()),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"(").concat(r.number,")补货记录(").concat(pe,"-").concat(he,").xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send())});var ge=getKeyTime().startTime,fe=getKeyTime().endTime;l.render({elem:"#test10",range:!0,value:getKeyTime().keyTimeData,done:function(e){e=e.split(" - ");ge=e[0],fe=e[1]}});var ve=null;$(".editQueryBtn").click(function(){timeFlag(ge,fe)?o.msg("时间选择范围最多三个月",{icon:7}):ve.reload({where:{goods_Name:$('.price input[name="priceGoodName"]').val(),startDate:ge||null,endDate:fe||null}})}),$(".editPircePushBtn").click(function(){var i;timeFlag(ge,fe)?o.msg("时间选择范围最多三个月",{icon:7}):($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(i=new XMLHttpRequest).open("GET","".concat(vApi,"/excelPriceRecord?startDate=").concat(ge,"&endDate=").concat(fe,"&machineId=").concat(r.machineId,"&goods_Name=").concat($('.price input[name="priceGoodName"]').val()),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"(").concat(r.number,")修改价格记录(").concat(ge,"-").concat(fe,").xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send())});var $e=null;var ye=getKeyTime().startTime,ke=getKeyTime().endTime;l.render({elem:"#test9",range:!0,value:getKeyTime().keyTimeData,done:function(e){e=e.split(" - ");ye=e[0],ke=e[1]}}),$(".openDoorRecord .opeQuery").click(function(){timeFlag(ye,ke)?o.msg("时间选择范围最多三个月",{icon:7}):$e.reload({where:{start_time:ye||null,end_time:ke||null}})}),$(".openDoorPushBtn").click(function(){var i;timeFlag(ye,ke)?o.msg("时间选择范围最多三个月",{icon:7}):($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(i=new XMLHttpRequest).open("GET","".concat(vApi,"/excelDoorRecord?startDate=").concat(ye,"&endDate=").concat(ke,"&machineId=").concat(r.machineId),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"(").concat(r.number,")开门记录(").concat(ye,"-").concat(ke,").xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send())}),l.render({elem:"#test101"});var Ie=null;$(".invoicePushBtn").click(function(){loadingAjax("/machine/getGoodReplenish","post",JSON.stringify({machineId:r.machineId}),sessionStorage.token,"","",o).then(function(e){var t;0!=(Ie=e.data).good_info.length?(e=Ie.good_info,t="",e.forEach(function(e,n){t+='<li class="detaillHeader">\n                        <div class="headerIndex1">\n                            <label for="">'.concat(n+1,'</label>\n                        </div>\n                        <div class="headerGoods">\n                            <label for="">').concat(e.goodName,'</label>\n                        </div>\n                        <div class="headerNum oldNums">\n                            \x3c!-- <label for="">原机货数</label> --\x3e\n                            <input type="number" name="oloNum" value="').concat(e.oldCount,'" disabled>\n                        </div>\n                        <div class="headerNum reNums">\n                            \x3c!-- <label for="">应补货数</label> --\x3e\n                            <input type="number" name="shouldName" value="').concat(e.replenish,'">\n                        </div>\n                        <div class="headerNum newNums">\n                            <input type="number" name="newNum" disabled value="').concat(e.newCount,'">\n                        </div>\n                        <div class="headerNum inNums">\n                            <input type="number" name="panelNam" value="').concat(e.showCount,'">\n                        </div>\n                        <div class="headerNum totalNums">\n                            <input type="number" name="totalNum" disabled value="').concat(e.replenish+e.showCount,'">\n                        </div>\n                     </li>')}),$(".detaillBody").html(t),$(".supplierName").html(Ie.supplier+"商品调拨(补货)单"),$('.repairInvoiceBody input[name="iMachineName"]').val("".concat(Ie.info,"(").concat(Ie.number,")")),$('.repairInvoiceBody input[name="supplier"]').val(Ie.supplier),$('.repairInvoiceBody input[name="supplyName"]').val(Ie.supplyName),$('.repairInvoiceBody input[name="supplyPhone"]').val(Ie.supplyPhone),$('.repairInvoiceBody input[name="checkFlagName"]').val(Ie.checkFlagName),$('.repairInvoiceBody input[name="acceptanceName"]').val(Ie.acceptanceName),$('.repairInvoiceBody input[name="acceptancePhone"]').val(Ie.acceptancePhone),$('.repairInvoiceBody input[name="wareManagement"]').val(Ie.wareManagement),$('.repairInvoiceBody input[name="operator"]').val(Ie.operator),$('.repairInvoiceBody input[name="consignee"]').val(Ie.consignee),popupShow("repairInvoice","repairInvoiceBox")):o.msg("未查询到缺货商品",{icon:7})}).catch(function(e){o.msg(e.message,{icon:7})})});var we=1;$(".detaillBody").on("input",'input[name="shouldName"]',function(){if(!/^\d*$/.test($(this).val()))return o.msg("只能输入正整数",{icon:7}),void $(this).val(we);we=$(this).val(),$(this).parent().siblings(".newNums").children().val(Number(we)+Number($(this).parent().siblings(".oldNums").children().val())),$(this).parent().siblings(".totalNums").children().val(Number(we)+Number($(this).parent().siblings(".inNums").children().val()))});var Ne=1;$(".detaillBody").on("input",'input[name="panelNam"]',function(){if(!/^\d*$/.test($(this).val()))return o.msg("只能输入正整数",{icon:7}),void $(this).val(Ne);Ne=$(this).val(),$(this).parent().siblings(".totalNums").children().val(Number(Ne)+Number($(this).parent().siblings(".reNums").children().val()))}),$(".repairInvoiceFooter .ReBtn").click(function(){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");for(var e=[],n=0;n<Ie.good_info.length;n++){var t={goodName:Ie.good_info[n].goodName,newCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="newNum"]').val()),oldCount:Ie.good_info[n].oldCount,replenish:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="shouldName"]').val()),showCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="panelNam"]').val()),totalCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="totalNum"]').val()),id:n+1};e.push(t)}var a=JSON.stringify({machineName:$('.repairInvoiceBody input[name="iMachineName"]').val(),deliverTime:$("#test101").val(),supplier:$('.repairInvoiceBody input[name="supplier"]').val(),supplyName:$('.repairInvoiceBody input[name="supplyName"]').val(),supplyPhone:$('.repairInvoiceBody input[name="supplyPhone"]').val(),checkFlagName:$('.repairInvoiceBody input[name="checkFlagName"]').val(),acceptanceName:$('.repairInvoiceBody input[name="acceptanceName"]').val(),acceptancePhone:$('.repairInvoiceBody input[name="acceptancePhone"]').val(),wareManagement:$('.repairInvoiceBody input[name="wareManagement"]').val(),operator:$('.repairInvoiceBody input[name="operator"]').val(),consignee:$('.repairInvoiceBody input[name="consignee"]').val(),number:Ie.number,good_info:e}),i=new XMLHttpRequest;i.open("POST","".concat(vApi,"/machine/exportGoodReplenish"),!0),i.setRequestHeader("token",sessionStorage.token),i.setRequestHeader("Content-Type","application/json;charset=utf-8"),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(Ie.supplier,"商品调拨（补货）单.xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t),popupHide("repairInvoice","repairInvoiceBox")):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send(a)}),$(".rCancelBtn").click(function(){popupHide("repairInvoice","repairInvoiceBox")}),$(".clearingBtn").click(function(){o.confirm("确定清除货道故障？",function(e){o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/clearLockMachineWay","post",JSON.stringify({machineId:r.machineId}),sessionStorage.token,"mask","","",o).then(function(e){o.msg(e.message,{icon:1}),W(r.machineId)}).catch(function(e){o.msg(e.message,{icon:2})})})}),$(".pushMachineBtn").click(function(){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");new Date;var i=new XMLHttpRequest;i.open("GET","".concat(vApi,"/excelMachine?merchantId=").concat(sessionStorage.machineGoodsId),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(sessionStorage.machineName,"售货机列表.xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send()});var Ce=null;var be=null;$(".addpanelBtn").click(function(){be=1,$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",""),$('.addPanelCont input[name="panelGoodsName"]').val(""),$('.addPanelCont input[name="panelGoodsNum"]').val(""),popupShow("addPanelCont","addPanelBox")}),$(".relative1").click(function(){popupShow("goodsCont","goodsBox"),U?U.reload({where:{condition:sessionStorage.machineGoodsId}}):K()}),$(".addPanelCont .panelAddBtn").click(function(){var e,n;$('.addPanelCont input[name="panelGoodsName"]').val()&&$('.addPanelCont input[name="panelGoodsNum"]').val()?(e=1==be?"/machine/newDisplayGood":"/machine/updateDisplayGoodCount",n=JSON.stringify({machineId:r.machineId,goodId:Number($('.addPanelCont input[name="panelGoodsName"]').attr("IVal")),goodCount:Number($('.addPanelCont input[name="panelGoodsNum"]').val())}),loadingAjax(e,"post",n,sessionStorage.token,"mask","addPanelCont","addPanelBox",o).then(function(e){o.msg(e.message,{icon:1}),Ce.reload({where:{}}),$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",""),$('.addPanelCont input[name="panelGoodsName"]').val(""),$('.addPanelCont input[name="panelGoodsNum"]').val("")}).catch(function(e){o.msg(e.message,{icon:7})})):o.msg("带*为必填",{icon:7})}),$(".addPanelCont .addPanelCance").click(function(){popupHide("addPanelCont","addPanelBox")}),t.on("tool(panelTable)",function(n){console.log(n),"del"==n.event?o.confirm("确定移除？",function(e){o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");e=JSON.stringify({machineId:r.machineId,goodId:n.data.goods_Id});loadingAjax("/machine/removeDisplayGoodCount","post",e,sessionStorage.token,"mask","","",o).then(function(e){o.msg(e.message,{icon:1}),Ce.reload({where:{}})}).catch(function(e){o.msg(e.message,{icon:2})})}):"edit"==n.event&&(be=2,$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",n.data.goods_Id),$('.addPanelCont input[name="panelGoodsName"]').val(n.data.goods_Name),$('.addPanelCont input[name="panelGoodsNum"]').val(n.data.goodCount),popupShow("addPanelCont","addPanelBox"))}),$(".undoAisleBtn").click(function(){o.confirm("确定撤销货道?",function(e){o.close(e),Q=2,sessionStorage.independentPass?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/removeGoodWay","post",JSON.stringify({machineId:r.machineId}),sessionStorage.token,"mask","","").then(function(e){o.msg(e.message,{icon:1}),W(r.machineId)}).catch(function(e){o.msg(e.message,{icon:2})})):popupShow("iPasswprd","passwordCont")})});$(".undoPushBtn").click(function(){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var i=new XMLHttpRequest;i.open("GET","".concat(vApi,"/excelRemove?machineId=").concat(r.machineId),!0),i.setRequestHeader("token",sessionStorage.token),i.responseType="blob",i.onload=function(e){var n,t,a;200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a=i.response,n="".concat(r.info,"撤货记录.xls"),(t=document.createElement("a")).download=n,t.style.display="none",a=new Blob([a]),t.href=URL.createObjectURL(a),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("服务器请求超时",{icon:2}))},i.send()});$(".goodsCont").on("mouseenter",".pic102",function(e){$("#pic101").attr("src",$(this).attr("src"));var n=new Image;n.onload=function(){$("#pic101").css({width:this.width>=this.height?"350px":"auto",height:this.height>this.width?"350px":"auto"}).fadeIn("fast"),this.onload=null},n.src=$(this).attr("src")}),$(".goodsCont").on("mouseleave",".pic102",function(){$("#pic101").hide()}),$("#pic101").mouseenter(function(){$("#pic101").show()}),$("#pic101").mouseleave(function(){$("#pic101").hide()})})},379:function(e,n){},95:function(e,n,t){e.exports=t.p+"image/4eb9f87dc4c0ea70f1e05eedb988cc11.png"}});