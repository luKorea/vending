/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,o=e[0],i=e[1],a=e[2],r=0,c=[];r<o.length;r++)n=o[r],Object.prototype.hasOwnProperty.call(p,n)&&p[n]&&c.push(p[n][0]),p[n]=0;for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t]);for(u&&u(e);c.length;)c.shift()();return d.push.apply(d,a||[]),s()}function s(){for(var e,t=0;t<d.length;t++){for(var n=d[t],o=!0,i=1;i<n.length;i++){var a=n[i];0!==p[a]&&(o=!1)}o&&(d.splice(t--,1),e=r(r.s=n[0]))}return e}var n={},p={30:0},d=[];function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=l,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var i=0;i<t.length;i++)e(t[i]);var u=o;d.push([153,0]),s()}({153:function(e,t,n){"use strict";n.r(t);t=n(417);layui.use(["table","form","layer","tree"],function(){var e=layui.table,t=layui.form,n=layui.layer,o=layui.tree,i=sessionStorage.machineID,a=e.render({elem:"#appList",url:"".concat(vApi,"/app/getAppVersionList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"version_code",width:180,title:"版本号",align:"center"},{field:"version_name",width:180,title:"版本名",align:"center"},{field:"apk_url",width:350,title:"下载地址",align:"center"},{field:"content",width:350,title:"描述",align:"center"},{field:"upload_user",width:150,title:"创建人",align:"center"},{field:"upload_time",width:180,title:"创建时间",align:"center",templet:function(e){return e.upload_time?timeStamp(e.upload_time):"-"}},{field:"operation",fixed:"right",right:0,width:150,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$(".addAppBtn").click(function(){popupShow("addAppCOnt","addAppBox")}),$(".addAppCOnt .addCancelBtn").click(function(){popupHide("addAppCOnt","addAppBox")});$('.relative input[name="uploadImg"]').change(function(e){var t,n;$(this).attr("indexFlag");$(this).val()&&($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,t=this.files[0],n=2097152,Math.ceil(t.size/n),new SparkMD5.ArrayBuffer)}),$(".footerBtn .RdetermineBtn").click(function(){var e=t.val("addAppVal");console.log(1),e.version_code&&e.version_name&&e.apk_url?e.AppMD?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content}),loadingAjax("/app/uploadApp","post",e,sessionStorage.token,"mask","addAppCOnt","addAppBox",n).then(function(e){console.log(e),n.msg(e.message,{icon:1}),a.reload({where:{}}),t.val("addAppVal",{version_code:"",version_name:"",apk_url:"",AppMD:"",content:""}),$(".uploadTitle label").html("未上传")}).catch(function(e){console.log(e),n.msg(e.message,{icon:2})})):n.msg("请上传App文件",{icon:7}):n.msg("带*为必填",{icon:7})});var r=null,c=null;e.on("tool(appList)",function(e){if(event.stopPropagation(),console.log(e),r=e.data,"operation"===e.event){if(c==e.data.id)return $(".ListOperation").fadeOut(),void(c=null);c=e.data.id,$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}}),$(".ListOperation .edit").click(function(){t.val("editAppVal",{version_code:r.version_code,version_name:r.version_name,apk_url:r.apk_url,AppMD:r.verify,content:r.content}),popupShow("editAppCont","editAppBox")}),$(".ListOperation .updataMachine").click(function(){l||(l=treeList(),o.reload("treelist",{data:l})),s=s||e.render({elem:"#machineList",url:"".concat(vApi,"/machine/getMachineList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{checkbox:!0},{field:"number",width:180,title:"售货机编号",align:"center",templet:function(e){return e.number||"-"}},{field:"info",width:180,title:"售货机名",align:"center",templet:function(e){return e.info?"<div>".concat(e.info,"</div>"):'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>'}},{field:"location",width:180,title:"地址",align:"center",templet:function(e){return e.location||" - "}},{field:"versions",width:200,align:"center",title:"当前版本(待升级版本)",templet:function(e){return"".concat(e.versions||"-","(").concat(e.appVersion||"-",")")}},{field:"merchantName",width:150,align:"center",title:"所属商户"}]],id:"mId",loading:!0,page:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}}),popupShow("machineListCOnt","machineBox")}),$(".editAppCont .editCancelBtn").click(function(){popupHide("editAppCont","editAppBox")}),$(".editAppCont .rdetermineBtn").click(function(){var e=t.val("editAppVal");e.version_code&&e.version_name&&e.apk_url?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content,id:r.id}),loadingAjax("/app/updateAppInfo","post",e,sessionStorage.token,"mask","editAppCont","editAppBox",n).then(function(e){n.msg(e.message,{icon:1}),a.reload({where:{}})}).catch(function(e){n.msg(e.message,{icon:2})})):n.msg("带*为必填",{icon:7})});var l=null;o.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:l,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),s.reload({where:{merchantId:e.data.id}}),i=e.data.id;for(var t=$("#test1 .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}});var s=null;$(".machineListCOnt .cancelBtn").click(function(){popupHide("machineListCOnt","machineBox")});var p=null,d=[];$(".machineListCOnt .pushBtn").click(function(){console.log(e.checkStatus("mId")),d=[],0<(p=e.checkStatus("mId")).data.length?n.confirm("确定编辑售货机App版本？",function(e){n.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");p.data.forEach(function(e,t){"".concat(e.machineId,","),d.push(e.machineId)});e=JSON.stringify({version_code:r.version_code,machineId:d,merchantId:Number(i)});loadingAjax("/app/updateMachineApp","post",e,sessionStorage.token,"mask","machineListCOnt","machineBox",n).then(function(e){console.log(e),n.msg(e.message,{icon:1});var t="";d.forEach(function(e){t+=e+","});e=JSON.stringify({machine:t});loadingAjax("/updateApp","post",e,sessionStorage.token,"","","",n).then(function(e){}).catch(function(e){})}).catch(function(e){n.msg(e.message,{icon:2})})}):n.msg("请选择需要修改app版本的售货机",{icon:7})}),$("body").click(function(){$(".ListOperation").fadeOut(),c=null})})},417:function(e,t){}});