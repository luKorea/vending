/*! 版权所有，翻版必究 */!function(c){function e(e){for(var t,n,o=e[0],a=e[1],i=e[2],s=0,r=[];s<o.length;s++)n=o[s],Object.prototype.hasOwnProperty.call(d,n)&&d[n]&&r.push(d[n][0]),d[n]=0;for(t in a)Object.prototype.hasOwnProperty.call(a,t)&&(c[t]=a[t]);for(p&&p(e);r.length;)r.shift()();return u.push.apply(u,i||[]),l()}function l(){for(var e,t=0;t<u.length;t++){for(var n=u[t],o=!0,a=1;a<n.length;a++){var i=n[a];0!==d[i]&&(o=!1)}o&&(u.splice(t--,1),e=s(s.s=n[0]))}return e}var n={},d={20:0},u=[];function s(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return c[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=c,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var a=0;a<t.length;a++)e(t[a]);var p=o;u.push([148,0]),l()}({148:function(e,t,n){"use strict";n.r(t);var t=n(410),w=null;layui.use(["table","form","layer","tree"],function(){var e=layui.table,o=layui.form,a=layui.layer,t=layui.tree,i=sessionStorage.token;$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".refreshBtn").click(function(){location.reload()}),w=e.render({elem:"#massageTable",method:"post",url:"".concat(vApi,"/notices/getHistoryMsg"),contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"title",width:200,title:"消息标题",align:"center"},{field:"name",width:200,title:"状态",align:"center",templet:function(e){return 0==e.is_read?"未读":"已读"}},{field:"create_user",width:230,title:"创建人",align:"center",templet:function(e){return"<div>".concat(e.usName,"</div><div>(").concat(e.um,")</div>")}},{field:"create_time",width:200,title:"创建时间",align:"center",templet:function(e){return e.create_time?timeStamp(e.create_time):"-"}}]],id:"messageId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{type:1},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}});var n=new window.wangEditor("#addWangEditor");n.customConfig.customUploadImg=function(e,t){console.log(e);var n=new FormData;n.append("file",e[0]),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,timeout:1e4,headers:{token:i},data:n,success:function(e){0==e.code?t(e.data.src):a.msg(e.message,{icon:7})},error:function(){a.msg("上传失败",{icon:2})}})},n.create(),$(".pushMessageCont .chooseUserBtn").click(function(){l||(l=t.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:s,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),d.reload({where:{condition:e.data.id}}),r=e.data.id,c=e.data.title;for(var t=$("#test1 .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}}),d=e.render({elem:"#userList",url:"".concat(vApi,"/user/findUser"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{checkbox:!0},{field:"userName",width:180,title:"用户名",align:"center"},{field:"name",width:150,title:"姓名",align:"center"},{field:"open",width:150,title:"状态",align:"center",templet:function(e){return 0==e.open?"不启用":"启用"}},{field:"roleSign",width:150,align:"center",title:"售货机管理员",templet:function(e){return 0==e.roleSign?"否":"是"}},{field:"alias",width:250,title:"用户编号",align:"center"},{field:"phone",width:150,title:"手机号",align:"center"},{field:"merchantName",width:150,title:"所属商户",align:"center"}]],id:"userId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(e){console.log(g),p=[],200==e.code&&e.data.forEach(function(e){for(var t in p.push(e.uuid),g){var n=g[t];e.uuid==n&&($(".userContent tr[data-index="+t+'] input[type="checkbox"]').prop("checked",!0),o.render())}})}})),popupShow("userContent","userBox")});var s=treeList(),r=sessionStorage.machineID,c=s[0]?s[0].title:"",l=null;0==s.length?$(".addPushBtn").hide():$(".addPushBtn").show();var d=null;var u,p=[],g=[];function m(e,t){loadingAjax("/notices/addMessage","post",e,sessionStorage.token,"mask","pushMessageCont","pushMessageBox",a).then(function(e){a.msg(e.message,{icon:1}),popupHide("pushMessageCont","pushMessageBox"),1==t?h(p):2==t&&h(g),g=[],$('.pushMessageCont input[name="title"]').val(""),$(".chooseTitle").html("未选择"),n.txt.html(""),f&&f.reload({where:{}})}).catch(function(e){console.log(e),a.msg(e.message,{icon:2})})}$(".userContent .cancelBtn").click(function(){popupHide("userContent","userBox")}),e.on("checkbox(userList)",function(e){var t;console.log(e.data),"all"==e.type?(console.log(g),e.checked?(p.forEach(function(e){g.includes(e)||g.push(e)}),console.log(g)):(t=[],g.forEach(function(e){p.includes(e)||t.push(e)}),g=t)):e.checked?g.push(e.data.uuid):g.splice(g.indexOf(e.data.uuid),1)}),$(".userContent .confirmBtn").click(function(){u=g,popupHide("userContent","userBox"),0<u.length?$(".chooseTitle").html("已选择"):$(".chooseTitle").html("未选择")}),$(".pushMessageCont .cancelBtn").click(function(){popupHide("pushMessageCont","pushMessageBox")}),$(".addPushBtn").click(function(){popupShow("pushMessageCont","pushMessageBox")}),$(".pushMessageCont .confirmBtn").click(function(){var t;$('.pushMessageCont input[name="title"]').val()?11<n.txt.html().length?0==g.length?(t=JSON.stringify({title:$('.pushMessageCont input[name="title"]').val(),content:n.txt.html(),merchantId:0==g.length?Number(r):""}),a.confirm("您没有选择用户,消息将发送给".concat(c,"商户的所有用户"),function(e){a.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),m(t,1)})):(t=JSON.stringify({title:$('.pushMessageCont input[name="title"]').val(),content:n.txt.html(),uuid:g}),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),m(t,2)):a.msg("公告详情最少五个字",{icon:7}):a.msg("带*未必填",{icon:7})}),$(".queryBtn").click(function(){w.reload({where:{keyword:$(".KyeText").val()}})});function h(e){console.log(e),e.forEach(function(e){e=JSON.stringify({uid:e,msg:"消息通知",tag:3});loadingAjax("/pushWebMsg","post",e,sessionStorage.token).then(function(e){console.log(e)}).catch(function(e){console.log(e)})})}e.on("row(massageTable)",function(e){e=e.data;0==e.is_read&&function(e){e=JSON.stringify({message_id:e});loadingAjax("/notices/readMessage","post",e,sessionStorage.token,"","","",a).then(function(e){w.reload({where:{}}),window.parent.messageFunList()}).catch(function(e){console.log(e),a.msg("阅读消息失败",{icon:2})})}(e.id),$(".messageDetails .playHeader span").html("".concat(e.title)),$(".messageDetails .detailsHtml ").html(e.content),popupShow("messageDetails","detailsBox")});var f=null;$(".messageListBtn").click(function(){f=f||e.render({elem:"#massagePushList",method:"post",url:"".concat(vApi,"/notices/getHistoryMsg"),contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"title",width:200,title:"消息标题",align:"center"},{field:"create_user",width:230,title:"创建人",align:"center"},{field:"is_read",width:150,title:"接收人",align:"center",templet:function(e){return"<div>".concat(e.name,"</div><div>(").concat(e.username,")</div>")}},{field:"create_time",width:200,align:"center",title:"创建时间",templet:function(e){return e.create_time?timeStamp(e.create_time):"-"}}]],id:"messageListID",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{type:0},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}}),popupShow("pushMessageList","pushMessageListBox")}),e.on("row(massagePushList)",function(e){e=e.data;$(".messageDetails .playHeader span").html("".concat(e.title)),$(".messageDetails .detailsHtml ").html(e.content),popupShow("messageDetails","detailsBox")})}),window.reloadFun=function(){w.reload({where:{}})}},410:function(e,t){}});