/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,o=e[0],a=e[1],i=e[2],r=0,c=[];r<o.length;r++)n=o[r],Object.prototype.hasOwnProperty.call(p,n)&&p[n]&&c.push(p[n][0]),p[n]=0;for(t in a)Object.prototype.hasOwnProperty.call(a,t)&&(l[t]=a[t]);for(u&&u(e);c.length;)c.shift()();return d.push.apply(d,i||[]),s()}function s(){for(var e,t=0;t<d.length;t++){for(var n=d[t],o=!0,a=1;a<n.length;a++){var i=n[a];0!==p[i]&&(o=!1)}o&&(d.splice(t--,1),e=r(r.s=n[0]))}return e}var n={},p={30:0},d=[];function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=l,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var a=0;a<t.length;a++)e(t[a]);var u=o;d.push([153,0]),s()}({153:function(e,t,n){"use strict";n.r(t);t=n(417);layui.use(["table","form","layer","tree"],function(){var e=layui.table,t=layui.form,f=layui.layer,n=layui.tree,o=sessionStorage.machineID,a=e.render({elem:"#appList",url:"".concat(vApi,"/app/getAppVersionList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"version_code",width:180,title:"版本号",align:"center"},{field:"version_name",width:180,title:"版本名",align:"center"},{field:"apk_url",width:350,title:"下载地址",align:"center"},{field:"content",width:350,title:"描述",align:"center"},{field:"upload_user",width:150,title:"创建人",align:"center"},{field:"upload_time",width:180,title:"创建时间",align:"center",templet:function(e){return e.upload_time?timeStamp(e.upload_time):"-"}},{field:"operation",fixed:"right",right:0,width:150,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$(".addAppBtn").click(function(){popupShow("addAppCOnt","addAppBox")}),$(".addAppCOnt .addCancelBtn").click(function(){popupHide("addAppCOnt","addAppBox")});var m;$('.relative input[name="uploadImg"]').change(function(t){var o,a,i,n,r,c,l,s,p=this,d=$(this).attr("indexFlag");function u(){var e=new FileReader;e.onload=l,e.onerror=s;var t=r*i,n=t+i>=a.size?a.size:t+i;e.readAsArrayBuffer(o.call(a,t,n))}$(this).val()&&($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=this.files[0],i=2097152,n=Math.ceil(a.size/i),r=0,c=new SparkMD5.ArrayBuffer,l=function(e){c.append(e.target.result),++r<n?u():(m=c.end(),console.log(100),console.log(r),console.log(n),$('input[name="AppMD"]').val(m),console.log(m),(e=new FormData).append("file",t.target.files[0]),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:token},data:e,success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?("add"==d?$('.addAppCOnt input[name="apk_url"]').val(e.data.src):(d="edit",$('.editAppCont input[name="apk_url"]').val(e.data.src)),f.msg("上传成功",{icon:1}),$(".uploadTitle label").html("已上传")):(f.msg("上传失败",{icon:2}),$(p).val(""))},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),f.msg("上传失败",{icon:2}),$(p).val("")}}))},s=function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),f.msg("上传文件失败"),$(p).val("")},u())}),$(".footerBtn .RdetermineBtn").click(function(){var e=t.val("addAppVal");console.log(1),e.version_code&&e.version_name&&e.apk_url?e.AppMD?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content}),loadingAjax("/app/uploadApp","post",e,sessionStorage.token,"mask","addAppCOnt","addAppBox",f).then(function(e){console.log(e),f.msg(e.message,{icon:1}),a.reload({where:{}}),t.val("addAppVal",{version_code:"",version_name:"",apk_url:"",AppMD:"",content:""}),$(".uploadTitle label").html("未上传")}).catch(function(e){console.log(e),f.msg(e.message,{icon:2})})):f.msg("请上传App文件",{icon:7}):f.msg("带*为必填",{icon:7})});var i=null,r=null;e.on("tool(appList)",function(e){if(event.stopPropagation(),console.log(e),i=e.data,"operation"===e.event){if(r==e.data.id)return $(".ListOperation").fadeOut(),void(r=null);r=e.data.id,$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}}),$(".ListOperation .edit").click(function(){t.val("editAppVal",{version_code:i.version_code,version_name:i.version_name,apk_url:i.apk_url,AppMD:i.verify,content:i.content}),popupShow("editAppCont","editAppBox")}),$(".ListOperation .updataMachine").click(function(){c||(c=treeList(),n.reload("treelist",{data:c})),l=l||e.render({elem:"#machineList",url:"".concat(vApi,"/machine/getMachineList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{checkbox:!0},{field:"number",width:180,title:"售货机编号",align:"center",templet:function(e){return e.number||"-"}},{field:"info",width:180,title:"售货机名",align:"center",templet:function(e){return e.info?"<div>".concat(e.info,"</div>"):'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>'}},{field:"location",width:180,title:"地址",align:"center",templet:function(e){return e.location||" - "}},{field:"versions",width:200,align:"center",title:"当前版本(待升级版本)",templet:function(e){return"".concat(e.versions||"-","(").concat(e.appVersion||"-",")")}},{field:"merchantName",width:150,align:"center",title:"所属商户"}]],id:"mId",loading:!0,page:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}}),popupShow("machineListCOnt","machineBox")}),$(".editAppCont .editCancelBtn").click(function(){popupHide("editAppCont","editAppBox")}),$(".editAppCont .rdetermineBtn").click(function(){var e=t.val("editAppVal");e.version_code&&e.version_name&&e.apk_url?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content,id:i.id}),loadingAjax("/app/updateAppInfo","post",e,sessionStorage.token,"mask","editAppCont","editAppBox",f).then(function(e){f.msg(e.message,{icon:1}),a.reload({where:{}})}).catch(function(e){f.msg(e.message,{icon:2})})):f.msg("带*为必填",{icon:7})});var c=null;n.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:c,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),l.reload({where:{merchantId:e.data.id}}),o=e.data.id;for(var t=$("#test1 .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}});var l=null;$(".machineListCOnt .cancelBtn").click(function(){popupHide("machineListCOnt","machineBox")});var s=null,p=[];$(".machineListCOnt .pushBtn").click(function(){console.log(e.checkStatus("mId")),p=[],0<(s=e.checkStatus("mId")).data.length?f.confirm("确定编辑售货机App版本？",function(e){f.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");s.data.forEach(function(e,t){"".concat(e.machineId,","),p.push(e.machineId)});e=JSON.stringify({version_code:i.version_code,machineId:p,merchantId:Number(o)});loadingAjax("/app/updateMachineApp","post",e,sessionStorage.token,"mask","machineListCOnt","machineBox",f).then(function(e){console.log(e),f.msg(e.message,{icon:1});var t="";p.forEach(function(e){t+=e+","});e=JSON.stringify({machine:t});loadingAjax("/updateApp","post",e,sessionStorage.token,"","","",f).then(function(e){}).catch(function(e){})}).catch(function(e){f.msg(e.message,{icon:2})})}):f.msg("请选择需要修改app版本的售货机",{icon:7})}),$("body").click(function(){$(".ListOperation").fadeOut(),r=null})})},417:function(e,t){}});