/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,a=e[0],o=e[1],i=e[2],r=0,s=[];r<a.length;r++)n=a[r],Object.prototype.hasOwnProperty.call(d,n)&&d[n]&&s.push(d[n][0]),d[n]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(l[t]=o[t]);for(m&&m(e);s.length;)s.shift()();return u.push.apply(u,i||[]),c()}function c(){for(var e,t=0;t<u.length;t++){for(var n=u[t],a=!0,o=1;o<n.length;o++){var i=n[o];0!==d[i]&&(a=!1)}a&&(u.splice(t--,1),e=r(r.s=n[0]))}return e}var n={},d={17:0},u=[];function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=l,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var t=window.webpackJsonp=window.webpackJsonp||[],a=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var m=a;u.push([134,0]),c()}({134:function(e,t,n){"use strict";n.r(t);t=n(382);layui.use(["table","form","layer","tree","util","transfer"],function(){tooltip(".refreshBtnList",{transition:!0,time:200});var e=layui.table,c=layui.layer,c=layui.layer,t=(layui.util,layui.tree),n=layui.transfer,d=sessionStorage.token,l=sessionStorage.UserId,u=e.render({elem:"#tableTest",url:"".concat(vApi,"/user/findUser"),method:"post",contentType:"application/json",headers:{token:d},cols:[[{field:"userName",width:180,title:"用户名",align:"center"},{field:"name",width:150,title:"姓名",align:"center"},{field:"open",width:150,title:"状态",align:"center",templet:function(e){return 0==e.open?"不启用":"启用"}},{field:"roleSign",width:150,align:"center",title:"终端管理员",templet:function(e){return 0==e.roleSign?"否":"是"}},{field:"alias",width:250,title:"用户编号",align:"center"},{field:"phone",width:150,title:"手机号",align:"center"},{field:"merchantName",width:200,title:"所属商户",align:"center"},{field:"addUser",width:150,title:"创建人",align:"center"},{field:"addTime",width:180,title:"创建时间",align:"center"},{field:"lastUser",width:150,title:"最后修改人",align:"center"},{field:"lastTime",width:180,title:"最后修改时间",align:"center"},{field:"operation",fixed:"right",align:"center",right:0,width:340,title:"操作",toolbar:"#barDemo"}]],id:"tableId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(e){b(),405==e.code&&$(".hangContent").show()}}),m=null;$(".queryBtnClick ").click(function(){u.reload({where:{conditionTwo:$('.mian input[name="keyMerchants"]').val()}})});var p=null;e.on("tool(test)",function(n){var a,o,i,e,r,s,l=n.data;p=n.data,console.log(n),m=l.uuid,"edit"===n.event?0!=w.length?("sysadmin"==l.userName?$(".switchListStatus").hide():$(".switchListStatus").show(),$('.inputWidth input[name="userName"]').prop("disabled",!0),$(".treeTest").show(),$(".OperationHeader span").html("编辑用户"),f=$(this).attr("typeID"),popupShow("MemberOperation","MemberContent"),h.val("information",{userName:l.userName,name:l.name,userPwd:"      ",DuserPwd:"      ",alonePwd:"      ",DalonePwd:"      ",phone:l.phone,cardId:l.cardId,startThe:l.open?"on":"",administrator:l.roleSign?"on":"",marchantsListname:l.merchantName}),t.reload("treelistEdit",{}),$('.terminal input[name="topmachantsVal"]').val(l.merchantId),h.render("select"),o=g,i="checkCont",r=(e=l).merchantId,s="",o.forEach(function(e,t){s+='<div>\n                     <input type="checkbox" '.concat(1!=r&&0==t?"disabled":"",'  name="').concat(e.id,'" title="').concat(e.name,'"lay-skin="primary" value="').concat(e.id,'"></input>\n                   </div>')}),$(".".concat(i)).empty(),$(".".concat(i)).html(s),$(".roleCont").show(),e.roles.forEach(function(e,t){for(var n=0;n<o.length;n++)e.id==o[n].id&&$(".".concat(i," input")).eq(n).prop("checked",!0)}),h.render("checkbox")):c.msg("服务器请求超时",{icon:7}):"delete"===n.event?c.confirm("确定删除？",function(t){$.ajax({type:"get",url:"".concat(vApi,"/user/deleteById"),headers:{token:d},data:{id:Number(l.uuid)},success:function(e){200==e.code?(c.msg(e.message,{icon:1}),n.del(),c.close(t),y(l.uuid)):403==e.code?window.parent.location.href="login.html":c.msg(e.message,{icon:2})}})}):"role"===n.event?0!=l.roles.length?(a="",l.roles.forEach(function(e,t){a+="<p>".concat(e.name,"</p>")}),$(".RoleListBody>div").empty(),$(".RoleListBody>div").html(a),popupShow("roleContList","RoleListBox")):c.msg("该用户没有配置角色",{icon:7}):"Status"==n.event?c.confirm(1==l.open?"确定禁用？":"确定启用？",function(e){var t=1==l.open?0:1;c.close(e);e=JSON.stringify({id:l.uuid,status:t});loadingAjax("/user/switchById","post",e,sessionStorage.token,"","","",c).then(function(e){c.msg(e.message,{icon:1}),u.reload({where:{}}),0==t&&y(l.uuid)}).catch(function(e){c.msg(e.message,{icon:7})})}):"stores"==n.event&&(0!=l.roleSign?C(n.data.uuid):c.msg("该用户不是终端管理员",{icon:7}))});var h=layui.form,f=null;$(".addBtn").click(function(){0!=w.length?(t.reload("treelistEdit",{}),$('.inputWidth input[name="userName"]').prop("disabled",!1),$(".treeTest").hide(),popupShow("MemberOperation","MemberContent"),f=$(this).attr("typeID"),m=null,$(".OperationHeader span").html("添加用户"),h.val("information",{userName:"",name:"",userPwd:"",alonePwd:"",phone:"",cardId:"",DalonePwd:"",DuserPwd:""}),$(".checkCont").empty(),$(".roleCont").hide()):c.msg("服务器请求超时",{icon:7})}),$(".cancel_btn").click(function(){popupHide("MemberOperation","MemberContent")}),$(".submit_btn").click(function(){var n=h.val("information"),e=null;if(n.userName&&n.name&&n.userPwd&&n.alonePwd&&n.phone&&n.marchantsListname)if(n.userName&&n.name&&n.phone&&n.marchantsListname)if(n.DuserPwd==n.userPwd)if(n.alonePwd==n.DalonePwd){if($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),"1"==f)e="".concat(vApi,"/user/saveUser");else{e="".concat(vApi,"/user/updateUser");var t,a=h.val("checkboxData"),o=[];for(t in a)o.push(Number(a[t]));console.log(o)}var i=null;v.forEach(function(e,t){n.topmachantsVal==e.id&&(i=e.alias)});var r=n.startThe?1:0,s=n.administrator?1:0;console.log(n),e&&$.ajax({type:"post",url:e,headers:{"Content-Type":"application/json",token:d},data:JSON.stringify({uid:m,username:n.userName,name:n.name,userPwd:"      "!=n.userPwd?hex_md5(n.userPwd):"",alonePwd:"      "!=n.alonePwd?hex_md5(n.alonePwd):"",phone:n.phone,cardId:n.cardId,open:r,roleSign:s,roleId:2==f?o:null,merchantId:Number(n.topmachantsVal),alias:i}),success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),200==e.code?(2==f&&(y(m),l==m&&(sessionStorage.machineID=n.marchantsListname)),u.reload({where:{}}),h.val("information",{userName:"",name:"",userPwd:"",alonePwd:"",phone:"",cardId:""}),$(".MemberOperation").fadeOut(),c.msg(e.message,{icon:1})):403==e.code?window.parent.location.href="login.html":c.msg(e.message,{icon:2})},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("请求服务器超时",{icon:2})}})}else c.msg("独立密码不一致",{icon:7});else c.msg("登录密码不一致",{icon:7});else c.msg("带*为必填",{icon:7});else c.msg("带*为必填",{icon:7})}),$('.listInput input[name="phone"]').blur(function(){var e=$(this).val();if(e&&!/^1[3456789]\d{9}$/.test(e))return c.msg("请填写正确的手机号码",{icon:7}),$(this).val(""),!1}),$('.listInput input[name="userPwd"]').blur(function(){passRegular(this,c)}),$('.listInput input[name="alonePwd"]').blur(function(){passRegular(this,c)});var g=null;$.ajax({type:"post",headers:{"Content-Type":"application/json",token:d},url:"".concat(vApi,"/role/findRole"),data:JSON.stringify({pageNum:1,pageSize:1e3}),success:function(e){200==e.code&&(g=e.data.list)},error:function(){c.msg("服务器请求超时",{icon:2})}}),h.on("select(stateSelect)",function(e){console.log(e.value),0==e.value?$('.checkCont input[name="100001"]').prop("disabled",!1):($('.checkCont input[name="100001"]').prop("checked",!1),$('.checkCont input[name="100001"]').prop("disabled",!0)),h.render("checkbox")});var v=merchantsListMian("");$(".sidebar i").click(function(){$(".left-mian").hide(),$(".onLeft").show()}),$(".onLeft").click(function(){$(this).hide(),$(".left-mian").show()});var w=null,a=w=treeList();function y(e){e=JSON.stringify({uid:e,msg:"用户信息发生变更，请重新登录！",tag:2});loadingAjax("/pushWebMsg","post",e,sessionStorage.token).then(function(e){}).catch(function(e){})}$('.terminal input[name="marchantsListname"]').val(a[0].title),$('.terminal input[name="topmachantsVal"]').val(a[0].id),$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$('.inputWidth input[name="userName"]').blur(function(){ChineseREgular(this,c)});t.render({elem:"#test1",id:"treelistAdd",showLine:!0,onlyIconControl:!0,isJump:!1,edit:!1,data:w,text:{defaultNodeName:"无数据",none:""},click:function(e){console.log(e),$('.terminal input[name="marchantsListname"]').val(e.data.title),$('.terminal input[name="topmachantsVal"]').val(e.data.id),u.reload({where:{condition:e.data.id+""}});for(var t=$("#test1 .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}}),t.render({elem:"#test2",id:"treelistEdit",showLine:!0,onlyIconControl:!0,isJump:!1,edit:!1,data:w,text:{defaultNodeName:"无数据",none:""},click:function(e){console.log(e),$('.terminal input[name="marchantsListname"]').val(e.data.title),$('.terminal input[name="topmachantsVal"]').val(e.data.id),1==e.data.id?$('.checkCont input[name="100001"]').prop("disabled",!1):($('.checkCont input[name="100001"]').prop("checked",!1),$('.checkCont input[name="100001"]').prop("disabled",!0)),h.render("checkbox");for(var t=$(".terminal .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}});var o=!0,i=!0,r=!0,s=!0;function b(){o?$(".addBtn").removeClass("hide"):$(".addBtn").addClass("hide"),i?$(".listEdit").removeClass("hide"):$(".listEdit").addClass("hide"),r?$(".del-btn").removeClass("hides"):$(".del-btn").addClass("hides"),s?$(".userMachine").removeClass("hides"):$(".userMachine").addClass("hides")}permissionsVal(389,390,397,451).then(function(e){o=e.addFlag,i=e.editFlag,r=e.delFlag,s=e.fourFlag,b()}).catch(function(e){c.msg("服务器请求超时",{icon:7})});var k=[],S=[];function C(e){loadingAjax("/user/getUserMachine","post",JSON.stringify({UUId:e}),sessionStorage.token).then(function(e){console.log(e),k=[],S=[],e.data.select.forEach(function(e,t){S.push(e.machineId)}),e.data.unSelect.concat(e.data.select).forEach(function(e,t){e={value:e.machineId,title:e.info||"(此为未命名的新售货机)"};k.push(e),console.log(k),console.log(S),function o(e,t){n.render({elem:"#test6",data:e,title:["未配置的售货机","已配置的售货机"],width:380,height:500,value:t,onchange:function(t,n){console.log(n);var a=[];c.confirm("确定修改配置？",function(e){t.forEach(function(e,t){S.push(e.value),a.push(e.value)}),c.close(e),console.log(n);var e=JSON.stringify({UUID:p.uuid,machineId:a,select:0==n?1:0});loadingAjax("/user/configUserMachine","post",e,sessionStorage.token,"mask","","",c).then(function(e){c.msg(e.message,{icon:1}),C(p.uuid)}).catch(function(e){c.msg(e.message,{icon:2}),o(k,S)}),console.log(e)},function(e){o(k,S)})}})}(k,S)}),0!=k.length||0!=S.length?popupShow("storesCont","storesBox"):c.msg("该用户所属商户没有售货机",{icon:7})}).catch(function(e){c.msg(e.message,{icon:2})})}$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(a)&&(w=e,t.reload("treelistAdd",{data:w}),u.reload({where:{condition:sessionStorage.machineID}})),c.msg("已刷新",{icon:1})})})},382:function(e,t){}});