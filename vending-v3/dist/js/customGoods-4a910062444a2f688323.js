/*! 版权所有，翻版必究 */!function(l){function e(e){for(var o,t,a=e[0],i=e[1],n=e[2],d=0,s=[];d<a.length;d++)t=a[d],Object.prototype.hasOwnProperty.call(c,t)&&c[t]&&s.push(c[t][0]),c[t]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(l[o]=i[o]);for(p&&p(e);s.length;)s.shift()();return g.push.apply(g,n||[]),r()}function r(){for(var e,o=0;o<g.length;o++){for(var t=g[o],a=!0,i=1;i<t.length;i++){var n=t[i];0!==c[n]&&(a=!1)}a&&(g.splice(o--,1),e=d(d.s=t[0]))}return e}var t={},c={7:0},g=[];function d(e){if(t[e])return t[e].exports;var o=t[e]={i:e,l:!1,exports:{}};return l[e].call(o.exports,o,o.exports,d),o.l=!0,o.exports}d.m=l,d.c=t,d.d=function(e,o,t){d.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.t=function(o,e){if(1&e&&(o=d(o)),8&e)return o;if(4&e&&"object"==typeof o&&o&&o.__esModule)return o;var t=Object.create(null);if(d.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:o}),2&e&&"string"!=typeof o)for(var a in o)d.d(t,a,function(e){return o[e]}.bind(null,a));return t},d.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(o,"a",o),o},d.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},d.p="";var o=window.webpackJsonp=window.webpackJsonp||[],a=o.push.bind(o);o.push=e,o=o.slice();for(var i=0;i<o.length;i++)e(o[i]);var p=a;g.push([135,0]),r()}({135:function(e,o,t){"use strict";t.r(o);t(371);layui.use(["table","form","layer","layedit","tree"],function(){var i=layui.jquery,e=layui.tree;i(".sidebar i").click(function(){i(".left-mian").hide(),i(".on-left").show()}),i(".on-left").click(function(){i(".left-mian").show(),i(".on-left").hide()});var t=layui.table,o=window.wangEditor,n=sessionStorage.token+"",d=t.render({elem:"#tableTest",url:"/api/goods/findAll",method:"post",contentType:"application/json",headers:{token:n},cols:[[{checkbox:!0},{field:"goods_images",width:100,title:"图片",templet:"#imgtmp"},{field:"goods_Core",width:120,title:"商品编号"},{field:"goods_Name",width:120,title:"商品名",color:"#409eff"},{field:"goods_Status",width:120,title:"商品状态 ",templet:function(e){return 1==e.goods_Status?"启用":"不启用"}},{field:"classifyName",width:120,title:"商品类目"},{field:"goods_Price",width:120,title:"销售价 ",templet:function(e){var o=e.goods_Price;if(e.goods_Price=Number(Number(e.goods_Price).toFixed(2)),isNaN(e.goods_Price))return o;var t=-1!==e.goods_Price.toString().indexOf(".")?e.goods_Price.toLocaleString():e.goods_Price.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),a=t.split(".");return 1==a.length?t+=".00":1==a[1].length&&(t+="0"),t}},{field:"goods_Cost",width:120,title:"成本价 ",templet:function(e){var o=e.goods_Cost;if(e.goods_Cost=Number(Number(e.goods_Cost).toFixed(2)),isNaN(e.goods_Cost))return o;var t=-1!==e.goods_Cost.toString().indexOf(".")?e.goods_Cost.toLocaleString():e.goods_Cost.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),a=t.split(".");return 1==a.length?t+=".00":1==a[1].length&&(t+="0"),t}},{field:"goods_Param",width:120,title:"规格说明 "},{field:"create_user",width:130,title:"创建人 "},{field:"goods_Time",width:200,title:"创建时间 ",templet:function(e){if(e.goods_Time){var o=new Date(e.goods_Time);return o.getFullYear()+"-"+(o.getMonth()+1)+"-"+(e=o.getDate())+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()}return""}},{field:"update_user",width:130,title:"最后修改人 "},{field:"update_time",width:200,title:"最后修改时间 ",templet:function(e){if(e.update_time){var o=new Date(e.update_time);return o.getFullYear()+"-"+(o.getMonth()+1)+"-"+(e=o.getDate())+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()}return""}},{field:"operation",position:"absolute",right:0,width:200,title:"操作",toolbar:"#barDemo"}]],id:"tableId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){O(),403==e.code?window.parent.location.href="login.html":405==e.code&&i(".hangContent").show()}}),a=layui.form;function s(e,o){i.ajax({type:"post",url:"/api/classify/findAll",data:JSON.stringify({pageNum:1,pageSize:1e4,merchantId:e}),headers:{"Content-Type":"application/json",token:n},success:function(e){var t;200==e.code&&(t='<option value="">全部</option>',1==o&&i("#addGoodsType").empty(),i("#EditGoodsType").empty(),i("#GoodsType").empty(),i.each(e.data.list,function(e,o){t+='<option value="'.concat(o.classifyId,'">').concat(o.classifyName,"</option>")}),1==o&&i("#addGoodsType").append(t),i("#EditGoodsType").append(t),i("#GoodsType").append(t),a.render("select"))}})}s(sessionStorage.machineID,1);var l="";a.on("select(mySelect)",function(e){l=e.value});var r="";a.on("select(stateSelect)",function(e){r=e.value}),i(".query-btnClick").click(function(){upPreferential(d,i(".KyeText").val(),l,r,i(".startingPrice").val(),i(".closingPrice").val())});var c,g=null,p=null,u=null;t.on("tool(test)",function(o){"add"===o.event?(u=o.data,console.log(u),i(".anUp").slideUp(),g!=u.goods_Id?(g=u.goods_Id,i(this).siblings(".anUp").slideDown()):g=null,i(".preferentialClick").click(function(){i(".anUp").slideUp(),i(".preferential").fadeIn(),i('input[name="GoodsName"]').val(u.goods_Name),i('input[name="goods_Price"]').val(u.goods_Price),i('input[name="vip_Price"]').val(u.vipPrice),i('input[name="integral"]').val(u.integral)})):"delete"===o.event?layer.confirm("确定删除？",function(e){Goodsdel(o.data.goods_Id,1,o,e)}):console.log(o)}),i(".upload-btn1").click(function(){h=p=1,w=0,b(),popupShow("GoodsMaterial","goodsMaterialBox")}),i("body").on("click",".GoodsInformation",function(){g=null,i(".anUp").slideUp(),popupShow("editor","editor-content"),a.val("EditValData",{goodsBarcode:u.goods_Core,goodsName:u.goods_Name,goodsType:u.classify_Id,goodsPrice:u.goods_Price,goodsCost:u.goods_Cost,goodsParam:u.goods_Param,goodsStatus:u.goods_Status}),console.log(u.goods_images),i("#editImg").attr("src",u.goods_images),m.txt.html(u.goods_Descript)}),i("body").on("click",".anUp .previewDetails",function(){g=null,i(".anUp").slideUp(),i(".Goods-wrap").addClass("fixed"),i(".reading").fadeIn(),i(".reading-header").css({left:i(".reading-contnet").offset().left+"px",top:i(".reading-contnet").offset().top+"px"}),i(".reading-box").html(u.goods_Descript),console.log(u.goods_Descript)});var m=new o("#editWangEditor");m.customConfig.uploadImgHooks={error:function(){layer.msg("图片上传失败")}},m.create(),i(".editDetermine-btn").click(function(){g=null;var e=a.val("EditValData");console.log(e),e.goodsBarcode&&e.goodsName&&e.goodsType&&e.goodsPrice&&e.goodsCost?i.ajax({type:"post",url:"/api/goods/updateGoods",headers:{"Content-Type":"application/json",token:n},data:JSON.stringify({goods_Id:u.goods_Id,goods_Core:e.goodsBarcode,goods_Name:e.goodsName,classify_Id:e.goodsType,brand:e.goodsBrand,goods_Price:e.goodsPrice,goods_Cost:e.goodsCost,goods_Param:e.goodsParam,goods_Status:e.goodsStatus,goods_Images:i("#editImg").attr("src"),goods_Descript:m.txt.html()}),success:function(e){200==e.code?(layer.msg("修改成功",{icon:1}),d.reload({where:{}}),i(".editor").fadeOut(),loadingAjax("/api/refreshGoods","post","",sessionStorage.token).then(function(e){}).catch(function(e){})):403==e.code?window.parent.location.href="login.html":layer.msg(e.message,{icon:2})}}):layer.msg("带*为必填",{icon:7})}),i(".preferential .cancel-btn").on("click",function(){i(".preferential").fadeOut(),g=null}),layui.layedit.set({uploadImage:{url:"/api/fileUpload",headers:{token:n},type:"post",code:200}}),i(".editor .cancel-btn").click(function(){i(".editor").fadeOut(),g=null});var f=null,h=null;i(".add-btn").click(function(){popupShow("addGoods","editor-content"),i(".tailoring-container").fadeIn()}),i(".addGoods .cancel-btn2").click(function(){popupHide("addGoods","editor-content"),i(".upload-demo2 .upload-list2").fadeOut()}),i(".upload-btn2").click(function(){p=2,h=1,w=0,b(),popupShow("GoodsMaterial","goodsMaterialBox")});var y=new o("#addWangEditor");y.customConfig.menus=["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","link","list","justify","quote","emoticon","image","table","video","undo","redo"],y.customConfig.uploadImgHooks={error:function(){layer.msg("图片上传失败")}};var v=null;i(".upVideo").click(function(e){v=i(this).attr("typeID"),popupShow("goodsmaterialVideo","materialBox"),k=k||t.render({elem:"#materiaVideoTable",method:"post",url:"/api/good_material/getGoodMaterial",contentType:"application/json",headers:{token:n},cols:[[{field:"name",width:120,title:"视频名"},{field:"publishTime",width:180,title:"发布时间"},{field:"addUser",width:150,title:"发布人"},{field:"operation",width:150,title:"操作",toolbar:"#barDemoVideo"}]],page:!0,id:"VideoListData",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{conditionFour:"1",conditionFive:"2",conditionSix:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}),y.create(),i(".determine-btn2").click(function(){var e=a.val("addValData");console.log(e),e.goodsBarcode&&e.goodsName&&e.goodsType&&e.goodsPrice&&e.goodsCost?f?i.ajax({type:"post",url:"/api/goods/saveGoods",headers:{"Content-Type":"application/json",token:n},data:JSON.stringify({goods_Core:e.goodsBarcode,goods_Name:e.goodsName,classify_Id:e.goodsType,brand:e.goodsBrand,goods_Price:e.goodsPrice,goods_Cost:e.goodsCost,goods_Param:e.goodsParam,goods_Status:e.goodsStatus,goods_Images:f,goods_Descript:y.txt.html(),merchantId:sessionStorage.machineID}),success:function(e){console.log(e),200==e.code?(i(".addGoods").fadeOut(),i(".upload-demo2 .upload-list2").fadeOut(),f=null,a.val("addValData",{goodsBarcode:"",goodsName:"",goodsType:"",goodsBrand:"",goodsPrice:"",goodsCost:"",goodsParam:""}),layer.msg("添加成功",{icon:1}),loadingAjax("/api/refreshGoods","post","",sessionStorage.token).then(function(e){}).catch(function(e){}),d.reload({where:{}}),y.txt.clear()):403==e.code?window.parent.location.href="login.html":layer.msg(e.message,{icon:2})}}):layer.msg("请上传商品图片",{icon:7}):layer.msg("带*为必填",{icon:7})}),i(".reading-btn").click(function(){i(".Goods-wrap").addClass("fixed"),i(".reading").fadeIn(),i(".reading-header").css({left:i(".reading-contnet").offset().left+"px",top:i(".reading-contnet").offset().top+"px"}),"add"==i(this).attr("id")?(i(".reading").fadeIn(),i(".reading-box").html(y.txt.html())):"edit"==i(this).attr("id")&&i(".reading-box").html(m.txt.html())}),i(".reading-down").click(function(){i(".Goods-wrap").removeClass("fixed"),i(".reading").fadeOut(),g=null}),i(".playHeader .close").click(function(){i(this).parent().parent().addClass("margin0"),i(this).parents(".maskContnet").fadeOut(),g=null});var w=null,_=null;function b(){_=t.render({elem:"#materiaImgTable",method:"post",url:"/api/good_material/getGoodMaterial",contentType:"application/json",headers:{token:n},cols:[[{field:"img",width:100,title:"图片",templet:"#materiaImgtmp"},{field:"name",width:120,title:"图片名"},{field:"publishTime",width:180,title:"发布时间"},{field:"addUser",width:150,title:"发布人"},{field:"operationa",right:0,width:150,title:"操作",toolbar:"#materiaImg",fixed:"right"}]],page:!0,id:"ImgListData",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},where:{conditionFour:w,conditionFive:"2",conditionSix:sessionStorage.machineID},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}i(".materialKeyCont .queryBtnClick").click(function(){console.log(i('.materialKeyCont input[name="KyeText"]').val()),_.reload({where:{conditionFour:w,conditionFive:"2",conditionThree:i('.materialKeyCont input[name="KyeText"]').val()}})}),i(".goodsmaterialVideo .queryBtnClick").click(function(){k.reload({where:{conditionFour:"0",conditionFive:"2",conditionThree:i('.goodsmaterialVideo input[name="KyeText"]').val()}})}),t.on("tool(materiaImgTable)",function(e){console.log(e),console.log(h,f),1==h?2==p?(f=e.data.img,i("#GoodsImg").attr("src",f),i(".upload-demo2 .upload-list2").fadeIn()):(c=e.data.img,i("#editImg").attr("src",c)):2==p?11<y.txt.html().length?y.txt.append('<p><img src="'.concat(e.data.img,'"></img></p>')):y.txt.html('<p><img src="'.concat(e.data.img,'"></img></p>')):11<m.txt.html().length?m.txt.append('<p><img src="'.concat(e.data.img,'"></img></p>')):m.txt.html('<p><img src="'.concat(e.data.img,'"></img></p>')),popupHide("GoodsMaterial","goodsMaterialBox")});var k=null;t.on("tool(materiaVideoTable)",function(e){console.log(e),"preview"==e.event?(popupShow("materialPreview","previewBox"),i(".perviewBody video").attr("src",e.data.img),console.log(v)):(console.log(v),2==v?11<y.txt.html().length?y.txt.append('<div><video src="'.concat(e.data.img,'"></video></div>')):y.txt.html('<div><video src="'.concat(e.data.img,'"></video></div>')):11<m.txt.html().length?m.txt.append('<div><video src="'.concat(e.data.img,'"></video></div>')):m.txt.html('<div><video src="'.concat(e.data.img,'"></video></div>')),popupHide("goodsmaterialVideo","materialBox"))}),i(".upImg").click(function(){h=i(this).attr("contType"),p=i(this).attr("goodsIndex"),w=2,console.log(h,p),popupShow("GoodsMaterial","goodsMaterialBox"),b()}),i(".refreshBtn").click(function(){location.reload()});var x,S=x=treeList();console.log(S),treeFun(e,"testGoods",d,S,"condition","goodsClass",s);var I=null;var C,N=null;i(".pushGoodsBtn").click(function(){N=t.checkStatus("tableId"),console.log(N),0<N.data.length?(leg.tree({ele:".treeList",data:x,cascade:!1}),popupShow("chooseLower","chooseBox"),i.each(i(".treeList input"),function(){N.data[0].merchantId!=i(this).val()||i(this).prop("disabled",!0)})):layer.msg("请选择需要推送的商品",{icon:7})});var T=null;i(".determineBtn").click(function(){T=leg.getCheckedNodes().map(Number),console.log(leg.getCheckedNodes()),0!=T.length?(popupShow("PushMandatory","MandatoryBox"),console.log(N)):layer.msg("请选择要推送的商户",{icon:7})}),i(".mandatroFooter div").click(function(){var a=[];C=i(this).attr("Ptype"),i(".mask").fadeIn(),i(".maskSpan").addClass("maskIcon"),N.data.forEach(function(e,o){var t={className:e.classifyName,goodsId:e.goods_Id};a.push(t)});var e=JSON.stringify({goods:a,merchantId:sessionStorage.machineID,mid:T,type:C});loadingAjax("/api/goods/sendGoods","post",e,n,"mask","chooseLower","chooseBox",layer).then(function(e){console.log(e),popupHide("PushMandatory","MandatoryBox"),layer.msg(e.message,{icon:1})}).catch(function(e){i(".mask").fadeOut(),i(".maskSpan").removeClass("maskIcon"),popupHide("PushMandatory","MandatoryBox"),layer.msg(e.message,{icon:2})})}),i(".chooseFooter .chooseCan").click(function(){popupHide("chooseLower","chooseBox")}),i(".pushListBtn").click(function(){popupShow("topGoodsList","topBox"),I=I||t.render({elem:"#parentTableTest",url:"/api/goods/getSendHistory",method:"post",height:500,contentType:"application/json",headers:{token:n},cols:[[{type:"checkbox"},{field:"goods_images",width:80,title:"图片",templet:"#Listimgtmp"},{field:"goods_Name",width:150,title:"商品名",color:"#409eff"},{field:"classifyName",width:160,title:"商品类目"},{field:"tempMerchant",width:160,title:"商品所属商户"},{field:"topMerchant",width:160,title:"推送商户"},{field:"targetMerchant",width:160,title:"接收商户"},{field:"goods_Param",width:130,title:"接收状态 ",templet:function(e){return 0==e.received?"未接收":"已接收"}},{field:"sendTime",width:200,title:"推送时间 ",templet:function(e){var o=new Date(e.sendTime);return o.getFullYear()+"-"+(o.getMonth()+1)+"-"+(e=o.getDate())+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()}}]],id:"parentTableId",page:!0,loading:!0,limits:[10,20,50],request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineID,conditionFour:"0"},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html");e.data.list;for(var o in e.data){var t=e.data[o];t.childMerchantId==sessionStorage.machineID&&1!=t.received||(i(".list_table1 tr[data-index="+o+'] input[type="checkbox"]').prop("disabled",!0),a.render())}}})}),i(".topBody .pushQueryBtn").click(function(){I.reload({where:{conditionTwo:i('.topBody select[name="mandatory"]').val(),conditionThree:i('.topBody select[name="receiveStatus"]').val(),conditionFour:i('.topBody select[name="receiveType"]').val(),goods_Name:i('.topBody input[name="KyeText"]').val()}})}),i(".topBody .pushGoodsListBtn").click(function(){var e=t.checkStatus("parentTableId");console.log(e);var a=[];if(0<e.data.length){if(e.data.forEach(function(e,o){var t;e.childMerchantId==sessionStorage.machineID&&0==e.received&&(t={className:e.classifyName,goodsId:e.goods_Id,merchantId:sessionStorage.machineID},a.push(t))}),!(0<a.length))return void layer.msg("没有能接收的商品",{icon:7});i(".mask").fadeIn(),i(".maskSpan").addClass("maskIcon");var o=JSON.stringify({goods:a,merchantId:sessionStorage.machineID});loadingAjax("/api/goods/forwardGoods","post",o,sessionStorage.token,"mask","topGoodsList","topBox",layer).then(function(e){console.log(e),layer.msg(e.message,{icon:1}),d.reload({where:{}}),I.reload({where:{}})}).catch(function(e){i(".mask").fadeOut(),i(".maskSpan").removeClass("maskIcon"),layer.msg(e.message,{icon:2})})}else layer.msg("请选择接收的商品",{icon:7})}),i("body").bind("keydown",function(e){116==e.keyCode&&(e.preventDefault(),location.reload())});var P=!0,B=!0,D=!0,G=!0,M=!0;function O(){P?i(".add-btn").removeClass("hide"):i(".add-btn").addClass("hide"),B?i(".GoodsInformation").removeClass("hide"):i(".GoodsInformation").addClass("hide"),D?i(".del-btn").removeClass("hide"):i(".del-btn").addClass("hide"),G?i(".pushGoodsBtn").removeClass("hide"):i(".pushGoodsBtn").addClass("hide"),M?i(".pushListBtn").removeClass("hide"):i(".pushListBtn").addClass("hide")}permissionsVal(377,378,375,416,415).then(function(e){P=e.addFlag,B=e.editFlag,D=e.delFlag,G=e.fourFlag,M=e.fiveFlag,O()}).catch(function(e){layer.msg("服务器请求超时",{icon:7})})})},371:function(e,o){}});