/*! 版权所有，翻版必究 */!function(r){function e(e){for(var a,t,n=e[0],i=e[1],p=e[2],o=0,d=[];o<n.length;o++)t=n[o],Object.prototype.hasOwnProperty.call(c,t)&&c[t]&&d.push(c[t][0]),c[t]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a]);for(s&&s(e);d.length;)d.shift()();return l.push.apply(l,p||[]),y()}function y(){for(var e,a=0;a<l.length;a++){for(var t=l[a],n=!0,i=1;i<t.length;i++){var p=t[i];0!==c[p]&&(n=!1)}n&&(l.splice(a--,1),e=o(o.s=t[0]))}return e}var t={},c={24:0},l=[];function o(e){if(t[e])return t[e].exports;var a=t[e]={i:e,l:!1,exports:{}};return r[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=r,o.c=t,o.d=function(e,a,t){o.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(a,e){if(1&e&&(a=o(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var n in a)o.d(t,n,function(e){return a[e]}.bind(null,n));return t},o.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(a,"a",a),a},o.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],n=a.push.bind(a);a.push=e,a=a.slice();for(var i=0;i<a.length;i++)e(a[i]);var s=n;l.push([148,0]),y()}({148:function(e,a,t){"use strict";t.r(a);a=t(410);layui.use(["table","form","layer","tree"],function(){tooltip(".refreshBtnList",{transition:!0,time:200});var e=layui.table,i=layui.layer,i=layui.layer,a=(layui.util,layui.tree),p=layui.form,t=null,o=e.render({elem:"#payList",url:"/api/pay/getPayParam",method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"1",width:80,title:"",templet:"#imgtmp",event:"rank",align:"center"},{field:"rank",width:80,title:"排序",align:"center"},{field:"payName",width:180,title:"支付类型",align:"center"},{field:"app_id",width:300,title:"微信公众号id/支付宝商户id",align:"center"},{field:"merchantName",width:250,title:"所属商户",align:"center"},{field:"payee",width:280,title:"收款方",align:"center"},{field:"update_user",width:200,title:"最后修改人",align:"center"},{field:"update_time",width:250,title:"最后修改时间",align:"center",templet:function(e){return e.update_time?timeStamp(e.update_time):"-"}},{field:"operation",right:0,width:150,title:"操作",toolbar:"#barDemo",fixed:"right"}]],id:"tablePayId",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:Number(sessionStorage.machineID)},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){t=e.data,403==e.code&&(window.parent.location.href="login.html")}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()});var n=null;e.on("tool(payList)",function(e){n=e.data,console.log(n),"edit"==e.event?("微信"==n.payName?($(".changePay .WeChat").show(),$(".changePay .Alipay").hide()):"支付宝"==n.payName?($(".changePay .WeChat").hide(),$(".changePay .Alipay").show()):($(".changePay .WeChat").hide(),$(".changePay .Alipay").hide()),p.val("SetPay",{typeIndex:n.payType,payee:n.payee,officialId:"微信"==n.payName?n.app_id:"",MerchantsId:"微信"==n.payName?n.mchId:"",app_key:"微信"==n.payName?n.app_key:"",MerchantsKey:"微信"==n.payName?n.app_private_key:"",aliPayId:"支付宝"==n.payName?n.app_id:"",alipay_public_key:"支付宝"==n.payName?n.alipay_public_key:"",app_private_key:"支付宝"==n.payName?n.app_private_key:""}),popupShow("changePay","changeBox")):"del"==e.event?i.confirm("确定删除？",function(e){i.close(e);e=JSON.stringify({merchantId:Number(d),id:n.id});loadingAjax("/api/pay/deletePayParam","post",e,sessionStorage.token,"","","",i).then(function(e){i.msg(e.message,{icon:1}),o.reload({where:{}})}).catch(function(e){i.msg(e.message,{icon:2})})}):"rank"==e.event&&1!=e.data.rank&&(console.log(e),console.log(t),e=JSON.stringify({merchantId:Number(d),topId:e.data.id,bottomId:t[e.data.rank-2].id}),loadingAjax("/api/pay/sortPayParam","post",e,sessionStorage.token,"","","",i).then(function(e){i.msg("修改成功",{icon:1}),o.reload({where:{}})}).catch(function(e){console.log(res),i.msg("修改失败",{icon:1})}))}),$(".changeBody .cancel_btn").click(function(){popupHide("changePay","changeBox")}),$(".changeBody .submit_btn").click(function(){var e,a,t=p.val("SetPay");if("2"==t.typeIndex){if(!(t.payee&&t.officialId&&t.MerchantsId&&t.app_key&&t.MerchantsKey))return void i.msg("带*为必填",{icon:7})}else if("1"==t.typeIndex){if(!(t.payee&&t.aliPayId&&t.alipay_public_key&&t.app_private_key))return void i.msg("带*为必填",{icon:7})}else if(!t.payee||!t.aliPayId)return void i.msg("带*为必填",{icon:7});$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2==t.typeIndex?(e=JSON.stringify({app_id:t.officialId,mchId:t.MerchantsId,app_key:t.app_key}),a="/api/pay/testWxPay"):1==t.typeIndex&&(e=JSON.stringify({app_id:t.aliPayId,app_private_key:t.app_private_key,alipay_public_key:t.alipay_public_key}),a="/api/pay/testAliPay"),loadingAjax(a,"post",e,sessionStorage.token,"mask","","",i).then(function(e){var a=JSON.stringify({merchantId:d,id:n.id,payee:t.payee,payType:t.typeIndex,app_id:"2"==t.typeIndex?t.officialId:t.aliPayId,app_key:"2"==t.typeIndex?t.app_key:"",mchId:"2"==t.typeIndex?t.MerchantsId:"",alipay_public_key:"1"==t.typeIndex?t.alipay_public_key:"",app_private_key:"1"==t.typeIndex?t.app_private_key:t.MerchantsKey});loadingAjax("/api/pay/updatePayParam","post",a,sessionStorage.token,"mask","changePay","changeBox",i).then(function(e){i.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:""})}).catch(function(e){i.msg(e.message,{icon:2})})}).catch(function(e){i.msg(e.message,{icon:2})})});var d=sessionStorage.machineID,r=treeList();a.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:r,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),o.reload({where:{merchantId:e.data.id}}),d=e.data.id;for(var a=$("#test1 .layui-tree-txt"),t=0;t<a.length;t++)a[t].innerHTML===e.data.title?a[t].style.color="#be954a":a[t].style.color="#555"}}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".onLeft").show()}),$(".onLeft").click(function(){$(".left-mian").show(),$(".onLeft").hide()});e=JSON.stringify({status:1});loadingAjax("/api/pay/getAllPayType","post",e,sessionStorage.token).then(function(e){console.log(e);var t='<option value="">请选择</option>';e.data.forEach(function(e,a){1==e.status&&(t+='<option value="'.concat(e.id,'">').concat(e.name,"</option>"))}),$("#editTypeSelect").html(t),$("#addTypeSelect").html(t),p.render("select")}).catch(function(e){}),$(".addBtnClick").click(function(){popupShow("addePay","addBox")});p.on("select(addSelect)",function(e){console.log(e.value),1==e.value?($(".addePay .WeChat").hide(),$(".addePay .Alipay").show()):(2==e.value?$(".addePay .WeChat").show():$(".addePay .WeChat").hide(),$(".addePay .Alipay").hide())}),$(".addePay .submit_btn").click(function(){var e,a,t,n=p.val("addPay");if("2"==n.typeIndex){if(!(n.payee&&n.officialId&&n.MerchantsId&&n.app_key&&n.MerchantsKey))return void i.msg("带*为必填",{icon:7})}else if("1"==n.typeIndex){if(!(n.payee&&n.aliPayId&&n.alipay_public_key&&n.app_private_key))return void i.msg("带*为必填",{icon:7})}else if(!n.payee||!n.typeIndex)return void i.msg("带*为必填",{icon:7});$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2!=n.typeIndex&&1!=n.typeIndex&&(e=JSON.stringify({merchantId:d,payee:n.payee,payType:n.typeIndex}),loadingAjax("/api/pay/newPayParam","post",e,sessionStorage.token,"mask","addePay","addBox",i).then(function(e){i.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:"",MerchantsKey:""})}).catch(function(e){console.log(e),i.msg(e.message,{icon:2})})),2!=n.typeIndex&&1!=n.typeIndex||(2==n.typeIndex?(a=JSON.stringify({app_id:n.officialId,mchId:n.MerchantsId,app_key:n.app_key}),t="/api/pay/testWxPay"):1==n.typeIndex&&(a=JSON.stringify({app_id:n.aliPayId,app_private_key:n.app_private_key,alipay_public_key:n.alipay_public_key}),t="/api/pay/testAliPay"),loadingAjax(t,"post",a,sessionStorage.token,"mask","","",i).then(function(e){var a=JSON.stringify({merchantId:d,payee:n.payee,payType:n.typeIndex,app_id:"2"==n.typeIndex?n.officialId:n.aliPayId,app_key:"2"==n.typeIndex?n.app_key:"",mchId:"2"==n.typeIndex?n.MerchantsId:"",alipay_public_key:"1"==n.typeIndex?n.alipay_public_key:"",app_private_key:"1"==n.typeIndex?n.app_private_key:n.MerchantsKey});loadingAjax("/api/pay/newPayParam","post",a,sessionStorage.token,"mask","addePay","addBox",i).then(function(e){i.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:"",MerchantsKey:""})}).catch(function(e){i.msg(e.message,{icon:2})})}).catch(function(e){i.msg(e.message,{icon:2})}))}),$(".addePay .cancel_btn").click(function(){popupHide("addePay","addBox")}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(r)?(r=e,a.reload("treelist",{data:r}),o.reload({where:{merchantId:Number(sessionStorage.machineID)}})):i.msg("已刷新",{icon:1})})})},410:function(e,a){}});