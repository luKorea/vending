/*! 版权所有，翻版必究 */!function(y){function e(e){for(var a,t,i=e[0],n=e[1],p=e[2],o=0,d=[];o<i.length;o++)t=i[o],Object.prototype.hasOwnProperty.call(l,t)&&l[t]&&d.push(l[t][0]),l[t]=0;for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(y[a]=n[a]);for(s&&s(e);d.length;)d.shift()();return c.push.apply(c,p||[]),r()}function r(){for(var e,a=0;a<c.length;a++){for(var t=c[a],i=!0,n=1;n<t.length;n++){var p=t[n];0!==l[p]&&(i=!1)}i&&(c.splice(a--,1),e=o(o.s=t[0]))}return e}var t={},l={20:0},c=[];function o(e){if(t[e])return t[e].exports;var a=t[e]={i:e,l:!1,exports:{}};return y[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=y,o.c=t,o.d=function(e,a,t){o.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(a,e){if(1&e&&(a=o(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var i in a)o.d(t,i,function(e){return a[e]}.bind(null,i));return t},o.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(a,"a",a),a},o.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],i=a.push.bind(a);a.push=e,a=a.slice();for(var n=0;n<a.length;n++)e(a[n]);var s=i;c.push([145,0]),r()}({145:function(e,a,t){"use strict";t.r(a);t(393);layui.use(["table","form","layer","tree"],function(){var e=layui.table,n=layui.layer,n=layui.layer,a=(layui.util,layui.tree),p=layui.form,t=null,o=e.render({elem:"#payList",url:"/api/pay/getPayParam",method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"1",width:80,title:"",templet:"#imgtmp",event:"rank"},{field:"rank",width:80,title:"排序"},{field:"payName",width:180,title:"支付类型"},{field:"app_id",width:300,title:"微信公众号id/支付宝商户id"},{field:"merchantName",width:250,title:"所属商户"},{field:"payee",width:280,title:"收款账号"},{field:"update_user",width:200,title:"最后修改人"},{field:"update_time",width:250,title:"最后修改时间",templet:function(e){if(e.update_time){var a=new Date(e.update_time);return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+(e=a.getDate())+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}return""}},{field:"operation",right:0,width:150,title:"操作",toolbar:"#barDemo",fixed:"right"}]],id:"tablePayId",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:Number(sessionStorage.machineID)},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){t=e.data,403==e.code&&(window.parent.location.href="login.html")}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()});var i=null;e.on("tool(payList)",function(e){if(i=e.data,"edit"==e.event)"微信"==i.payName?($(".changePay .WeChat").show(),$(".changePay .Alipay").hide()):"支付宝"==i.payName?($(".changePay .WeChat").hide(),$(".changePay .Alipay").show()):($(".changePay .WeChat").hide(),$(".changePay .Alipay").hide()),p.val("SetPay",{typeIndex:i.payType,payee:i.payee,officialId:"微信"==i.payName?i.app_id:"",MerchantsId:"微信"==i.payName?i.mchId:"",app_key:"微信"==i.payName?i.app_key:"",aliPayId:"支付宝"==i.payName?i.app_id:"",alipay_public_key:"支付宝"==i.payName?i.alipay_public_key:"",app_private_key:"支付宝"==i.payName?i.app_private_key:""}),popupShow("changePay","changeBox");else if("del"==e.event)n.confirm("确定删除？",function(e){n.close(e);var a=JSON.stringify({merchantId:Number(d),id:i.id});loadingAjax("/api/pay/deletePayParam","post",a,sessionStorage.token,"","","",n).then(function(e){n.msg(e.message,{icon:1}),o.reload({where:{}})}).catch(function(e){n.msg(e.message,{icon:2})})});else if("rank"==e.event){if(1==e.data.rank)return;console.log(e),console.log(t);var a=JSON.stringify({merchantId:d,topId:e.data.id,bottomId:t[e.data.rank-2].id});loadingAjax("/api/pay/sortPayParam","post",a,sessionStorage.token,"","","",n).then(function(e){n.msg("修改成功",{icon:1}),o.reload({where:{}})}).catch(function(e){console.log(res),n.msg("修改失败",{icon:1})})}}),$(".changeBody .cancel_btn").click(function(){popupHide("changePay","changeBox")}),$(".changeBody .submit_btn").click(function(){var e,a,t=p.val("SetPay");if("2"==t.typeIndex){if(!(t.payee&&t.officialId&&t.MerchantsId&&t.app_key))return void n.msg("带*为必填",{icon:7})}else if("1"==t.typeIndex){if(!(t.payee&&t.aliPayId&&t.alipay_public_key&&t.app_private_key))return void n.msg("带*为必填",{icon:7})}else if(!t.payee||!t.aliPayId)return void n.msg("带*为必填",{icon:7});$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2==t.typeIndex?(e=JSON.stringify({app_id:t.officialId,mchId:t.MerchantsId,app_key:t.app_key}),a="/api/pay/testWxPay"):1==t.typeIndex&&(e=JSON.stringify({app_id:t.aliPayId,app_private_key:t.app_private_key,alipay_public_key:t.alipay_public_key}),a="/api/pay/testAliPay"),loadingAjax(a,"post",e,sessionStorage.token,"mask","","",n).then(function(e){var a=JSON.stringify({merchantId:d,id:i.id,payee:t.payee,payType:t.typeIndex,app_id:"2"==t.typeIndex?t.officialId:t.aliPayId,app_key:"2"==t.typeIndex?t.app_key:"",mchId:"2"==t.typeIndex?t.MerchantsId:"",alipay_public_key:"1"==t.typeIndex?t.alipay_public_key:"",app_private_key:"1"==t.typeIndex?t.app_private_key:""});loadingAjax("/api/pay/updatePayParam","post",a,sessionStorage.token,"mask","changePay","changeBox",n).then(function(e){n.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:""})}).catch(function(e){n.msg(e.message,{icon:2})})}).catch(function(e){n.msg(e.message,{icon:2})})});var d=sessionStorage.machineID,y=treeList();a.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:y,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),o.reload({where:{merchantId:e.data.id}}),d=e.data.id;for(var a=$("#test1 .layui-tree-txt"),t=0;t<a.length;t++)a[t].innerHTML===e.data.title?a[t].style.color="#be954a":a[t].style.color="#555"}}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".onLeft").show()}),$(".onLeft").click(function(){$(".left-mian").show(),$(".onLeft").hide()});var r=JSON.stringify({status:1});loadingAjax("/api/pay/getAllPayType","post",r,sessionStorage.token).then(function(e){console.log(e);var t='<option value="">请选择</option>';e.data.forEach(function(e,a){1==e.status&&(t+='<option value="'.concat(e.id,'">').concat(e.name,"</option>"))}),$("#editTypeSelect").html(t),$("#addTypeSelect").html(t),p.render("select")}).catch(function(e){}),$(".addBtnClick").click(function(){popupShow("addePay","addBox")});p.on("select(addSelect)",function(e){console.log(e.value),1==e.value?($(".addePay .WeChat").hide(),$(".addePay .Alipay").show()):(2==e.value?$(".addePay .WeChat").show():$(".addePay .WeChat").hide(),$(".addePay .Alipay").hide())}),$(".addePay .submit_btn").click(function(){var e,a,t,i=p.val("addPay");if("2"==i.typeIndex){if(!(i.payee&&i.officialId&&i.MerchantsId&&i.app_key))return void n.msg("带*为必填",{icon:7})}else if("1"==i.typeIndex){if(!(i.payee&&i.aliPayId&&i.alipay_public_key&&i.app_private_key))return void n.msg("带*为必填",{icon:7})}else if(!i.payee||!i.typeIndex)return void n.msg("带*为必填",{icon:7});$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2!=i.typeIndex&&1!=i.typeIndex&&(e=JSON.stringify({merchantId:d,payee:i.payee,payType:i.typeIndex}),loadingAjax("/api/pay/newPayParam","post",e,sessionStorage.token,"mask","addePay","addBox",n).then(function(e){n.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:""})}).catch(function(e){console.log(e),n.msg(e.message,{icon:2})})),2!=i.typeIndex&&1!=i.typeIndex||(2==i.typeIndex?(a=JSON.stringify({app_id:i.officialId,mchId:i.MerchantsId,app_key:i.app_key}),t="/api/pay/testWxPay"):1==i.typeIndex&&(a=JSON.stringify({app_id:i.aliPayId,app_private_key:i.app_private_key,alipay_public_key:i.alipay_public_key}),t="/api/pay/testAliPay"),loadingAjax(t,"post",a,sessionStorage.token,"mask","","",n).then(function(e){var a=JSON.stringify({merchantId:d,payee:i.payee,payType:i.typeIndex,app_id:"2"==i.typeIndex?i.officialId:i.aliPayId,app_key:"2"==i.typeIndex?i.app_key:"",mchId:"2"==i.typeIndex?i.MerchantsId:"",alipay_public_key:"1"==i.typeIndex?i.alipay_public_key:"",app_private_key:"1"==i.typeIndex?i.app_private_key:""});loadingAjax("/api/pay/newPayParam","post",a,sessionStorage.token,"mask","addePay","addBox",n).then(function(e){n.msg(e.message,{icon:1}),o.reload({where:{}}),p.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:""})}).catch(function(e){n.msg(e.message,{icon:2})})}).catch(function(e){n.msg(e.message,{icon:2})}))}),$(".addePay .cancel_btn").click(function(){popupHide("addePay","addBox")})})},393:function(e,a){}});