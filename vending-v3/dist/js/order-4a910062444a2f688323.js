/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,o=e[0],a=e[1],i=e[2],r=0,d=[];r<o.length;r++)n=o[r],Object.prototype.hasOwnProperty.call(c,n)&&c[n]&&d.push(c[n][0]),c[n]=0;for(t in a)Object.prototype.hasOwnProperty.call(a,t)&&(l[t]=a[t]);for(m&&m(e);d.length;)d.shift()();return u.push.apply(u,i||[]),s()}function s(){for(var e,t=0;t<u.length;t++){for(var n=u[t],o=!0,a=1;a<n.length;a++){var i=n[a];0!==c[i]&&(o=!1)}o&&(u.splice(t--,1),e=r(r.s=n[0]))}return e}var n={},c={19:0},u=[];function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=l,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var a=0;a<t.length;a++)e(t[a]);var m=o;u.push([140,0]),s()}({140:function(e,t,n){"use strict";n.r(t);n(381),n(383);layui.use(["laydate","table","tree","flow","layer","form"],function(){var n="",o="";layui.laydate.render({elem:"#test6",range:!0,done:function(e){var t=e.split(" - ");n=t[0],o=t[1]}}),$(".sidebar i").click(function(){$(".data-left").hide(),$(".onLeft").show()}),$(".onLeft").click(function(){$(".onLeft").hide(),$(".data-left").show()});var a,e,t=sessionStorage.token,i=layui.tree,r=layui.flow,d=layui.layer,l=layui.table,s=layui.form,c=l.render({elem:"#moneyData",url:"/api/order/getOrderList",method:"post",contentType:"application/json",headers:{token:t},cols:[[{field:"info",width:210,title:"终端名",align:"center"},{field:"number",width:180,title:"订单编号"},{field:"payStatus",width:130,title:"支付状态",templet:function(e){return 1==e.payStatus?"等待支付":2==e.payStatus?"已支付":"未支付"}},{field:"time",width:180,title:"支付时间"},{field:"bili",width:160,title:"出货状态",templet:function(){}},{field:"payee",width:160,title:"收款方"},{field:"operation",width:110,title:"详情 ",toolbar:"#barDemo"}]],page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{conditionFive:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(e){var n,o,a,i;200==e.code?(console.log(e),i=a=o=n=0,$('.ban-input input[name="orderNumVal"]').val(e.data.length),e.data.forEach(function(e,t){1==e.payStatus&&(n+=e.amount,e.goodsList.forEach(function(e,t){o+=(e.goods_Price-e.goods_Cost)*(e.count-e.refund_count),a+=e.goods_Price*(e.count-e.refund_count),i+=e.goods_Price*e.refund_count}))}),$('.ban-input input[name="orderAllSumVal"]').val(numFormat1(n)),$('.ban-input input[name="profitsSum"]').val(numFormat1(o)),$('.ban-input input[name="orderPaidInSum"]').val(numFormat1(a)),$('.ban-input input[name="orderRefundSum"]').val(numFormat1(i))):405==e.code&&$(".hangContent").show()}}),u=" ",m=sessionStorage.machineID,f=treeList(u);function p(){r.load({elem:"#demo",isAuto:!0,scrollElem:"#demo",end:" ",done:function(t,o){setTimeout(function(){var n=[];o(n.join(""),t<3);var e=JSON.stringify({pageNum:t,pageSize:10,merchantId:m});loadingAjax("/api/machine/getMachineList","post",e,sessionStorage.token).then(function(e){e.data.list.forEach(function(e,t){n.push('<span machineID="'.concat(e.machineId,'">').concat(e.info?e.info:"未命名售货机","</span>"))}),o(n.join(""),10<=e.data.list)}).catch(function(e){console.log(e),d.msg(e.message,{icon:7}),o(n.join(""),200==e.code)})},200)}})}u=sessionStorage.marchantName,a="test1",e=f,i.render({elem:"#".concat(a),id:"treelist",showLine:!0,onlyIconControl:!0,data:e,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),u=e.data.title;for(var t=$("#".concat(a," .layui-tree-txt")),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555";m!=e.data.id&&(m=e.data.id,$("#demo").remove(),$(document).unbind(),$(".equipment").append('<div class="machineList" id="demo"></div>'),p(),$(".allmachine").addClass("active"),$(".machineList span").removeClass("active"),h="",c.reload({where:{conditionFour:h,conditionFive:m}}))}}),p();var h="";$("body").on("click",".machineList span",function(){$(".allmachine").removeClass("active"),$(this).addClass("active").siblings().removeClass("active"),h=$(this).attr("machineID"),c.reload({where:{conditionFour:h}})}),$(".allmachine").click(function(){$(this).addClass("active"),$(".machineList span").removeClass("active"),h="",c.reload({where:{conditionFour:h}})}),$(".pushBtn").click(function(){var e=new Date,i=e.getFullYear()+""+(10<=e.getMonth()+1?e.getMonth()+1:"0"+(e.getMonth()+1))+(10<=e.getDate()?e.getDate():"0"+e.getDate()),r=new XMLHttpRequest;r.open("POST","/api/order/exportExcel",!0),r.setRequestHeader("token",sessionStorage.token),r.setRequestHeader("Content-Type","application/json;charset=utf-8"),r.responseType="blob",r.onload=function(e){var t,n,o,a;console.log(r),200==r.status?r.response.size<100?d.msg("您没有导出订单的权限！",{icon:7}):(t=r.response,n="".concat(u,"订单").concat(i),(o=document.createElement("a")).download=n,o.style.display="none",a=new Blob([t]),o.href=URL.createObjectURL(a),document.body.appendChild(o),o.click(),document.body.removeChild(o)):d.msg("服务器请求超时",{icon:2})},r.send(JSON.stringify({condition:n,conditionTwo:o,conditionFour:h,conditionFive:m}))}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()});var g=null;var v=null;l.on("tool(moneyData)",function(e){console.log(e),v=e.data,g=g||l.render({elem:"#GooodsData",cols:[[{field:"goods_images",width:120,title:"图片",templet:"#imgtmp"},{field:"goods_Name",width:140,title:"商品名"},{field:"goods_Core",width:140,title:"商品编号"},{field:"count",width:120,title:"购买数量",align:"center"},{field:"refund_count",width:120,title:"已退款数量",align:"center"},{field:"goods_Price",width:140,title:"销售价 "},{field:"goods_Cost",width:140,title:"成本价 "},{field:"operation",right:0,width:80,title:"操作",toolbar:"#refundDemo",fixed:"right"}]],data:[],id:"goodsLIstTable",loading:!0,done:function(e){for(var t in console.log(e),C(),e.data){1==e.data[t].refund&&($(".goodsListBody tr[data-index="+t+'] input[type="checkbox"]').prop("disabled",!0),s.render())}}}),$(".detailsOrderCode").html(e.data.number),$(".payTime").html(e.data.time),$(".orderInformation button span").html(0==e.data.shipStatus?"出货失败":"出货成功");var n=0,o=0,a=0,i=0;e.data.goodsList.forEach(function(e,t){n+=e.count,o+=e.goods_Price*(e.count-e.refund_count),a+=(e.goods_Price-e.goods_Cost)*(e.count-e.refund_count),i+=e.goods_Price*e.refund_count}),$(".payType").html(0==e.data.payType?"支付宝":"微信"),$(".payNUmber").html(n),$(".paidInSum").html(o),$(".orderSum").html("￥"+e.data.amount),$(".profitsSum").html("￥"+a),$(".collection button span").html(1==e.data.payStatus?"等待支付":2==e.data.payStatus?"支付成功":"未支付"),$(".machineCode").html(e.data.machineId),$(".merchantName").html(e.data.merchantName),$(".merchantCode ").html(e.data.alias),$(".refundSum").html("￥"+i),popupShow("orderDetails","orderDetailsBox"),g.reload({data:e.data.goodsList})}),$(".queryBtn").click(function(){c.reload({where:{condition:n,conditionTwo:o,conditionThree:$('.key-contnet input[name="orderCode"]').val()}})}),$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var y=null;l.on("tool(GooodsData)",function(e){2==v.payStatus?(y=e.data,e.data.count!=e.data.refund_count?($(".twoPoles span").html(e.data.count-e.data.refund_count),$(".refundNumber input").val(1),$(".refundNumber input").prop("max",e.data.count-e.data.refund_count),popupShow("refundNUmCont","refundBox")):d.msg("该商品已全部退款",{icon:7})):d.msg("订单未支付，不能进行退款操作",{icon:7})}),$(".refundNUmCont .chooseCan").click(function(){popupHide("refundNUmCont","refundBox")}),$(".refundNUmCont .determineBtn").click(function(){console.log($(".refundNumber input").val()),0<$(".refundNumber input").val()&&$(".refundNumber input").val()<=y.count-y.refund_count?d.confirm("确定退款？",function(e){d.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var t=JSON.stringify({number:v.number,goods:y.goods_Id,count:Number($(".refundNumber input").val())});loadingAjax("/api/order/refund","post",t,sessionStorage.token,"mask","refundNUmCont","refundBox").then(function(e){d.msg(e.message,{icon:1}),popupHide("orderDetails","orderDetailsBox"),c.reload({where:{}})}).catch(function(e){d.msg(e.message,{icon:2})})}):d.msg("请按照提示填写数量",{icon:7})});var b=1;$(".refundNumber input").keyup(function(){var e=$(this).val();/^\d*$/.test(e)?(b=$(this).val(),console.log(b)):(d.msg("只能输入正整数",{icon:7}),$(this).val(b))});var w=!1,S=!1;function C(){w?$(".pushBtn").removeClass("hide"):$(".pushBtn").addClass("hide"),S?$(".refundBtnTwo").removeClass("hide"):$(".refundBtnTwo").addClass("hide")}permissionsVal(420,421).then(function(e){w=e.addFlag,S=e.editFlag,C()}).catch(function(e){d.msg("服务器请求超时",{icon:7})})})},381:function(e,t){},383:function(e,t){}});