/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,a=e[0],i=e[1],o=e[2],s=0,c=[];s<a.length;s++)n=a[s],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&c.push(r[n][0]),r[n]=0;for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t]);for(u&&u(e);c.length;)c.shift()();return m.push.apply(m,o||[]),d()}function d(){for(var e,t=0;t<m.length;t++){for(var n=m[t],a=!0,i=1;i<n.length;i++){var o=n[i];0!==r[o]&&(a=!1)}a&&(m.splice(t--,1),e=s(s.s=n[0]))}return e}var n={},r={15:0},m=[];function s(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=l,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var t=window.webpackJsonp=window.webpackJsonp||[],a=t.push.bind(t);t.push=e,t=t.slice();for(var i=0;i<t.length;i++)e(t[i]);var u=a;m.push([368,0]),d()}({368:function(e,t,ee){"use strict";ee.r(t);ee(376);var te=null,ne=null;function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}layui.use(["form"],function(){for(var i,o,s,c=layui.form,e=$(".province"),t=0;t<provinceList.length;t++)l(e,provinceList[t].name);function l(e,t){var n="<option value="+t+" >"+t+"</option>";e.append(n)}function d(e){e.find("option").remove();e.append("<option value=''>请选择</option>")}c.render("select"),c.on("select(province)",function(e){te(e.value)}),te=function(e){var n=$(".city"),t=$(".district");i=e,$.each(provinceList,function(e,t){if(i==t.name)return s=e}),d(n),d(t),$.each(provinceList[s].cityList,function(e,t){l(n,t.name)}),c.render("select")},c.on("select(city)",function(e){ne(e.value)}),ne=function(e){var a=$(".district");o=e,d(a),$.each(provinceList,function(e,t){if(i==t.name)return s=e}),$.each(provinceList[s].cityList,function(e,t){if(o==t.name)for(var n=0;n<t.areaList.length;n++)l(a,t.areaList[n])}),c.render("select")}}),layui.use(["table","form","layer","laydate","tree"],function(){var a=1;tooltip(".refreshBtnList",{transition:!0,time:200}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".on-left").show()}),$(".on-left").click(function(){$(".left-mian").show(),$(".on-left").hide()});var e=merchantsListMian(""),t=layui.table,i=sessionStorage.token,o=layui.layer,s=layui.form,n=layui.tree,c=layui.laydate,l=t.render({elem:"#machineTable",url:"/api/machine/getMachineList",method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"number",width:150,title:"终端编号",align:"center",templet:function(e){return e.number||"-"}},{field:"info",width:330,title:"终端信息",align:"center",templet:function(e){return e.info?"<div>".concat(e.info,"</div>"):'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>'}},{field:"location",width:350,title:"地址",align:"center",templet:function(e){return e.location||" - "}},{field:"CreationTime",width:130,title:"缺货状态",align:"center",templet:function(e){return'<div><span class="'.concat(0==e.stockStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.stockStatus?"正常":1==e.stockStatus?"一般":"严重","</span></div>")}},{field:"onlineStatus",width:130,title:"在线状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.onlineStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.onlineStatus?"离线":"在线","</span></div>")}},{field:"actionStatus",width:130,title:"是否激活",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.actionStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.actionStatus?"未激活":"已激活","</span></div>")}},{field:"openStatus",width:130,title:"营业状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.openStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.openStatus?"无营业":"营业","</span></div>")}},{field:"merchantName",width:150,title:"所属商户",align:"center"},{field:"appVersion",width:135,title:"软件版本",align:"center"},{field:"connectTime",width:170,title:"联机时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.connectTime):"-"}},{field:"actionTime",width:170,title:"激活时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.actionTime):"-"}},{field:"description",width:250,title:"描述",align:"center"},{field:"operation",fixed:"right",right:0,width:250,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){permissionsFun("/api/role/findUserPermission","post",sessionStorage.token,o).then(function(e){e.data.forEach(function(e){"396"==e.id&&(I=!0),"392"==e.id&&(N=!0),"424"==e.id&&(b=!0),"432"==e.id&&(_=!0),"426"==e.id&&(x=!0),"425"==e.id&&0,"427"==e.id&&(T=!0),"401"==e.id&&(A=!0),"402"==e.id&&(O=!0),"456"==e.id&&(P=!0)}),N?$(".activeMachineType").removeClass("hides"):$(".activeMachineType").addClass("hides"),_?$(".payTypeSet").removeClass("hide"):$(".payTypeSet").addClass("hide"),x?$(".detailsDel").removeClass("hide"):$(".detailsDel").addClass("hide"),T?$("aisleDetailsTab").removeClass("hide"):$("aisleDetailsTab").addClass("hide"),A?$(".salesDetails").removeClass("hide"):$(".salesDetails").addClass("hide"),O?$(".shipmentDetails").removeClass("hide"):$(".shipmentDetails").addClass("hide"),P?$(".shmentSet").removeClass("hide"):$(".shmentSet").addClass("hide")}).catch(function(e){o.msg(e.message,{icon:2})}),403==e.code?window.parent.location.href="login.html":405==e.code&&$(".hangContent").show()}});$(".machineListKeyBtn").click(function(){var e=s.val("machineData");l.reload({where:{onlineStatus:e.onlineStatus?Number(e.onlineStatus):"",actionStatus:e.actionStatus?Number(e.actionStatus):"",openStatus:e.permissions?Number(e.permissions):"",stockStatus:e.CreationTime?Number(e.CreationTime):"",keyword:e.machineKeyText}})}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(C)&&(C=e,treeFun(n,"test1",l,C,"merchantId","condition",D,"","true"),l.reload({where:{merchantId:sessionStorage.machineID}})),o.msg("已刷新",{icon:1})}),$(".setNav li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this);switch($(".tabLine").animate({left:0!=e.index()?e.offset().left+"px":e.offset().left-20+"px",width:e.width()+"px"},500),$(".navSetCont li").eq($(this).index()).fadeIn().siblings().hide(),e.index()){case 1:M(d.machineId);break;case 2:e=d.machineId,k=t.render({elem:"#salesDateilsTable",url:"/api//machine/getSalesList",method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"time",width:200,title:"时间"},{field:"number",width:250,title:"订单号"},{field:"payStatus",width:150,title:"支付状态",templet:function(e){return'<div><span class="'.concat(2==e.payStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(1==e.payStatus?"等待支付":2==e.payStatus?"已支付":"未支付","</span></div>")}},{field:"payType",width:150,title:"支付方式",templet:function(e){return'<div><span class="'.concat(0!=e.payType?"tableStateCellTrue":"tableStateCellAli",'">').concat(0!=e.payType?"微信":"支付宝","</span></div>")}},{field:"payee",width:150,title:"收款方"},{field:"amount",width:150,title:"金额"}]],id:"salesId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:e},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 3:d.machineId,w=t.render({elem:"#shipmentListTable",url:"/api/machine/getShippingList",method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"time",width:230,title:"出货时间",align:"center",templet:function(e){return e.create_time?timeStamp(e.create_time):"-"}},{field:"goodName",width:200,title:"商品名",align:"center",templet:function(e){return 0!=e.good_info.length?e.good_info[0].goods_Name:"-"}},{field:"ship_status",width:150,title:"出货状态",align:"center",templet:function(e){return 0==e.ship_status?"出货失败":1==e.ship_status?"出货成功":"货道故障"}},{field:"before_count",width:150,align:"center",title:"出货前数量"},{field:"before_count",width:150,align:"center",title:"出货后数量",templet:function(e){return 1==e.ship_status?e.before_count-1:e.before_count}},{field:"ship_type",width:150,align:"center",title:"出货类型",templet:function(e){return 1==e.ship_type?"订单":"取货码"}},{field:"way",width:120,align:"center",title:"出货货道"},{field:"order_code",width:210,align:"center",title:"订单号/取货码"}]],id:"shipmentId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:d.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 4:R(d.machineId,d.userNum);break;case 5:d.machineId,Q=t.render({elem:"#replenishmentTable",url:"/api/machine/getReplenish",method:"post",contentType:"application/json",headers:{token:i},cols:[[{field:"way",width:250,title:"补货人",align:"center",templet:function(e){return e.name+"("+e.username+")"}},{field:"replenish_time",width:230,title:"补货时间",align:"center",templet:function(e){return e.replenish_time?timeStamp(e.replenish_time):"-"}},{field:"way",width:100,title:"补货货道",align:"center"},{field:"ship_f",width:180,title:"商品名",align:"center",templet:function(e){return 0!=e.good_info.length?e.good_info[0].goods_Name:"-"}},{field:"replenish_count",width:150,title:"补货前数量",align:"center",templet:function(e){return e.after_count-e.replenish_count}},{field:"replenish_count",width:150,title:"补货数量",align:"center"},{field:"after_count",width:150,title:"补货后数量",align:"center"}]],id:"shipmentId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:d.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}});var d=null;t.on("tool(machineTable)",function(e){var t;d=e.data,console.log(d),$(".maskHeader span").html(d.info+"详细信息"),"set"==e.event?($(".setUpCont").show(),t=null,d.location&&(t=d.location.split(" ")),s.val("setDataVal",{info:d.info,appVersion:d.appVersion,longitude:d.longitude,latitude:d.latitude,location:d.location,setProvince:t?t[1]:"",setCity:t?t[2]:"",setArea:t?t[3]:"",setRegion:d.area}),$(".navSetCont li").eq(0).show().siblings().hide(),$(".setNav li").eq(0).addClass("active").siblings().removeClass("active"),$(".tabLine").animate({left:$(".setNav li").eq(0).offset().left-20+"px",width:$(".setNav li").eq(0).width()+"px"},1)):"edit"==e.event?(1==d.openStatus?o.msg("温馨提示！该售货机正在营业，不可进行编辑！",{icon:7}):I||o.msg("温馨提示！您没有编辑售货机的权限！",{icon:7}),t=null,d.location&&(t=d.location.split(" ")),$(".editMachineBox .layui-tree-txt").css({color:"#555"}),s.val("editmachine",{sNumber:d.number,tName:d.info,number:d.machineId,province:d.location?t[0]:"",mapVal:d.location?t[3]:"",area:d.area,longitude:d.longitude,latitude:d.latitude,headPhone:d.chargerPhone,describe:d.description,merchantsName:d.userNum,merchantsNametext:d.merchantName}),d.location&&(te(t[0]),console.log(t[0]),$(".city").val(t[1]),ne(t[1]),$(".district").val(t[2]),s.render("select")),$(".editMachineCont").show(),$(".editMachineCont").scrollTop(0),d.service_code?($(".ImgCont img").prop("src",d.service_code),$(".ImgCont").show()):($(".ImgCont img").prop("src",""),$(".ImgCont").hide()),W=1==d.is_service?($(".serviceTitle").show(),$('.listFlex input[name="machineOpen"]').prop("checked",!0),!0):($(".serviceTitle").hide(),$('.listFlex input[name="machineOpen"]').prop("checked",!1),!1),$('.serviceTitle input[name="service_phone"]').val(d.service_phone),d.custom_code?($(".customImgCont img").prop("src",d.custom_code),$(".customImgCont").show()):($(".customImgCont img").prop("src",""),$(".customImgCont").hide()),K=1==d.is_custom?($(".customTitle").show(),$('.listFlex input[name="customOpen"]').prop("checked",!0),!0):($(".customTitle").hide(),$('.listFlex input[name="customOpen"]').prop("checked",!1),!1),function(t,e){var n=JSON.stringify({merchantId:t.userNum,pageSize:10,pageNum:e});1==e&&(X=[]);loadingAjax("/api/sales_manager/getSalesType","post",n,sessionStorage.token,"mask","","",o).then(function(e){console.log(e),function(e,t){console.log(a);var n="";1==a&&($(".salseCont").html(""),n='<input type="radio" '.concat(0==t.is_sales?"checked":"",' name="salseClassName" value="-99" title="不启用" >\n            <input type="radio" name="salseClassName" ').concat(1!=t.is_sales||t.sales_type?"":"checked",' value="" title="默认" >'),a++);e.forEach(function(e){n+='<input type="radio" name="salseClassName" '.concat(1==t.is_sales&&d.sales_type==e.sm_classify?"checked":"",' value="').concat(e.sm_classify,'" title="').concat(e.sm_classify,'">')}),$(".salseCont").append(n),s.render()}(X=X.concat(e.data.list),t),10==e.data.list.length?$(".loadMore").show():$(".loadMore").hide()}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}(d,a=1),$('.customTitle input[name="custom_phone"]').val(d.custom_phone),s.render(),p()):"activate"==e.event?N?o.confirm("确定激活该设备？",function(e){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var t=JSON.stringify({machineId:d.machineId,actionStatus:"1"});loadingAjax("/api/machine/activeMachine","post",t,i,"mask","","",o).then(function(e){o.msg("激活成功",{icon:1}),l.reload({where:{}})}).catch(function(e){o.msg(res.message,{icon:2})})}):o.msg("您没有激活售货机的权限!"):"startThe"==e.event&&(1==d.onlineStatus?N?1!=d.openStatus?o.confirm("确定营业？",function(e){o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/api/machine/getStatus","post",JSON.stringify({machineId:d.machineId}),i).then(function(e){console.log(e),1==e.data.actionStatus?loadingAjax("/api/pushActive","post",JSON.stringify({machine:d.machineId,action:"true"}),i).then(function(e){}).catch(function(e){"true"==e?loadingAjax("/api/machine/activeMachine","post",JSON.stringify({machineId:d.machineId,openStatus:"1"}),i,"mask").then(function(e){o.msg("操作成功",{icon:1}),l.reload({where:{}})}).catch(function(e){o.msg(e.message,{icon:2})}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("操作失败",{icon:2}))}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("操作失败",{icon:2}))}).catch(function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg(e.message,{icon:2})})}):o.confirm("确定暂停营业？",function(e){o.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/machine/getStatus",headers:{"Content-Type":"application/json",token:i},data:JSON.stringify({machineId:d.machineId}),success:function(e){200==e.code?(console.log(e),1==e.data.actionStatus?$.ajax({type:"post",url:"/api/pushActive",headers:{"Content-Type":"application/json",token:i},data:JSON.stringify({machine:d.machineId,action:"false"}),success:function(e){"true"==e?$.ajax({type:"post",url:"/api/machine/activeMachine",headers:{"Content-Type":"application/json",token:i},data:JSON.stringify({machineId:d.machineId,openStatus:"0"}),success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),200==e.code?(o.msg("暂停营业成功",{icon:1}),l.reload({where:{}})):o.msg(e.message,{icon:2})}}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("操作失败",{icon:2}))}}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("该设备未激活,无法进行营业操作",{icon:7}))):403==e.code?window.parent.location.href="login.html":($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg(e.message,{icon:2}))}})}):o.msg("您没有更改营业状态的权限!"):o.msg("售货机处于离线状态不可以操作此功能",{icon:7}))}),$(".setUpCont .close").click(function(){$(".setUpCont").hide()}),$(".editMachineCont .close").click(function(){$(".editMachineCont").hide()}),$(".editMachineCont .editCancelBtn").click(function(){$(".editMachineCont").hide()});var r=new AMap.Map("machineMap",{resizeEnable:!0}),m=new AMap.Geocoder({city:""}),u=new AMap.Marker;function p(){var e=$('.listFlex select[name="province"]').val()+$('.listFlex select[name="city"]').val()+$('.listFlex select[name="district"]').val()+$('.listFlex input[name="mapVal"]').val();m.getLocation(e,function(e,t){"complete"===e&&t.geocodes.length?(t=t.geocodes[0].location,console.log(t),$('.listFlex input[name="longitude"]').val(t.lng),$('.listFlex input[name="latitude"]').val(t.lat),u.setPosition(t),r.add(u),r.setFitView(u)):o.msg("根据地址查询位置失败",{icon:2})})}function h(){var e=[$('.listFlex input[name="longitude"]').val(),$('.listFlex input[name="latitude"]').val()];r.add(u),u.setPosition(e),r.setFitView(u),m.getAddress(e,function(e,t){"complete"===e&&t.regeocode?(t=t.regeocode,console.log(t),$('.listFlex input[name="mapVal"]').val(t.addressComponent.street+t.addressComponent.streetNumber),$('.listFlex select[name="province"]').val(t.addressComponent.province),te(t.addressComponent.province),"北京市"==t.addressComponent.province||"天津"==t.addressComponent.province||"上海市"==t.addressComponent.province||"重庆市"==t.addressComponent.province?($('.listFlex select[name="city"]').val("市辖区"),ne("市辖区")):($('.listFlex select[name="city"]').val(t.addressComponent.city),ne(t.addressComponent.city)),$('.listFlex select[name="district"]').val(t.addressComponent.district),s.render("select")):o.msg("根据地址查询位置失败",{icon:2})})}r.on("click",function(e){$('.listFlex input[name="longitude"]').val(),console.log(e)}),$('.listFlex input[name="mapVal"]').blur(function(){p()}),$('.listFlex input[name="longitude"]').blur(function(){h()}),$('.listFlex input[name="latitude"]').blur(function(){h()}),$('.listFlex input[name="userPhone"]').blur(function(){phoneRegular(this,o)}),$('.listFlex input[name="headPhone"]').blur(function(){phoneRegular(this,o)}),$(".editMachineCont .edittBtn").click(function(){var e;1!=d.openStatus?(e=s.val("editmachine")).sNumber&&e.tName&&e.number&&e.province&&e.city&&e.district&&e.mapVal&&e.area&&e.merchantsName?$('.serviceTitle input[name="service_phone"]').val()||$(".ImgCont img").attr("src")||!W?$('.customTitle input[name="custom_phone"]').val()||$(".customImgCont img").attr("src")||!K?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",headers:{"Content-Type":"application/json",token:i},url:"/api/machine/updateMachine",data:JSON.stringify({number:e.sNumber,info:e.tName,machineId:e.number,location:e.province+" "+e.city+" "+e.district+" "+e.mapVal,area:e.area,longitude:e.longitude,latitude:e.latitude,userNum:d.userNum==Number(e.merchantsName)?0:Number(e.merchantsName),chargerPhone:e.headPhone,description:e.describe,is_service:W?1:0,service_phone:W?$('.serviceTitle input[name="service_phone"]').val():"",service_code:W?$(".ImgCont img").attr("src"):"",is_custom:K?1:0,custom_phone:K?$('.customTitle input[name="custom_phone"]').val():"",custom_code:K?$(".customImgCont img").attr("src"):"",is_sales:-99==$('.salseCont input[name="salseClassName"]:checked').val()?0:1,sales_type:-99==$('.salseCont input[name="salseClassName"]:checked').val()?"":$('.salseCont input[name="salseClassName"]:checked').val()}),success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),200==e.code?($(".editMachineCont").hide(),o.msg("编辑成功",{icon:1}),l.reload({where:{}})):403==e.code?window.parent.location.href="login.html":(e.code,o.msg(e.message,{icon:2}))}})):o.msg("请填写定制电话或上传定制二维码",{icon:7}):o.msg("请填写客服电话或上传客服微信二维码",{icon:7}):o.msg("带*为必填",{icon:7}):o.msg("正在营业的售货机不可进行编辑！",{icon:7})}),$(".fixedAccount").click(function(){$(".fixedAccount").removeClass("active"),$(this).addClass("active"),l.reload({where:{merchantId:$(this).attr("mid")}})});var g="",f="";c.render({elem:"#test6",range:!0,done:function(e){e=e.split(" - ");g=e[0],f=e[1]}});var v="",y="";c.render({elem:"#test7",range:!0,done:function(e){console.log(e);e=e.split(" - ");console.log(e),v=e[0],y=e[1]}});var k=null;$(".selesQueryBtn").click(function(){var e=s.val("salesDataVal");console.log(e),k.reload({where:{conditionFive:e.shipmentStatus,conditionSix:e.payStatus,conditionSeven:e.payType,conditionTwo:g||null,conditionThree:f||null}})});var w=null;$(".shipmentQueryBtn").click(function(){w.reload({where:{conditionTwo:v,conditionThree:y,conditionFour:$('.shipmentRecord input[name="keyName"]').val()}})});var S=null,C=S=treeList();0==e.length&&(S=[]),console.log(JSON.stringify(C)),treeFun(n,"test1",l,C,"merchantId","condition",D,"","true");n.render({elem:"#test2",id:"treelistEdit",showLine:!0,onlyIconControl:!0,isJump:!1,edit:!1,data:S,text:{defaultNodeName:"无数据",none:"您没有修改机器所属商户的权限。"},click:function(e){console.log(e),s.val("editmachine",{merchantsName:e.data.id,merchantsNametext:e.data.title});for(var t=$(".editMachineBox .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}});$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var I=!1,N=!1,b=!1,_=!1,x=!1,T=!1,A=!1,O=!1,P=!1;function D(e){$.ajax({type:"post",url:"/api/classify/findAll",data:JSON.stringify({pageNum:1,pageSize:1e4,merchantId:e}),headers:{"Content-Type":"application/json",token:sessionStorage.token},success:function(e){var n;200==e.code&&(n='<option value="">全部</option>',$.each(e.data.list,function(e,t){n+='<option value="'.concat(t.classifyId,'">').concat(t.classifyName,"</option>")}),$("#GoodsType").html(n),s.render("select"))}})}$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),D(sessionStorage.machineID),sessionStorage.machineGoodsId=sessionStorage.machineID;var j=null;var F=[];function M(e){F=[];e=JSON.stringify({machineId:e});loadingAjax("/api//machine/getGoodWay","post",e,sessionStorage.token,"","","",o).then(function(e){B(e),console.log(e)}).catch(function(e){console.log(e),F=[];$(".aisleGoodsCont").html('<div style="text-align: center;">您没有权限访问货道详情！</div>')})}function B(e){var a;console.log(e),F=[[],[],[],[],[],[]],e.data.forEach(function(e){e.row&&F[e.row-1].push(e)}),console.log(F),a="",F.forEach(function(e,n){a+='<div class="aisleListCont flexTwo">\n                            <div class="listIndex">\n                                <span>'.concat(n+1,"</span>\n                            </div>"),e.forEach(function(e,t){0!=e.open?a+='<div class="aisleNumderGoods" >\n                                    <div class="aisleNumderClick" fireIndex="'.concat(n+","+t,'">\n                                    <div class="numderTop">                                   \n                                        <img src="').concat(e.goods_images||ee(67),'" alt=""> \n                                    <span>').concat(e.way,'</span>\n                                    </div>\n                                <div class="numderBottom">\n                                        <div class="status1">正常</div>\n                                    <div>数量:').concat(e.count,'</div>\n                                    </div>\n                                    </div>  \n                                    <div class="chooseCheck" data-tip="').concat(e.goods_Name||"",'" data-direction="bottom">\n                                        <span >').concat(e.mail?"(邮寄)":""," ").concat(e.goods_Name||"-","</span>\n                                    </div>\n                                </div>"):a+='<div class="aisleNumderGoods" >\n                                    <div class="aisleNumderClick" fireIndex="'.concat(n+","+t,'">\n                                    <div class="numderTop">\n                                    <img src="').concat(e.goods_images||ee(67),'" alt="">\n                                        <span>').concat(e.way,'</span>\n                                    </div>\n                                    <div class="numderBottom">\n                                        <div class="status2">禁用</div>\n                                        <div>数量:').concat(e.count,'</div>\n                                    </div>\n                                    </div>  \n                                    <div class="chooseCheck" data-tip="').concat(e.goods_Name||"",'" data-direction="bottom">\n                                        <span >').concat(1==e.mail?"(邮寄)":"").concat(e.goods_Name||"","</span>\n                                    </div>\n                                </div>")}),a+=" </div>"}),$(".aisleGoodsCont").html(a),s.render("checkbox"),tooltip(".chooseCheck",{transition:!0,time:200})}$(".relative").click(function(){var e;popupShow("goodsCont","goodsBox"),j?j.reload({where:{condition:sessionStorage.machineGoodsId}}):j=t.render({elem:"#goodsTable",url:"/api/goods/findAll",method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"goods_images",width:100,title:"图片",templet:"#imgtmp"},{field:"goods_Name",width:200,align:"center",title:"商品名",color:"#409eff",templet:function(e){return 1==e.mail?"(邮寄)"+e.goods_Name:e.goods_Name}},{field:"classifyName",align:"center",width:150,title:"商品类目"},(ae(e={field:"mail",align:"center",width:130,title:"是否邮寄商品"},"align","center"),ae(e,"templet",function(e){return 0==e.mail?"否":"是"}),e),{field:"goods_Core",align:"center",width:180,title:"商品编号"},{field:"operation",position:"absolute",right:0,width:80,title:"操作",toolbar:"#GoodsbarDemo"}]],id:"goodsID",page:!0,loading:!0,height:"480",request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineGoodsId,conditionFour:"1"},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}),$(".goodsCont .queryBtnClick").click(function(){j.reload({where:{conditionTwo:$('.goodsCont input[name="GoodsKyeText"]').val(),conditionThree:$("#GoodsType").val()}})}),sessionStorage.independentPass="";var L=null;$("body").on("click",".aisleNumderClick",function(){console.log($(this).attr("fireIndex")),L=$(this).attr("fireIndex").split(","),console.log(L),b?sessionStorage.independentPass?(G(),popupShow("editAisle","editAisleBox")):popupShow("iPasswprd","passwordCont"):o.msg("您没有编辑货道的权限!",{icon:7})}),$(".passBtn").click(function(){var e=JSON.stringify({alonePwd:hex_md5($('.iPasswprd input[name="iPassword"]').val())});loadingAjax("/api/user/verifyAlonePwd","post",e,sessionStorage.token,"mask","iPasswprd","passwordCont",o).then(function(e){sessionStorage.independentPass="true",1==z?U(JSON.stringify({machineId:d.machineId,ways:E})):q?(popupHide("iPasswprd","passwordCont"),popupShow("addDetalis","addCont")):(console.log(1),G(),popupHide("iPasswprd","passwordCont"),popupShow("editAisle","editAisleBox"))}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}),$(".iPasswprd .cancelBtn").click(function(){popupHide("iPasswprd","passwordCont")}),$(".editAisle .cancelBtn").click(function(){popupHide("editAisle","editAisleBox")});var J=null,V={};function G(){J=F[L[0]][L[1]],console.log(J),$('.editAisle input[name="goodsName"]').val(J.goods_Name?1==J.mail?"(邮寄)"+J.goods_Name:J.goods_Name:""),$('.editAisle input[name="goodsName"]').attr("IVal",J.goods_Id||""),$('.editAisle input[name="price"]').val(J.goods_Price||""),$('.editAisle input[name="count"]').val(J.count),$('.editAisle input[name="total"]').val(J.total),s.val("testVal",{testSele:J.open}),V={machineId:d.machineId,way:J.way,goodId:Number(J.goods_Id),newGoodId:Number(J.goods_Id),count:Number(J.count),total:Number(J.total),open:Number(J.open),replenish:J.count}}t.on("row(goodsTable)",function(e){$('.editAisle input[name="goodsName"]').val(1==e.data.mail?"(邮寄)"+e.data.goods_Name:e.data.goods_Name),$('.editAisle input[name="goodsName"]').attr("IVal",e.data.goods_Id),$('.editAisle input[name="price"]').val(e.data.goods_Price),popupHide("goodsCont","goodsBox")}),$(".editAisle .ediaisleBtn").click(function(){var e;$('.editAisle input[name="goodsName"]').attr("IVal")?$('.editAisle input[name="count"]').val()&&$('.editAisle input[name="total"]').val()?Number($('.aisleList input[name="total"]').val())>=Number($('.aisleList input[name="count"]').val())?(e=JSON.stringify({machineId:d.machineId,way:J.way,goodId:Number(J.goods_Id||$('.editAisle input[name="goodsName"]').attr("IVal")),newGoodId:Number($('.editAisle input[name="goodsName"]').attr("IVal")),replenish:J.goods_Id?J.count:0,count:Number($('.editAisle input[name="count"]').val()),total:Number(J.goods_Id?J.total:0),newTotal:Number($('.editAisle input[name="total"]').val()),status:J.open,newStatus:Number($('.editAisle select[name="testSele"]').val())}))!=JSON.stringify(V)?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/api/machine/updateGoodWay","post",e,sessionStorage.token,"mask","editAisle","editAisleBox",o).then(function(e){o.msg(e.message,{icon:1}),M(d.machineId),loadingAjax("/api/refreshGoods","post","",sessionStorage.token).then(function(e){}).catch(function(e){})}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})):popupHide("editAisle","editAisleBox"):o.msg("货道容量不能小于当前数量",{icon:7}):o.msg("数量和容量为为必填",{icon:7}):o.msg("请选择商品",{icon:7})});var q=null;$(".aisleDetails").on("click",".addAisle",function(){q=$(this).attr("indexVal"),sessionStorage.independentPass?popupShow("addDetalis","addCont"):popupShow("iPasswprd","passwordCont")}),$(".addCancelBtn").click(function(){popupHide("addDetalis","addCont")}),$(".addDetalisBtn").click(function(){var e;""!=$('.addDetalis input[name="addNum"]').val()&&0<$('.addDetalis input[name="addNum"]').val()?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({machineId:d.machineId,way:Number(q),count:Number($('.addDetalis input[name="addNum"]').val())}),loadingAjax("/api/machine/insertGoodWay","post",e,sessionStorage.token,"mask","addDetalis","addCont",o).then(function(e){console.log(e),o.msg(e.message,{icon:1}),B(e),$('.addDetalis input[name="addNum"]').val(" ")}).catch(function(e){o.msg(e.message,{icon:2})})):o.msg("数量必须大于0",{icon:7})});var H=1;$('.addDetalis input[name="addNum"]').keyup(function(){var e=$(this).val();/^\d*$/.test(e)?(H=$(this).val(),console.log(H)):(o.msg("只能输入正整数",{icon:7}),$(this).val(H))}),$(".testNumdev input").keyup(function(){var e=$(this).val();/^\d*$/.test(e)||(o.msg("只能输入正整数",{icon:7}),$(this).val(""))});var E=[],z=null;function U(e){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("api/machine/deleteGoodWay","post",e,sessionStorage.token,"mask","","",o).then(function(e){console.log(e),o.msg(e.message,{icon:1}),B(e)}).catch(function(e){o.msg(e.message,{icon:2})})}function R(e,t){e=JSON.stringify({machineId:e});loadingAjax("/api/pay/getMachinePayParam","post",e,sessionStorage.token).then(function(e){loadingAjax("/api/pay/getPayParam","post",JSON.stringify({merchantId:Number(t)}),sessionStorage.token).then(function(t){var a="";e.data.forEach(function(n,e){1==n.status&&(a+='<div class="layui-form-item">\n                                        <label class="layui-form-label">'.concat(n.tName,'：</label>\n                                    <div class="layui-input-block">'),0==n.selectPay.length?a+='<input type="radio" lay-filter="radioTest" name="'.concat(n.id,'" value="').concat("0-0",'" title="无" checked>'):a+='<input type="radio" lay-filter="radioTest" name="'.concat(n.id,'" value="').concat(n.selectPay[0].mpId+"-0",'" title="无" >'),t.data.forEach(function(e,t){n.id==e.payType&&(a+='<input type="radio" lay-filter="radioTest" name="'.concat(n.id,'" value="').concat((0<n.selectPay.length?n.selectPay[0].mpId:0)+"-"+e.id,'" title="').concat(e.payee,'" ').concat(!(n.selectPay.length<=0)&&n.selectPay[0].paramId==e.id?"checked":""," >"))}),a+="</div>\n                        </div>")}),$("#setPayList").html(a),s.render("radio")}).catch(function(e){console.log(e),o.msg(e.message,{icon:2})})}).catch(function(e){o.msg(e.message,{icon:2})})}$(".delBtn").click(function(){E=[],z=1;var n=s.val("delDetalis");console.log(n),"{}"!=JSON.stringify(n)?o.confirm("确定删除？",function(e){for(var t in o.close(e),n)E.push(Number(n[t]));sessionStorage.independentPass?(console.log(E),U(JSON.stringify({machineId:d.machineId,ways:E}))):popupShow("iPasswprd","passwordCont")}):o.msg("请选择需要删除的货道",{icon:7})}),$(".paySet .paySetBtn").click(function(){var e=s.val("paySetData");console.log(e)}),s.on("radio(radioTest)",function(t){o.confirm("确定修改收款账户？",function(e){o.close(e),console.log(t);e=t.value.split("-");console.log(e);e=JSON.stringify({machineId:d.machineId,paramId:Number(e[1]),mpId:Number(e[0])});loadingAjax("/api/pay/updateMachinePayParam","post",e,sessionStorage.token).then(function(e){o.msg(e.message,{icon:1}),R(d.machineId,d.userNum)}).catch(function(e){o.msg(e.message,{icon:2})})},function(){R(d.machineId,d.userNum)})});var W=!1;$(".uploadBtn input").change(function(e){var t,n;$(this).val()&&(t=this,(n=new FormData).append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:i},data:n,success:function(e){$(t).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".ImgCont img").prop("src",e.data.src),$(".ImgCont").show()):o.msg(e.message,{icon:7})},error:function(){$(t).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("上传失败",{icon:2})}}))}),$(".delImgBtn").click(function(){$(".ImgCont img").prop("src",""),$(".ImgCont").hide()}),s.on("switch(machineOpen)",function(e){W=e.elem.checked,e.elem.checked?$(".serviceTitle").slideDown():$(".serviceTitle").slideUp()});var K=!1;s.on("switch(customOpen)",function(e){K=e.elem.checked,e.elem.checked?$(".customTitle").slideDown():$(".customTitle").slideUp()}),$(".uploadBtn2 input").change(function(e){var t,n;$(this).val()&&(t=this,(n=new FormData).append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:i},data:n,success:function(e){$(t).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".customImgCont img").prop("src",e.data.src),$(".customImgCont").show()):o.msg(e.message,{icon:7})},error:function(){$(t).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o.msg("上传失败",{icon:2})}}))}),$(".delImgBtn2").click(function(){$(".customImgCont img").prop("src",""),$(".customImgCont").hide()});var Q,X=[];var Y="",Z="";c.render({elem:"#test8",range:!0,done:function(e){e=e.split(" - ");Y=e[0],Z=e[1]}}),$(".replenishment .RQueryBtn").click(function(){Q.reload({where:{start_time:Y||null,end_time:Z||null}})})})},376:function(e,t){}});