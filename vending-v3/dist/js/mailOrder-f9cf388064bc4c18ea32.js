/*! 版权所有，翻版必究 */!function(d){function e(e){for(var n,t,o=e[0],i=e[1],a=e[2],r=0,s=[];r<o.length;r++)t=o[r],Object.prototype.hasOwnProperty.call(u,t)&&u[t]&&s.push(u[t][0]),u[t]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(d[n]=i[n]);for(p&&p(e);s.length;)s.shift()();return c.push.apply(c,a||[]),l()}function l(){for(var e,n=0;n<c.length;n++){for(var t=c[n],o=!0,i=1;i<t.length;i++){var a=t[i];0!==u[a]&&(o=!1)}o&&(c.splice(n--,1),e=r(r.s=t[0]))}return e}var t={},u={16:0},c=[];function r(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return d[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=d,r.c=t,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)r.d(t,o,function(e){return n[e]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="";var n=window.webpackJsonp=window.webpackJsonp||[],o=n.push.bind(n);n.push=e,n=n.slice();for(var i=0;i<n.length;i++)e(n[i]);var p=o;c.push([153,0]),l()}({153:function(e,n,t){"use strict";t.r(n);n=t(420);layui.use(["table","layer","form","laydate"],function(){var n=layui.table,a=layui.layer,e=(layui.form,layui.laydate),t=n.render({elem:"#mailTableOn",url:"/api/order/getOrderList",method:"post",contentType:"application/json",headers:{token:token},cols:[[{field:"number",width:210,title:"订单编号",align:"center"},{field:"notes",width:210,title:"下单时间",align:"center",templet:function(e){return timeStamp(e.time)}},{field:"sign_name",width:180,title:"收货人",align:"center"},{field:"sign_phone",width:180,title:"收货人电话",align:"center"},{field:"sign_address",width:300,title:"收货地址",align:"center"},{field:"notes",width:230,title:"备注",align:"center",templet:function(e){return e.notes||"-"}},{field:"payType",width:150,title:"付款类型",align:"center",templet:function(e){return 0==e.payType?"支付宝":"微信"}},{field:"payee",width:210,title:"收款账号",align:"center"},{field:"Number",width:150,title:"订单金额",align:"center",templet:function(e){if(0==e.goodsList.lebght)return 0;var n=0;return e.goodsList.forEach(function(e){n+=e.goods_Price*e.count}),n}},{field:"sign_name",width:180,title:"退款状态",align:"center",templet:function(e){var n=0,t=0;return e.goodsList.forEach(function(e){n+=e.count,t+=e.refund_count}),0==t?"未退款":n-t==0?"全部退款":"部分退款"}},{field:"sales_no",width:210,title:"销售经理",align:"center",templet:function(e){return e.sales_no||"-"}},{field:"dispatch_status",width:210,title:"物流状态",align:"center",templet:function(e){return 0==e.dispatch_status?"未发货":1==e.dispatch_status?"已发货":"已售货"}},{field:"express_type",width:190,title:"物流公司/快递公司",align:"center",templet:function(e){return e.express_type||"-"}},{field:"express_number",width:210,title:"物流单号",align:"center",templet:function(e){return e.express_number||"-"}},{field:"operation",width:200,title:"操作 ",fixed:"right",right:0,toolbar:"#barDemo",align:"center"}]],page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{conditionFive:sessionStorage.machineID,conditionSeven:1},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}});$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()});var o=null;n.on("tool(mailTableOn)",function(e){console.log(e),o=e.data,"delivery"==e.event?popupShow("deliveryCont","deliveryBox"):"edit"==e.event?($('.editCont input[name="company"]').val(o.express_type),$('.editCont input[name="logisticsNumber"]').val(o.express_number),popupShow("editCont","editBox")):"goods"==e.event&&(e=e.data.goodsList,n.render({elem:"#GooodsData",cols:[[{field:"goods_images",width:80,title:"图片",templet:"#imgtmp",align:"center"},{field:"goods_Name",width:140,title:"商品名",align:"center",templet:function(e){return 1==e.mail?"(邮寄)"+e.goods_Name:e.goods_Name}},{field:"goods_Core",width:140,title:"商品编号",align:"center"},{field:"count",width:120,title:"购买数量",align:"center"},{field:"refund_count",width:120,title:"已退款数量",align:"center"},{field:"goods_Price",width:130,title:"销售价 ",align:"center"},{field:"goods_Cost",width:130,title:"成本价 ",align:"center"},{field:"operation",right:0,width:80,align:"center",title:"操作",toolbar:"#refundDemo",fixed:"right"}]],data:e,id:"goodsLIstTable",loading:!0,done:function(e){e.data.forEach(function(e){e.goods_Price}),m()}}),popupShow("goodsCont","goodsBox"))}),$(".deliveryCont .cancelBtn").click(function(){popupHide("deliveryCont","deliveryBox")}),$(".deliveryCont .determinePushBtn").click(function(){var e;$('.deliveryBody input[name="company"]').val()&&$('.deliveryBody input[name="logisticsNumber"]').val()?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({number:o.number,express_type:$('.deliveryBody input[name="company"]').val(),express_number:$('.deliveryBody input[name="logisticsNumber"]').val()}),loadingAjax("/api/order/updateMailMsg","post",e,sessionStorage.token,"mask","deliveryCont","deliveryBox",a).then(function(e){a.msg(e.message,{icon:1}),t.reload({where:{}}),$('.deliveryBody input[name="company"]').val(""),$('.deliveryBody input[name="logisticsNumber"]').val("")}).catch(function(e){a.msg(e.message,{icon:2})})):a.msg("带*为必填",{icon:7})}),$(".editCont .cancelBtn").click(function(){popupHide("editCont","editBox")}),$(".editCont .determinePushBtn").click(function(){var e;$('.editCont input[name="company"]').val()&&$('.editCont input[name="logisticsNumber"]').val()?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({number:o.number,express_type:$('.editCont input[name="company"]').val(),express_number:$('.editCont input[name="logisticsNumber"]').val()}),loadingAjax("/api/order/updateOrder","post",e,sessionStorage.token,"mask","editCont","deliveryBox",a).then(function(e){a.msg(e.message,{icon:1}),t.reload({where:{}})}).catch(function(e){a.msg(res.message,{icon:1})})):a.msg("带*为必填",{icon:7})}),$(".pushBtn").click(function(){popupShow("exportCont","exportBox")});var r=null,s=null;e.render({elem:"#test8",type:"month",range:!0,done:function(e){e=e.split(" - ");r=e[0],s=e[1]}}),$(".exportCont .cancelBtn").click(function(){popupHide("exportCont","exportBox")}),$(".exportCont .determinePushBtn").click(function(){var i,e;r&&s?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(i=new XMLHttpRequest).open("POST","/api/order/exportMailExcel",!0),i.setRequestHeader("token",sessionStorage.token),i.setRequestHeader("Content-Type","application/json;charset=utf-8"),i.responseType="blob",i.onload=function(e){var n,t,o;console.log(i),200==i.status?($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),o=i.response,n="".concat(sessionStorage.marchantName,"邮寄订单(").concat(r,"-").concat(s,").xlsx"),(t=document.createElement("a")).download=n,t.style.display="none",o=new Blob([o]),t.href=URL.createObjectURL(o),document.body.appendChild(t),t.click(),document.body.removeChild(t)):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a.msg("服务器请求超时",{icon:2}))},e=JSON.stringify({start_time:r,end_time:s,merchantId:Number(sessionStorage.machineID)}),i.send(e)):a.msg("请选择时间",{icon:7})});var i="",d="";(e=layui.laydate).render({elem:"#test6",range:!0,done:function(e){e=e.split(" - ");i=e[0],d=e[1]}}),$(".queryBtn").click(function(){t.reload({where:{condition:i,conditionTwo:d,conditionThree:$('.key-contnet input[name="orderCode"]').val()}})}),$(".refreshBtn").click(function(){location.reload()});var l=null;n.on("tool(GooodsData)",function(e){2==o.payStatus?(l=e.data,console.log(l),e.data.count!=e.data.refund_count?($(".twoPoles span").html(e.data.count-e.data.refund_count),$(".refundNumber input").val(1),$(".refundNumber input").prop("max",e.data.count-e.data.refund_count),$('.sumInput input[name="sum"]').val(l.goods_Price),popupShow("refundNUmCont","refundBox")):a.msg("该商品已全部退款",{icon:7})):a.msg("订单未支付，不能进行退款操作",{icon:7})}),$(".refundNUmCont .chooseCan").click(function(){popupHide("refundNUmCont","refundBox")});var u=1;$(".refundNumber input").keyup(function(){var e=$(this).val();/^\d*$/.test(e)?(u=$(this).val(),console.log(u)):(a.msg("只能输入正整数",{icon:7}),$(this).val(u)),$('.sumInput input[name="sum"]').val(Number($(this).val()*l.goods_Price)),$('.sumInput input[name="sum"]').val(Number($(this).val()*l.goods_Price))}),$(".refundNumber input").change(function(){$('.sumInput input[name="sum"]').val(Number($(this).val()*l.goods_Price))}),$(".refundNUmCont .determineBtn").click(function(){console.log($(".refundNumber input").val()),0<$(".refundNumber input").val()&&$(".refundNumber input").val()<=l.count-l.refund_count?a.confirm("确定退款？",function(e){var n;a.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),0==o.payType?(n=JSON.stringify({machineId:o.machineId,orderId:o.number,goodId:l.goods_Id,count:Number($(".refundNumber input").val()),amount:Number($('.sumInput input[name="sum"]').val())}),loadingAjax("/api/pay/refund_alipay","post",n,sessionStorage.token,"mask","refundNUmCont","refundBox").then(function(e){a.msg(e.message,{icon:1}),t.reload({where:{}}),popupHide("goodsCont ","goodsBox ")}).catch(function(e){a.msg(e.message,{icon:2})})):1==o.payType&&(n=JSON.stringify({machineId:o.machineId,orderId:o.number,goodId:l.goods_Id,count:Number($(".refundNumber input").val()),amount:Number($('.sumInput input[name="sum"]').val()),transaction_id:o.transaction_id,total:o.amount}),loadingAjax("/api/pay/refund_wxpay","post",n,sessionStorage.token,"mask","refundNUmCont","refundBox").then(function(e){a.msg(e.message,{icon:1}),t.reload({where:{}}),popupHide("goodsCont ","goodsBox ")}).catch(function(e){a.msg(e.message,{icon:2})}))}):a.msg("请按照提示填写数量",{icon:7})});var c=!1,p=!1;function m(){c?$(".pushBtn").removeClass("hide"):$(".pushBtn").addClass("hide"),p?$(".refundBtnTwo").removeClass("hide"):$(".refundBtnTwo").addClass("hide")}permissionsVal(420,421).then(function(e){c=e.addFlag,p=e.editFlag,m()}).catch(function(e){a.msg("服务器请求超时",{icon:7})})})},420:function(e,n){}});