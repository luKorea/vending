/*! 版权所有，翻版必究 */!function(d){function e(e){for(var t,a,i=e[0],n=e[1],o=e[2],s=0,r=[];s<i.length;s++)a=i[s],Object.prototype.hasOwnProperty.call(c,a)&&c[a]&&r.push(c[a][0]),c[a]=0;for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(d[t]=n[t]);for(u&&u(e);r.length;)r.shift()();return m.push.apply(m,o||[]),l()}function l(){for(var e,t=0;t<m.length;t++){for(var a=m[t],i=!0,n=1;n<a.length;n++){var o=a[n];0!==c[o]&&(i=!1)}i&&(m.splice(t--,1),e=s(s.s=a[0]))}return e}var a={},c={8:0},m=[];function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return d[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=d,s.c=a,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var t=window.webpackJsonp=window.webpackJsonp||[],i=t.push.bind(t);t.push=e,t=t.slice();for(var n=0;n<t.length;n++)e(t[n]);var u=i;m.push([141,0]),l()}({141:function(e,t,a){"use strict";a.r(t);a(385);layui.use(["laydate","table","layer","tree"],function(){var l=sessionStorage.token,c=layui.layer,a=layui.form,e=layui.laydate,t=layui.tree,i="",n="";e.render({elem:"#test6",range:!0,done:function(e){console.log(e),timerKey=e.split(" - "),console.log(timerKey),i=timerKey[0],n=timerKey[1]}});var o=layui.table,m=o.render({elem:"#moneyData",url:"/api/advertising/selectAdvertising",method:"post",contentType:"application/json",headers:{token:l},cols:[[{type:"checkbox"},{field:"img",width:120,title:"微缩图",templet:"#imgtmp"},{field:"name",width:150,title:"素材名"},{field:"size",width:100,title:"大小(MB)"},{field:"advertisingAttribute",width:150,title:"素材属性",templet:function(e){return 0==e.advertisingAttribute?"图片":"视频"}},{field:"advertisingType",width:150,title:"素材类别",templet:function(e){return 0==e.advertisingType?"横屏":"竖屏"}},{field:"duration",width:100,title:"播放时长"},{field:"checkStatus",width:160,title:"审核状态",templet:function(e){return 0==e.checkStatus?"未审核":1==e.checkStatus?"待审核":2==e.checkStatus?"审核通过":"审核不通过"}},{field:"advertisingStatus",width:160,title:"素材状态",templet:function(e){return"1"==e.advertisingStatus?"启用":"不启用"}},{field:"addUser",width:150,title:"创建人 "},{field:"creationTime",width:160,title:"创建时间"},{field:"operation",right:0,width:200,title:"操作",toolbar:"#barDemo",align:"center",fixed:"right"}]],page:!0,id:"tableId",loading:!0,height:"full-200",request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:Number(sessionStorage.machineID)},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){B(),403==e.code?window.parent.location.href="login.html":405==e.code&&$(".hangContent").show()}});$(".keyQueryBtn").click(function(){var e=a.val("KeyValData"),t=a.val("keyStatus");console.log(e),m.reload({where:{keyWord:e.name,attribute:e.attribute,type:e.type,checkStatus:e.checkStatus,minSize:e.minSize,maxSize:e.maxSize,status:t.advertisingStatus,startTime:i,endTime:n}})}),$(".uploadBtn").click(function(){y?($(".uploadTitle").fadeIn(),$(".titleBox").removeClass("margin0")):c.msg("您没有上传广告素材权限!",{iocn:7})}),$(".titleHeader button").click(function(){$(".uploadTitle").fadeOut(),$(".titleBox").addClass("margin0")}),$(".issue").click(function(){popupHide("uploadTitle","titleBox"),popupShow("uploadMaterialCont","uploadMateriaBox")}),$(".uploadMateriaFooter .cancel-btn").click(function(){popupHide("uploadMaterialCont","uploadMateriaBox")}),$(".del-btn").click(function(){var e,a;I?(e=o.checkStatus("tableId"),console.log(e),console.log,a=null,0<e.data.length?(a=e.data.map(function(e,t){return e.vid}),console.log(a),c.confirm("确定删除？",function(t){$.ajax({type:"post",url:"/api/advertising/deleteAdvertising",headers:{"Content-Type":"application/json",token:l},data:JSON.stringify({list:a}),success:function(e){console.log(e),c.close(t),200==e.code?(c.msg(e.message,{icon:1}),m.reload({where:{}})):201==e.code?c.msg(e.message,{icon:7}):202==e.code?(c.msg(e.message,{icon:7}),m.reload({where:{}})):403==e.code?window.parent.location.href="login.html":c.msg(e.message,{icon:7})}})})):c.msg("请选择要删除的素材",{icon:7})):c.msg("您没有删除广告素材权限!",{iocn:7})}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".on-left").show()}),$(".on-left").click(function(){$(".left-mian").show(),$(".on-left").hide()});var s=null,r=null,d=null,u=null;function g(e,t,a,i,n,o,s,r,d){$.ajax({type:"post",url:"/api/advertising/updateAdvertising",headers:{"Content-Type":"application/json",token:l},data:JSON.stringify({vid:e,name:t,advertisingAttribute:a,advertisingStatus:i,advertisingType:n,duration:o,img:s,url:d,size:r}),success:function(e){200==e.code?(popupHide("editMaterialCont","uploadMateriaBox"),m.reload({where:{}}),c.msg(e.message,{icon:1})):403==e.code?window.parent.location.href="login.html":c.msg(e.message)}})}o.on("tool(moneyData)",function(e){if(s=e.data,"preview"==e.event)-1<s.img.indexOf("mp4")?$(".imgCont video").attr("src",s.img).show().siblings().hide():$(".imgCont img").attr("src",s.img).show().siblings().hide(),popupShow("materialPreview","previewBox");else if("edit"==e.event){if(!b)return void c.msg("您没有编辑广告素材权限!",{iocn:7});popupShow("editMaterialCont","uploadMateriaBox"),a.val("editValData",{materialName:s.name,materiaAttribute:s.advertisingAttribute,materiaType:s.advertisingType,materiaStatus:s.advertisingStatus}),"0"==s.checkStatus?($('.editCont select[name="materiaAttribute"]').prop("disabled",""),$('.editCont select[name="materiaType"]').prop("disabled",""),a.render(),$(".materiaDowEdit").show().children().show(),"0"==s.advertisingAttribute?($(".editImgBtn").show().siblings(".editVideoBtn").hide(),$(".materiaImgEdit img").attr("src",s.img).show().siblings().hide()):($(".editVideoBtn").show().siblings(".editImgBtn").hide(),$(".materiaImgEdit video").attr("src",s.img).show().siblings().hide())):($('.editCont select[name="materiaAttribute"]').prop("disabled",!0),$('.editCont select[name="materiaType"]').prop("disabled",!0),a.render(),$(".editImgBtn").hide(),$(".editVideoBtn").hide(),$(".materiaDowEdit").hide().children().hide(),$(".materiaImgEdit img").hide().siblings().hide())}}),$(".submitAuditBtn").click(function(){var e=o.checkStatus("tableId");console.log(e);var i=[];0<e.data.length?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e.data.forEach(function(e,t){var a={id:e.vid,status:"1"};i.push(a),console.log(i)}),k("1",i,"/api/advertising/submitAdvertisingStatus")):c.msg("请选择需要提交审核的素材",{icon:7})}),$(".approvedBtn").click(function(){var t=o.checkStatus("tableId"),i=[];0<t.data.length?c.confirm("确定审核通过？",function(e){c.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),t.data.forEach(function(e,t){var a={id:e.vid,status:"2"};i.push(a)}),k("0",i,"/api/advertising/checkAdvertisingStatus")}):c.msg("请选择需要通过审核的素材",{icon:7})}),$(".noPassBtn").click(function(){var t,i;S?(t=o.checkStatus("tableId"),i=[],0<t.data.length?c.confirm("确定审核不通过？",function(e){c.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),t.data.forEach(function(e,t){var a={id:e.vid,status:"3"};i.push(a)}),k("0",i,"/api/advertising/checkAdvertisingStatus")}):c.msg("请选择需要不通过审核的素材",{icon:7})):c.msg("您没有审核广告素材权限!",{iocn:7})}),$(".editConfirmBtn").click(function(){var t=a.val("editValData");console.log(t),"0"==s.checkStatus?$.ajax({type:"post",url:"/api/advertising/findAdvertising",headers:{"Content-Type":"application/json",token:l},data:JSON.stringify({id:s.vid}),success:function(e){console.log(e),200==e.code&&("0"==e.data?(console.log(r.indexOf("jpg")),1<r.indexOf("jpg")||1<r.indexOf("png")||1<r.indexOf("gif")&&"0"==t.materiaAttribute||1<r.indexOf("mp4")&&"1"==t.materiaAttribute?g(s.vid,t.materialName,t.materiaAttribute,t.materiaStatus,t.materiaType,u,r,d.slice(0,4),s.url):c.msg("素材属性不正确",{icon:7})):c.confirm("检测到当前素材只能修改素材名和状态，是否继续修改？",function(e){g(s.vid,t.materialName,t.materiaAttribute,t.materiaStatus,t.materiaType,s.duration,s.img,s.size,s.url),c.close(e)}))}}):(console.log(),g(s.vid,t.materialName,t.materiaAttribute,t.materiaStatus,t.materiaType,s.duration,s.img,s.size,s.url))}),a.on("select(EditSelect)",function(e){console.log(e.value),"0"==e.value?($(".editImgBtn").show().siblings(".editVideoBtn").hide(),$(".materiaImgEdit img").show().siblings().hide()):($(".editVideoBtn").show().siblings(".editImgBtn").hide(),$(".materiaImgEdit video").show().siblings().hide())}),$('.editImgBtn input[name="editImg"]').change(function(e){var t=this;d=e.target.files[0].size/1024/1024+"";var a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:l},data:a,success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?(r=e.data.src,$(".materiaImgEdit img").attr("src",r),$(".materiaImgEdit video").attr("src",""),$(t).val()):403==e.code?window.parent.location.href="login.html":c.msg(e.message,{icon:2})},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("图片上传失败",{icon:2})}})}),$('.editVideoBtn input[name="editVideo"]').change(function(e){d=e.target.files[0].size/1024/1024+"";var t=this,a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:l},data:a,success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),0==e.code?(r=e.data.src,$(".materiaImgEdit video").attr("src",r),$(".materiaImgEdit img").attr("src",""),$("#EditVideo")[0].addEventListener("loadedmetadata",function(){u=parseInt(this.duration),console.log(u)}),$(t).val()):403==e.code?window.history.go(-1):c.msg(e.message)},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("视频上传失败",{icon:2})}})}),$(".editCancelBtn").click(function(){popupHide("editMaterialCont","uploadMateriaBox")}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),a.on("select(myAttribute)",function(e){"0"==e.value?($(".VideoBtn").hide(),$(".ImgBtn").fadeIn(),$(".materiaDow video").hide(),p||h?($(".materiaDow").show(),$(".materiaDow img").show()):$(".materiaDow").hide()):"1"==e.value?($(".ImgBtn").hide(),$(".VideoBtn").fadeIn(),$(".materiaDow img").hide(),p||h?($(".materiaDow").show(),$(".materiaDow video").show()):$(".materiaDow").hide()):($(".ImgBtn").fadeOut(),$(".VideoBtn").fadeOut(),$(".materiaDow").hide())});var p=null,f=null,h=null;$('.ImgBtn input[name="ImgFile"]').change(function(e){$(".materiaImg img").attr("src",""),base64(e.target.files[0],".materiaImg img"),$(".materiaImg video").hide(),$(".materiaDow").show(),$(".materiaDow img").show(),p=e.target.files[0],f=e.target.files[0].size/1024/1024+"",$(this).val("")});var v=null;function k(e,t,a){$.ajax({type:"post",url:a,headers:{"Content-Type":"application/json",token:l},data:JSON.stringify({data:t,type:e}),success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),200==e.code?(c.msg(e.message,{icon:1}),m.reload({where:{}})):201==e.code?c.msg(e.message,{icon:2}):202==e.code?(c.msg(e.message,{icon:7}),m.reload({where:{}})):403==e.code?window.parent.location.href="login.html":c.msg(e.message,{icon:2})}})}$('.VideoBtn input[name="videoFile"]').change(function(e){var t=$(this);$(".materiaImg video").attr("src",""),$(".materiaImg img").hide();var a=new FormData;a.append("file",e.target.files[0]),f=e.target.files[0].size/1024/1024+"",console.log(f),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:l},data:a,success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),0==e.code?($(".materiaDow").show(),$(".materiaDow video").show(),$(".materiaImg video").attr("src",e.data.src),h=e.data.src,$("#video")[0].addEventListener("loadedmetadata",function(){v=parseInt(this.duration),console.log(v)}),t.val("")):c.msg(e.msg)},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("上传视频失败",{icon:2})}})}),$(".confirmBtn").click(function(){var e,t=a.val("uploadValData");console.log(t),t.materiaAttribute&&t.materiaType&&t.materialName?h||p?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),(e=new FormData).append("file",p),console.log(222),setTimeout(function(){"0"==t.materiaAttribute&&$.ajax({type:"post",url:"/api/fileUpload",async:!1,processData:!1,contentType:!1,headers:{token:l},data:e,success:function(e){if(console.log(e),0!=e.code)return c.msg(e.message),!1;h=e.data.src},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("上传图片失败",{icon:icon})}}),$.ajax({type:"post",url:"/api/advertising/saveAdvertising",headers:{"Content-Type":"application/json",token:l},async:!1,data:JSON.stringify({advertisingAttribute:t.materiaAttribute,advertisingStatus:t.materiaStatus,advertisingType:t.materiaType,duration:v,img:h,name:t.materialName,size:f.slice(0,4),merchantId:sessionStorage.machineID}),success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),200==e.code?(popupHide("uploadMaterialCont","uploadMateriaBox"),m.reload({where:{}}),c.msg(e.message,{icon:1}),a.val("uploadValData",{materialName:"",materiaAttribute:"",materiaType:"",materiaStatus:""}),$(".uploadMaterialCont .materiaImg video").hide(),$(".uploadMaterialCont .materiaDow").hide(),$(".uploadMaterialCont .materiaDow img").hide(),$(".uploadMaterialCont .ImgBtn").hide(),$(".uploadMaterialCont .VideoBtn").hide(),p=h=null):403==e.code?window.history.go(-1):c.msg(e.message,{icon:2})},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),c.msg("服务器请求超时",{icon:2})}})},300)):c.msg("请上传图片或视频",{icon:7}):c.msg("带*为必填",{icon:7})});var w=treeList();treeFun(t,"test1",m,w,"merchantId"),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var y=!1,b=!1,I=!1,S=!1;permissionsFun("/api/role/findUserPermission","post",sessionStorage.token,c).then(function(e){console.log(e.data),y=e.data.some(function(e,t){return"362"==e.id}),b=e.data.some(function(e,t){return"371"==e.id}),I=e.data.some(function(e,t){return"369"==e.id}),S=e.data.some(function(e,t){return"387"==e.id})}).catch(function(e){c.msg(e.message,{icon:2})});var y=!1,b=!1,I=!1,C=!1;function B(){y?$(".addBtn").removeClass("hide"):$(".addBtn").addClass("hide"),b?$(".editBtn").removeClass("hide"):$(".editBtn").addClass("hide"),I?$(".del-Btn").removeClass("hide"):$(".del-Btn").addClass("hide"),C?$(".auditBtnTwo").removeClass("hide"):$(".auditBtnTwo").addClass("hide")}permissionsVal(362,371,369,387).then(function(e){y=e.addFlag,b=e.editFlag,I=e.delFlag,C=e.fourFlag,B()}).catch(function(e){c.msg("服务器请求超时",{icon:7})}),$(".refreshBtn").click(function(){location.reload()})})},385:function(e,t){}});