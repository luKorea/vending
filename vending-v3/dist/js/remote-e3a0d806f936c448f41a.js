/*! 版权所有，翻版必究 */!function(s){function e(e){for(var n,t,o=e[0],a=e[1],i=e[2],r=0,l=[];r<o.length;r++)t=o[r],Object.prototype.hasOwnProperty.call(p,t)&&p[t]&&l.push(p[t][0]),p[t]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(s[n]=a[n]);for(u&&u(e);l.length;)l.shift()();return d.push.apply(d,i||[]),c()}function c(){for(var e,n=0;n<d.length;n++){for(var t=d[n],o=!0,a=1;a<t.length;a++){var i=t[a];0!==p[i]&&(o=!1)}o&&(d.splice(n--,1),e=r(r.s=t[0]))}return e}var t={},p={28:0},d=[];function r(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return s[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=s,r.c=t,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)r.d(t,o,function(e){return n[e]}.bind(null,o));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="";var n=window.webpackJsonp=window.webpackJsonp||[],o=n.push.bind(n);n.push=e,n=n.slice();for(var a=0;a<n.length;a++)e(n[a]);var u=o;d.push([150,0]),c()}({150:function(e,n,t){"use strict";t.r(n);n=t(414);layui.use(["table","form","layer","tree"],function(){var n=layui.table,t=layui.form,m=layui.layer,e=layui.tree,o=sessionStorage.machineID,a=n.render({elem:"#appList",url:"/api/app/getAppVersionList",method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"version_code",width:180,title:"版本号",align:"center"},{field:"version_name",width:180,title:"版本名",align:"center"},{field:"apk_url",width:350,title:"下载地址",align:"center"},{field:"content",width:350,title:"描述",align:"center"},{field:"upload_user",width:150,title:"创建人",align:"center"},{field:"upload_time",width:180,title:"创建时间",align:"center",templet:function(e){if(e.upload_time){var n=new Date(e.upload_time);return n.getFullYear()+"-"+(n.getMonth()+1)+"-"+(e=n.getDate())+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()}return""}},{field:"operation",fixed:"right",right:0,width:180,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",loading:!0,parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$(".addAppBtn").click(function(){popupShow("addAppCOnt","addAppBox")}),$(".addAppCOnt .addCancelBtn").click(function(){popupHide("addAppCOnt","addAppBox")});var f;$('.relative input[name="uploadImg"]').change(function(n){var o,a,i,t,r,l,s,c,p=this,d=$(this).attr("indexFlag");function u(){var e=new FileReader;e.onload=s,e.onerror=c;var n=r*i,t=n+i>=a.size?a.size:n+i;e.readAsArrayBuffer(o.call(a,n,t))}$(this).val()&&($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=this.files[0],i=2097152,t=Math.ceil(a.size/i),r=0,l=new SparkMD5.ArrayBuffer,s=function(e){l.append(e.target.result),++r<t?u():(f=l.end(),console.log(100),console.log(r),console.log(t),$('input[name="AppMD"]').val(f),console.log(f),(e=new FormData).append("file",n.target.files[0]),$.ajax({type:"post",url:"/api/fileUpload",processData:!1,contentType:!1,headers:{token:token},data:e,success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?("add"==d?$('.addAppCOnt input[name="apk_url"]').val(e.data.src):(d="edit",$('.editAppCont input[name="apk_url"]').val(e.data.src)),m.msg("上传成功",{icon:1}),$(".uploadTitle label").html("已上传")):(m.msg("上传失败",{icon:2}),$(p).val(""))},error:function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),m.msg("上传失败",{icon:2}),$(p).val("")}}))},c=function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),m.msg("上传文件失败"),$(p).val("")},u())}),$(".footerBtn .RdetermineBtn").click(function(){var e=t.val("addAppVal");console.log(1),e.version_code&&e.version_name&&e.apk_url?e.AppMD?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content}),loadingAjax("/api/app/uploadApp","post",e,sessionStorage.token,"mask","addAppCOnt","addAppBox",m).then(function(e){console.log(e),m.msg(e.message,{icon:1}),a.reload({where:{}}),t.val("addAppVal",{version_code:"",version_name:"",apk_url:"",AppMD:"",content:""}),$(".uploadTitle label").html("未上传")}).catch(function(e){console.log(e),m.msg(e.message,{icon:2})})):m.msg("请上传App文件",{icon:7}):m.msg("带*为必填",{icon:7})});var i=null;n.on("tool(appList)",function(e){console.log(e),i=e.data,"edit"==e.event?(t.val("editAppVal",{version_code:i.version_code,version_name:i.version_name,apk_url:i.apk_url,AppMD:i.verify,content:i.content}),popupShow("editAppCont","editAppBox")):"upload"==e.event&&(l=l||n.render({elem:"#machineList",url:"/api/machine/getMachineList",method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{checkbox:!0},{field:"number",width:180,title:"终端编号",align:"center",templet:function(e){return e.number||"-"}},{field:"终端信息",width:180,title:"终端信息",align:"center",templet:function(e){return e.info?"<div>".concat(e.info,"</div>"):'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>'}},{field:"location",width:180,title:"地址",align:"center",templet:function(e){return e.location||" - "}},{field:"appVersion",width:180,align:"center",title:"软件版本"},{field:"merchantName",width:150,align:"center",title:"所属商户"}]],id:"mId",loading:!0,page:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(){}}),popupShow("machineListCOnt","machineBox"))}),$(".editAppCont .editCancelBtn").click(function(){popupHide("editAppCont","editAppBox")}),$(".editAppCont .rdetermineBtn").click(function(){var e=t.val("editAppVal");e.version_code&&e.version_name&&e.apk_url?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content,id:i.id}),loadingAjax("/api/app/updateAppInfo","post",e,sessionStorage.token,"mask","editAppCont","editAppBox",m).then(function(e){m.msg(e.message,{icon:1}),a.reload({where:{}})}).catch(function(e){m.msg(e.message,{icon:2})})):m.msg("带*为必填",{icon:7})});var r=treeList();e.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:r,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),l.reload({where:{merchantId:e.data.id}}),o=e.data.id;for(var n=$("#test1 .layui-tree-txt"),t=0;t<n.length;t++)n[t].innerHTML===e.data.title?n[t].style.color="#be954a":n[t].style.color="#555"}});var l=null;$(".machineListCOnt .cancelBtn").click(function(){popupHide("machineListCOnt","machineBox")});var s=null,c=[];$(".machineListCOnt .pushBtn").click(function(){console.log(n.checkStatus("mId")),c=[],0<(s=n.checkStatus("mId")).data.length?m.confirm("确定编辑售货机App版本？",function(e){m.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");s.data.forEach(function(e,n){"".concat(e.machineId,","),c.push(e.machineId)}),console.log();e=JSON.stringify({version_code:i.version_code,machineId:c,merchantId:Number(o)});loadingAjax("/api/app/updateMachineApp","post",e,sessionStorage.token,"mask","machineListCOnt","machineBox",m).then(function(e){console.log(e),m.msg(e.message,{icon:1})}).catch(function(e){m.msg(e.message,{icon:2})})}):m.msg("请选择需要修改app版本的售货机",{icon:7})})})},414:function(e,n){}});