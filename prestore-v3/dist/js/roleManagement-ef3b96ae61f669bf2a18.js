/*! 版权所有，翻版必究 */!function(l){function e(e){for(var t,n,o=e[0],i=e[1],a=e[2],r=0,c=[];r<o.length;r++)n=o[r],Object.prototype.hasOwnProperty.call(d,n)&&d[n]&&c.push(d[n][0]),d[n]=0;for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t]);for(p&&p(e);c.length;)c.shift()();return u.push.apply(u,a||[]),s()}function s(){for(var e,t=0;t<u.length;t++){for(var n=u[t],o=!0,i=1;i<n.length;i++){var a=n[i];0!==d[a]&&(o=!1)}o&&(u.splice(t--,1),e=r(r.s=n[0]))}return e}var n={},d={6:0},u=[];function r(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return l[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=l,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var t=window.webpackJsonp=window.webpackJsonp||[],o=t.push.bind(t);t.push=e,t=t.slice();for(var i=0;i<t.length;i++)e(t[i]);var p=o;u.push([339,0]),s()}({339:function(e,t,n){"use strict";n.r(t);var t=n(356),y=n(1);layui.use(["table","form","layer","tree","util"],function(){var a=layui.form,r=layui.jquery,e=layui.table,n=layui.layer,c=sessionStorage.token,l=e.render({elem:"#tableTest",url:"".concat(Vapi,"/role/findAll"),method:"GET",headers:{token:c},cols:[[{field:"roleName",width:180,title:"角色名",align:"center"},{field:"remark",width:200,title:"备注",align:"center"},{field:"addUser",width:150,title:"创建人",align:"center",templet:function(e){return e.addUser?e.addUser.username:""}},{field:"addTime",width:200,title:"添加时间",align:"center"},{field:"updateUser",width:150,title:"最后修改人",align:"center",templet:function(e){return e.updateUser?e.updateUser.username:""}},{field:"updateTime",width:200,title:"最后修改时间",align:"center"},{field:"operation",position:"absolute",align:"center",right:0,width:200,title:"操作",toolbar:"#barDemo"}]],id:"tableId",page:!0,loading:!0,limits:[10,20,50],even:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{},parseData:function(e){return 200===e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403===e.code&&(n.msg("登录过期,请重新登录",{icon:2}),setTimeout(function(e){window.parent.location.href="login.html"},1500)),Object(y.c)()}}),t=r('.addInput input[name="roleName"]'),o=r('.addInput input[name="remark"]'),s=r('.editInput input[name="roleName"]'),d=r('.editInput input[name="remark"]');r(".playHeader .close").click(function(){r(this).parent().parent().addClass("margin0"),r(this).parents(".maskContnet").fadeOut()});var u=null,i=null,p=[],f=null;function m(e,t){Object(y.f)("/role/findByRId?id=".concat(e),"get",c).then(function(e){i=e.data,function(o,i,e){var n='<div>\n        <input type="checkbox" lay-filter="permissionsAll" name="'.concat(i,'" title="全选"\n            lay-skin="primary"  value="" >\n         </div>');o.forEach(function(e,t){n+='<div>\n                            <input type="checkbox" lay-filter="permissions" name="'.concat(e.controlId,'" \n                            title="').concat(e.controlName,'"\n                                lay-skin="primary"  value="').concat(e.controlId,'" >\n                        </div>')});var t=r(".".concat(i));t.empty(),t.html(n),e.forEach(function(e,t){for(var n=1;n<r(".".concat(i," input")).length;n++)e.controlId==o[n-1].controlId&&r(".".concat(i," input")).eq(n).prop("checked",!0)}),a.render("checkbox")}(p,"permissionsGeneral",i),t&&g(h)}).catch(function(e){console.log(e)})}e.on("tool(test)",function(e){f=e.data,event.stopPropagation(),s.val(f.roleName),d.val(f.remark),"operation"===e.event&&(e.data.id,r(".ListOperation").fadeIn(),r(".ListOperation").css({left:r(this).offset().left-35+"px",top:r(this).offset().top+35+"px"}))}),r(".submitBtn").click(function(){t.val()?r.ajax({type:"post",url:"".concat(Vapi,"/role/addRole"),headers:{"Content-Type":"application/json",token:c},data:JSON.stringify({roleName:t.val(),remark:o.val()}),success:function(e){Object(y.i)(".MemberOperation",".MemberContent"),200===e.code?(n.msg(e.message,{icon:1}),t.val(""),o.val(""),l.reload({where:{}})):403==e.code?window.history.go(-1):n.msg(e.message,{icon:2})},error:function(){n.msg("服务器请求超时",{icon:2})}}):n.msg("带*为必填",{icon:7})}),u||r.ajax({type:"GET",url:"".concat(Vapi,"/role/findControl"),headers:{"Content-Type":"application/json",token:c},async:!1,success:function(e){200===e.code&&(u=e.data,e.data.forEach(function(e){p.push(e)}))}}),r(".ListOperation .edit").click(function(){Object(y.j)(".editRold",".editBox"),r(".permissionsContList").show(),m(f.roleId)}),r(".edittBtn").click(function(){r(".mask").fadeIn(),r(".maskSpan").addClass("maskIcon");var i=[];s.val()?function(){var e,o=a.val("editInformation");for(e in o)!function(n){u.forEach(function(e,t){String(e.controlId)===o[n]&&i.push(e.controlId)})}(e);r.ajax({type:"post",url:"".concat(Vapi,"/role/updateRole"),headers:{"Content-Type":"application/json",token:c},data:JSON.stringify({roleId:f.roleId,roleName:s.val(),remark:d.val(),controlList:i}),success:function(e){r(".mask").fadeOut(),r(".maskSpan").removeClass("maskIcon"),Object(y.i)(".editRold",".editBox"),200==e.code?(n.msg(e.message,{icon:1}),n.open({content:"用户权限已经修改，请重新登陆",btn:["确定"],yes:function(e){n.close(e),sessionStorage.clear(),window.parent.location.href="login.html"},cancel:function(){return!1}}),l.reload({where:{}})):403===e.code?window.parent.location.href="login.html":n.msg(e.message,{icon:2})},error:function(){n.msg("服务器请求超时",{icon:2})}})}():n.msg("带*为必填",{icon:7})}),r(".ListOperation .del").click(function(){m(f.id),n.confirm("确定删除？",function(t){r.ajax({type:"post",url:"".concat(Vapi,"/role/deleteRole"),headers:{"Content-Type":"application/json",token:c},data:JSON.stringify({id:f.id}),success:function(e){n.close(t),200==e.code?(g(h),n.msg(e.message,{icon:1}),l.reload({where:{}})):403==e.code?window.parent.location.href="login.html":n.msg(e.message,{icon:2})},error:function(){n.msg("服务器请求超时",{icon:2})}})})}),r(".addBtn").click(function(){Object(y.j)(".MemberOperation",".MemberContent")}),r(".cancel_btn").click(function(){Object(y.i)(".MemberOperation",".MemberContent")}),r(".editCancelbtn").click(function(){Object(y.i)(".editRold",".editBox")}),r(".refreshBtn").click(function(){location.reload()}),r("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()});var h=[];function g(e){e.forEach(function(e,t){e=JSON.stringify({uid:e,msg:"用户角色权限发生变更,请重新登录！",tag:1});loadingAjax("/pushWebMsg","post",e,sessionStorage.token).then(function(e){console.log(e)}).catch(function(e){console.log(e)})})}r(".queryBtnClick").click(function(){l.reload({where:{roleName:r(".KyeText").val()}})}),a.on("checkbox(permissionsAll)",function(e){var t=r(e.elem).attr("name");e.value||(e.elem.checked?r(".".concat(t," input")).prop("checked",!0):r(".".concat(t," input")).prop("checked",!1),a.render("checkbox"))}),r("body").click(function(){r(".ListOperation").fadeOut(),0})})},356:function(e,t){}});