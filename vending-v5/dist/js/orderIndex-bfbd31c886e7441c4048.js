/*! 版权所有，翻版必究 */!function(e){function n(n){for(var a,r,s=n[0],c=n[1],d=n[2],p=0,u=[];p<s.length;p++)r=s[p],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(l&&l(n);u.length;)u.shift()();return o.push.apply(o,d||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],a=!0,s=1;s<t.length;s++){var c=t[s];0!==i[c]&&(a=!1)}a&&(o.splice(n--,1),e=r(r.s=t[0]))}return e}var a={},i={27:0},o=[];function r(n){if(a[n])return a[n].exports;var t=a[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=a,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)r.d(t,a,function(n){return e[n]}.bind(null,a));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=n,s=s.slice();for(var d=0;d<s.length;d++)n(s[d]);var l=c;o.push([613,0]),t()}({613:function(e,n,t){"use strict";t.r(n);t(693);var a=t(2);$("#city").val("");var i=t(79);function o(e){e=e;var n=i.enc.Utf8.parse("yuebaowenhua2020"),t=i.AES.encrypt(e,n,{iv:i.enc.Utf8.parse("A-16-Byte-String"),mode:i.mode.CBC,padding:i.pad.Pkcs7});return String(t)}var r=Object(a.b)("goods"),s=null;$.ajax({type:"post",url:"/api/order/getMailData",timeout:1e4,headers:{"Content-Type":"application/json"},data:JSON.stringify({key:r}),success:function(e){$(".mask").hide(),200==e.code?function(e){var n=e,t=i.enc.Utf8.parse("yuebaowenhua2020"),o=i.AES.decrypt(n.toString(),t,{iv:i.enc.Utf8.parse("A-16-Byte-String"),mode:i.mode.CBC,padding:i.pad.Pkcs7}).toString(i.enc.Utf8);(s=JSON.parse(o)).payee.forEach(function(e){c.push(e.payType)});var r=navigator.userAgent.toLowerCase();if("alipay"==r.match(/Alipay/i)){if(-1==c.indexOf(1))return $(".determineCont h1").html("当前不支持支付宝付款，请使用其他方式进行扫码购买！"),void $(".determineCont").show();l=1,d=s.payee[c.indexOf(1)]}else{if("micromessenger"!=r.match(/MicroMessenger/i))return $(".determineCont h1").html("请使用支付宝或者微信扫码进行购买！"),void $(".determineCont").show();if(-1==c.indexOf(2))return $(".determineCont h1").html("当前不支持微信付款，请使用其他方式进行扫码购买！"),void $(".determineCont").show();l=2,function(e){var n=Object(a.b)("code"),t=e,i=window.location.href;if(null==n||""==n)window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=".concat(t,"&redirect_uri=").concat(encodeURIComponent(i),"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"),scope=snsapi_base;else{var o=JSON.stringify({code:n,machineId:s.machineId});Object(a.d)("/api/pay/wxLogin","post",o).then(function(e){p=e.data}).catch(function(e){Object(a.g)("微信授权失败")})}}((d=s.payee[c.indexOf(2)]).app_id)}$(".wrap").show(),u=s.goods,f="",u.forEach(function(e){f+='<li class="list flex">\n                        <div class="img">\n                            <img src="'.concat(e.goods_img,'" />\n                        </div>\n                        <div class="goodsInform">\n                            <h5>').concat(e.goods_Name,'</h5>\n                            <div class="flexC of">\n                                <p>单价：￥').concat(Object(a.f)(e.goods_Price),"</p>\n                               \n                                <p>X").concat(e.count,"</p>\n                            </div>\n                            <h5>总价：￥").concat(Number(e.goods_Price)*Number(e.count),"</h5>\n                        </div>\n                    </li>")}),$(".goodsList").html(f);var u,f;var m=JSON.stringify({machine:s.machineId});console.log(s,"商品数据"),console.log(s.goods[0].mail,"类型"),1==s.goods[0].mail?($(".userInformation1").show(),$(".userInformation2").hide(),$(".footer2").hide(),$(".footer1").show(),document.title="邮寄商品购买",$(".header h1").html("邮寄商品购买")):0==s.goods[0].mail&&($(".userInformation1").hide(),$(".userInformation2").show(),$(".footer2").show(),$(".footer1").hide(),document.title="商品购买",$(".header h1").html("商品购买"));Object(a.d)("/api/scanSuccess","post",m).then(function(e){}).catch(function(e){})}(e.data):Object(a.g)("页面初始化失败")},error:function(e){$(".mask").hide(),Object(a.g)("页面初始化失败")}});var c=[],d="",l="",p="";$("#city").click(function(e){SelCity(this,e)});$(".footer1 h1").click(function(){if($("#hcity").val()&&$("#hproper").val()&&$("#harea").val())if($(".address").val()&&$(".name").val()&&$(".phone").val()){if(1==function(e){var n=1;if(e&&!/^1[3456789]\d{9}$/.test(e))return Object(a.g)("请填写正确的手机号码"),n=0,!1;return n}($(".phone").val()))if($(".mask").show(),1==l){var e=JSON.stringify({merchantId:s.merchant,sales_no:$('.informationList input[name="salse"]').val(),payee:d.payee,notes:$('.informationList input[name="notes"]').val(),sign_name:$('.informationList input[name="name"]').val(),sign_address:$("#city").val()+$('.informationList input[name="addressss"]').val(),sign_phone:$('.informationList input[name="phone"]').val(),goods:s.goods,machineId:s.machineId});g(JSON.stringify({data:o(e)}))}else 2==l&&($(".mask").show(),m())}else Object(a.g)("请把信息完善！");else Object(a.g)("请选择省市区！")}),$(".footer2 h1").click(function(){if(1==l){$(".mask").show();var e=JSON.stringify({merchantId:s.merchant,sales_no:$('.informationList input[name="salse2"]').val(),payee:d.payee,goods:s.goods,machineId:s.machineId});g(JSON.stringify({data:o(e)}))}else 2==l&&($(".mask").show(),m())}),$(".cancelFlag p").eq(0).click(function(){window.location.href="placeOrder.html"}),setTimeout(function(e){$(".determineCont h1").html("您已超过2分钟没有提交订单，请关闭页面重新扫码购买。"),$(".determineCont").show()},12e5);var u="",f=null;function m(){var e=JSON.stringify({merchantId:s.merchant,sales_no:1==s.goods[0].mail?$('.informationList input[name="salse"]').val():$('.informationList input[name="salse2"]').val(),payee:d.payee,notes:$('.informationList input[name="notes"]').val(),sign_name:$('.informationList input[name="name"]').val(),sign_address:$("#city").val()+$('.informationList input[name="addressss"]').val(),sign_phone:$('.informationList input[name="phone"]').val(),goods:s.goods,machineId:s.machineId,open_id:p}),n=JSON.stringify({data:o(e)});Object(a.d)("/api/pay/wxpay_js","post",n).then(function(e){u=e.message.slice(2,e.message.indexOf("创")),setTimeout(function(e){var n;n=u,f=setInterval(function(e){var t=JSON.stringify({data:o(n)});Object(a.d)("/api/pay/getPayStatus","post",t).then(function(e){2==e.data.payStatus&&(clearInterval(f),""===e.data.url||null===e.data.url?location.href="placeOrder.html":location.href=e.data.url)})},1500)},5e3),"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",h,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",h),document.attachEvent("onWeixinJSBridgeReady",h)):($(".mask").hide(),h(e.data))}).catch(function(e){$(".mask").hide(),Object(a.g)("微信下单失败")})}function h(e){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg||(Object(a.g)("已取消支付"),clearInterval(f))})}function g(e){$.ajax({type:"post",url:"/api/pay/alipay_js",timeout:1e4,data:e,headers:{"Content-Type":"application/json"},success:function(e){var n=Object(a.a)(e.data);if(-1!==e.message.indexOf("测试")){var t=n,i=document.createElement("div");i.id="alipay",i.innerHTML=t,document.body.appendChild(i),document.querySelector("#alipay").children[0].submit()}else{var o=n.indexOf("<qr_code>"),r=n.lastIndexOf("</qr_code>"),s=n.slice(o+9,r);location.href=s}},error:function(e){Object(a.g)(e),$(".mask").hide(),Object(a.g)("下单失败")}})}},693:function(e,n){}});