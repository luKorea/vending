/*! 版权所有，翻版必究 */!function(e){function t(t){for(var o,r,l=t[0],c=t[1],s=t[2],d=0,u=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&u.push(a[r][0]),a[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(p&&p(t);u.length;)u.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,l=1;l<n.length;l++){var c=n[l];0!==a[c]&&(o=!1)}o&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},a={35:0},i=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var p=c;i.push([270,0]),n()}({270:function(e,t,n){"use strict";n.r(t);n(665);layui.use(["table","form","layer","tree"],function(){var e=layui.table,t=layui.form,n=layui.layer,o=layui.tree,a=sessionStorage.machineID,i=e.render({elem:"#appList",url:"".concat(vApi,"/app/getAppVersionList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"version_code",width:180,title:"版本号",align:"center"},{field:"version_name",width:180,title:"版本名",align:"center"},{field:"apk_url",width:400,title:"下载地址",align:"center",templet:function(e){return'<a href="'.concat(e.apk_url,'" style="color: rgb(190, 149, 74)">').concat(e.apk_url,"</a>")}},{field:"content",width:350,title:"描述",align:"center"},{field:"upload_user",width:150,title:"创建人",align:"center"},{field:"upload_time",width:180,title:"创建时间",align:"center",templet:function(e){return e.upload_time?timeStamp(e.upload_time):"-"}},{field:"operation",fixed:"right",right:0,width:150,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(e){}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),$(".addAppBtn").click(function(){popupShow("addAppCOnt","addAppBox")}),$(".addAppCOnt .addCancelBtn").click(function(){popupHide("addAppCOnt","addAppBox")});var r=null;$('.relative input[name="uploadImg"]').change(function(e){var t=this,o=$(this).attr("indexFlag");if($(this).val()){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,i=this.files[0],l=2097152,c=Math.ceil(i.size/l),s=0,p=new SparkMD5.ArrayBuffer,d=function(a){if(p.append(a.target.result),++s<c)f();else{r=p.end(),console.log(100),console.log(s),console.log(c),$('input[name="AppMD"]').val(r),console.log(r);var i=new FormData;i.append("file",e.target.files[0]),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:token},data:i,success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?("add"==o?$('.addAppCOnt input[name="apk_url"]').val(e.data.src):(o="edit")&&$('.editAppCont input[name="apk_url"]').val(e.data.src),n.msg("上传成功",{icon:1}),$(".uploadTitle label").html("已上传")):(n.msg("上传失败",{icon:2}),$(t).val(""))},error:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("上传失败",{icon:2}),$(t).val("")}})}},u=function(){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("上传文件失败"),$(t).val("")};f()}function f(){var e=new FileReader;e.onload=d,e.onerror=u;var t=s*l,n=t+l>=i.size?i.size:t+l;e.readAsArrayBuffer(a.call(i,t,n))}}),$(".footerBtn .RdetermineBtn").click(function(){var e=t.val("addAppVal");if(console.log(1),e.version_code&&e.version_name&&e.apk_url)if(e.AppMD){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var o=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content});loadingAjax("/app/uploadApp","post",o,sessionStorage.token,"mask","addAppCOnt","addAppBox",n).then(function(e){console.log(e),n.msg(e.message,{icon:1}),i.reload({where:{}}),t.val("addAppVal",{version_code:"",version_name:"",apk_url:"",AppMD:"",content:""}),$(".uploadTitle label").html("未上传")}).catch(function(e){console.log(e),n.msg(e.message,{icon:2})})}else n.msg("请上传App文件",{icon:7});else n.msg("带*为必填",{icon:7})});var l=null,c=null;e.on("tool(appList)",function(e){if(event.stopPropagation(),console.log(e),l=e.data,"operation"===e.event){if(c==e.data.id)return $(".ListOperation").fadeOut(),void(c=null);c=e.data.id,$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}}),$(".ListOperation .edit").click(function(){t.val("editAppVal",{version_code:l.version_code,version_name:l.version_name,apk_url:l.apk_url,AppMD:l.verify,content:l.content}),popupShow("editAppCont","editAppBox")}),$(".ListOperation .updataMachine").click(function(){s||(s=treeList(),o.reload("treelist",{data:s})),p||(p=e.render({elem:"#machineList",url:"".concat(vApi,"/machine/getMachineList"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{checkbox:!0,align:"center",width:70},{field:"number",width:180,title:"售货机编号",align:"center",templet:function(e){return e.number?e.number:"-"}},{field:"info",width:180,title:"售货机名",align:"center",templet:function(e){return e.info?"<div>".concat(e.info,"</div>"):'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>'}},{field:"location",width:180,title:"地址",align:"center",templet:function(e){return e.location?e.location:" - "}},{field:"versions",width:200,align:"center",title:"当前版本(待升级版本)",templet:function(e){return"".concat(e.versions?e.versions:"-","(").concat(e.appVersion?e.appVersion:"-",")")}},{field:"merchantName",width:150,align:"center",title:"所属商户"}]],id:"mId",loading:!0,page:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:403!=e.code?{code:e.code,msg:e.message}:void(window.parent.location.href="login.html")},response:{statusCode:200},done:function(e){}})),popupShow("machineListCOnt","machineBox")}),$(".editAppCont .editCancelBtn").click(function(){popupHide("editAppCont","editAppBox")}),$(".editAppCont .rdetermineBtn").click(function(){var e=t.val("editAppVal");if(e.version_code&&e.version_name&&e.apk_url){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var o=JSON.stringify({version_code:e.version_code,version_name:e.version_name,apk_url:e.apk_url,verify:e.AppMD,content:e.content,id:l.id});loadingAjax("/app/updateAppInfo","post",o,sessionStorage.token,"mask","editAppCont","editAppBox",n).then(function(e){n.msg(e.message,{icon:1}),i.reload({where:{}})}).catch(function(e){n.msg(e.message,{icon:2})})}else n.msg("带*为必填",{icon:7})});var s=null;o.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:s,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),p.reload({where:{merchantId:e.data.id}}),a=e.data.id;for(var t=$("#test1 .layui-tree-txt"),n=0;n<t.length;n++)t[n].innerHTML===e.data.title?t[n].style.color="#be954a":t[n].style.color="#555"}});var p=null;$(".machineListCOnt .cancelBtn").click(function(){popupHide("machineListCOnt","machineBox")});var d=null,u=[];$(".machineListCOnt .pushBtn").click(function(){console.log(e.checkStatus("mId")),u=[],(d=e.checkStatus("mId")).data.length>0?n.confirm("确定编辑售货机App版本？",function(e){n.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");d.data.forEach(function(e,t){"".concat(e.machineId,","),u.push(e.machineId)});var t=JSON.stringify({version_code:l.version_code,machineId:u,merchantId:Number(a)});loadingAjax("/app/updateMachineApp","post",t,sessionStorage.token,"mask","machineListCOnt","machineBox",n).then(function(e){console.log(e),n.msg(e.message,{icon:1});var t="";u.forEach(function(e){t+=e+","});var o=JSON.stringify({machine:t});loadingAjax("/updateApp","post",o,sessionStorage.token,"","","",n).then(function(e){}).catch(function(e){})}).catch(function(e){n.msg(e.message,{icon:2})})}):n.msg("请选择需要修改app版本的售货机",{icon:7})}),$("body").click(function(){$(".ListOperation").fadeOut(),c=null})})},665:function(e,t){}});