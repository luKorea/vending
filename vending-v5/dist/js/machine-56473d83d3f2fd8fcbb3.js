/*! 版权所有，翻版必究 */!function(e){function n(n){for(var a,s,c=n[0],l=n[1],d=n[2],m=0,u=[];m<c.length;m++)s=c[m],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&u.push(i[s][0]),i[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(r&&r(n);u.length;)u.shift()();return o.push.apply(o,d||[]),t()}function t(){for(var e,n=0;n<o.length;n++){for(var t=o[n],a=!0,c=1;c<t.length;c++){var l=t[c];0!==i[l]&&(a=!1)}a&&(o.splice(n--,1),e=s(s.s=t[0]))}return e}var a={},i={17:0},o=[];function s(n){if(a[n])return a[n].exports;var t=a[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=e,s.c=a,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,n){if(1&n&&(e=s(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)s.d(t,a,function(n){return e[n]}.bind(null,a));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="";var c=window.webpackJsonp=window.webpackJsonp||[],l=c.push.bind(c);c.push=n,c=c.slice();for(var d=0;d<c.length;d++)n(c[d]);var r=l;o.push([590,0]),t()}({590:function(e,n,t){"use strict";t.r(n);t(598);var a=null,i=null;function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}layui.use(["form"],function(){for(var e,n,t,o=layui.form,s=$(".province"),c=0;c<provinceList.length;c++)l(s,provinceList[c].name);function l(e,n){var t;t="<option value="+n+" >"+n+"</option>",e.append(t)}function d(e){e.find("option").remove();e.append("<option value=''>请选择</option>")}o.render("select"),o.on("select(province)",function(e){a(e.value)}),a=function(n){var a=$(".city"),i=$(".district");e=n,$.each(provinceList,function(n,a){if(e==a.name)return t=n}),d(a),d(i),$.each(provinceList[t].cityList,function(e,n){l(a,n.name)}),o.render("select")},o.on("select(city)",function(e){i(e.value)}),i=function(a){var i=$(".district");n=a,d(i),$.each(provinceList,function(n,a){if(e==a.name)return t=n}),$.each(provinceList[t].cityList,function(e,t){if(n==t.name)for(var a=0;a<t.areaList.length;a++)l(i,t.areaList[a])}),o.render("select")}}),layui.use(["table","form","layer","laydate","tree"],function(){var e=window.parent.permissionsData1(),n=permissionsVal1({396:!1,392:!1,424:!1,432:!1,426:!1,425:!1,427:!1,401:!1,402:!1,456:!1,467:!1,466:!1,468:!1,469:!1,470:!1,472:!1,471:!1,473:!1,474:!1,475:!1},e);function s(){n[392]?$(".activeMachineType").removeClass("hides"):$(".activeMachineType").addClass("hides"),n[432]?$(".payTypeSet").removeClass("hide"):$(".payTypeSet").addClass("hide"),n[432]?$(".sequence").removeClass("hide"):$(".sequence").addClass("hide"),n[427]?$("aisleDetailsTab").removeClass("hide"):$("aisleDetailsTab").addClass("hide"),n[401]?$(".salesDetails").removeClass("hide"):$(".salesDetails").addClass("hide"),n[402]?$(".shipmentDetails").removeClass("hide"):$(".shipmentDetails").addClass("hide"),n[456]?$(".shmentSet").removeClass("hide"):$(".shmentSet").addClass("hide"),n[467]?$(".selesPushBtn").removeClass("hide"):$(".selesPushBtn").addClass("hide"),n[466]?$(".shipmentPushBtn").removeClass("hide"):$(".shipmentPushBtn").addClass("hide"),n[468]?$(".replenishmentPushBtn").removeClass("hide"):$(".replenishmentPushBtn").addClass("hide"),n[469]?$(".editPircePushBtn").removeClass("hide"):$(".editPircePushBtn").addClass("hide"),n[470]?$(".openDoorPushBtn").removeClass("hide"):$(".openDoorPushBtn").addClass("hide"),n[472]?$(".invoicePushBtn1").removeClass("hide"):$(".invoicePushBtn1").addClass("hide"),n[471]?$(".panelFlagClass").removeClass("hide"):$(".panelFlagClass").addClass("hide"),n[473]?$(".undoRecord").removeClass("hide"):$(".undoRecord").addClass("hide"),n[474]?$(".undoPushBtn").removeClass("hide"):$(".undoPushBtn").addClass("hide"),n[475]?$(".pushMachineBtn").removeClass("hide"):$(".pushMachineBtn").addClass("hide")}s();var c=1,l=null;$(".sidebar i").click(function(){$(".left-mian").hide(),$(".on-left").show()}),$(".on-left").click(function(){$(".left-mian").show(),$(".on-left").hide()});var d=merchantsListMian(""),r=layui.table,m=sessionStorage.token,u=layui.layer,p=layui.form,h=layui.tree,g=layui.laydate,f=r.render({elem:"#machineTable",url:"".concat(vApi,"/machine/getMachineList"),method:"post",contentType:"application/json",headers:{token:m},height:600,cols:[[{fixed:"left",field:"info",width:330,title:"售货机名",align:"center",templet:function(e){return e.info?e.info:'<div><span style="color:red;">*</span>(售货机为新上线机器，请编辑售货机信息！)</div>\n                            <div><span style="color:red;">*</span>(序列号:'.concat(e.machineId,")</div>")}},{field:"number",width:150,title:"售货机编号",align:"center",templet:function(e){return e.number?e.number:"-"}},{field:"info",width:150,title:"售货机类别",align:"center",templet:function(e){return e.machinesource?1==e.machinesource?"ZJ":"YY":"-"}},{field:"machineURL",width:220,title:"支付成功跳转地址",align:"center",templet:function(e){return!e.machineURL||null===e.machineURL&&void 0===e.machineURL?"-":'<a href="'.concat(e.machineURL,'" target="_blank" style="color: rgb(190, 149, 74)">').concat(e.machineURL,"</a>")}},{field:"location",width:350,title:"地址",align:"center",templet:function(e){return e.location?e.location:" - "}},{field:"trafficInfo",width:160,title:"流量使用情况(MB)",align:"center"},{field:"iot_card",width:160,title:"物联网卡号",align:"center"},{field:"warning",width:130,title:"缺货情况",align:"center",templet:function(e){return e.storage_warning[0].warning?' <div>\n                            <span class="'.concat(e.storage_warning[0].way_count<10?"tableStateCellTrue":e.storage_warning[0].way_count<30?"tableStateCellFalse":"red",'">').concat(e.storage_warning[0].warning,"</span>\n                        </div>"):"-"}},{field:"way_count",width:130,title:"缺货货道数量",align:"center",templet:function(e){return e.storage_warning[0].way_count}},{field:"onlineStatus",width:130,title:"在线状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.onlineStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.onlineStatus?"离线":"在线","</span></div>")}},{field:"offline_time",width:180,title:"离线时长",align:"center"},{field:"offline_time",width:180,title:"上次离线时间",align:"center",templet:function(e){return e.time?e.time:"-"}},{field:"actionStatus",width:130,title:"是否激活",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.actionStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.actionStatus?"未激活":"已激活","</span></div>")}},{field:"openStatus",width:130,title:"营业状态",align:"center",templet:function(e){return'<div><span class="'.concat(0!=e.openStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(0==e.openStatus?"暂停营业":"营业","</span></div>")}},{field:"merchantName",width:150,title:"所属商户",align:"center"},{field:"versions",width:200,title:"当前版本(待升级版本)",align:"center",templet:function(e){return"".concat(e.versions?e.versions:"-","(").concat(e.appVersion?e.appVersion:"-",")")}},{field:"connectTime",width:170,title:"联机时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.connectTime):"-"}},{field:"actionTime",width:170,title:"激活时间",align:"center",templet:function(e){return e.actionTime?timeStamp(e.actionTime):"-"}},{field:"description",width:150,title:"描述",align:"center"},{field:"operation",fixed:"right",right:0,width:150,title:"操作",toolbar:"#barDemo",align:"center"}]],id:"tableId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:sessionStorage.machineID},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){s(),403==+e.code?window.parent.location.href="login.html":405==+e.code&&$(".hangContent").show(),fixedFun()}});$(".machineListKeyBtn").click(function(){var e=p.val("machineData");f.reload({where:{onlineStatus:e.onlineStatus?Number(e.onlineStatus):"",actionStatus:e.actionStatus?Number(e.actionStatus):"",openStatus:e.permissions?Number(e.permissions):"",stockStatus:e.CreationTime?Number(e.CreationTime):"",keyword:e.machineKeyText}})}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(D)?(D=e,treeFun(h,"test1",f,D,"merchantId","condition",O,"","true"),f.reload({where:{merchantId:sessionStorage.machineID}}),u.msg("已刷新",{icon:1})):u.msg("已刷新",{icon:1})}),$(".setNav li").click(function(){$(this).addClass("active").siblings().removeClass("active");var e=$(this);switch($(".tabLine").animate({left:0!=e.index()?e.offset().left+"px":e.offset().left-20+"px",width:e.width()+"px"},500),$(".navSetCont li").eq($(this).index()).fadeIn().siblings().hide(),e.index()){case 1:te(v.machineId,v.userNum);break;case 2:G(v.machineId),E(),l=1;break;case 3:$e=r.render({elem:"#panelTable",url:"".concat(vApi,"/machine/getDisplayGood"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"goods_images",title:"图片",align:"center",templet:"#panelImg"},{field:"good_name_core",title:"商品名(编号)",align:"center"},{field:"goodCount",title:"数量",align:"center"},{field:"oldGoodCount",title:"原数量",align:"center"},{field:"last_user",title:"修改人",align:"center"},{field:"last_time",title:"修改时间",align:"center",templet:function(e){return e.last_time?timeStamp(e.last_time):"-"}},{field:"operation",title:"操作",toolbar:"#panelId",align:"center"}]],id:"panelID",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.length,data:e.data}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){s(),403==e.code&&(window.parent.location.href="login.html")}}),E(),l=2;break;case 4:!function(e){T=r.render({elem:"#salesDateilsTable",url:"".concat(vApi,"/machine/getSalesList"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"time",title:"时间",align:"center",templet:function(e){return timeStamp(e.time)}},{field:"number",title:"订单号",align:"center"},{field:"payResult",align:"center",title:"支付状态",templet:function(e){return'<div><span class="'.concat(2==e.payStatus?"tableStateCellTrue":"tableStateCellFalse",'">').concat(e.payResult,"</span></div>")}},{field:"payTypes",align:"center",title:"支付类型"},{field:"payee",align:"center",title:"收款方"},{field:"amount",align:"center",title:"金额",templet:function(e){return percentileMoney(e.amount)}}]],id:"salesId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:e,conditionTwo:b||null,conditionThree:x||null},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}(v.machineId);break;case 5:v.machineId,B=r.render({elem:"#shipmentListTable",url:"".concat(vApi,"/machine/getShippingList"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"time",title:"出货时间",align:"center",templet:function(e){return e.create_time?timeStamp(e.create_time):"-"}},{field:"good_name_core",title:"商品名(编号)",align:"center",templet:function(e){return e.good_name_core?e.good_name_core:"-"}},{field:"ship_status",title:"出货状态",align:"center",templet:function(e){return setOrderDetailStatus(e.ship_status)}},{field:"before_count",align:"center",title:"出货前数量"},{field:"before_count",align:"center",title:"出货后数量",templet:function(e){return e.before_count?1==e.ship_status?e.before_count-1:e.before_count:"-"}},{field:"ship_type",align:"center",title:"出货类型",templet:function(e){return 1==e.ship_type?"订单":"取货码"}},{field:"way",align:"center",title:"出货货道"},{field:"order_code",align:"center",title:"订单号/取货码"}]],id:"shipmentId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId,start_time:_,end_time:P,way:$('.shipmentRecord select[name="shipSelect"]').val()},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 6:v.machineId,se=r.render({elem:"#replenishmentTable",url:"".concat(vApi,"/machine/getReplenish"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"username",title:"补货人",align:"center"},{field:"name",title:"补货人姓名",align:"center"},{field:"replenish_time",title:"补货时间",align:"center",templet:function(e){return e.replenish_time?timeStamp(e.replenish_time):"-"}},{field:"way",title:"补货货道",align:"center"},{field:"good_name_core",title:"商品名(编号)",align:"center"},{field:"replenish_count",title:"补货前数量",align:"center",templet:function(e){return e.after_count-e.replenish_count}},{field:"replenish_count",title:"补货数量",align:"center"},{field:"after_count",title:"补货后数量",align:"center"}]],id:"shipmentId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId,start_time:ce||null,end_time:le||null,way:$('.replenishment select[name="shipSelect"]').val()},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 7:me=r.render({elem:"#priceEdit",url:"".concat(vApi,"/machine/getPriceRecord"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"old_price",title:"修改前价格",align:"center",templet:function(e){return percentileMoney(e.old_price)}},{field:"new_price",title:"修改后价格",align:"center",templet:function(e){return percentileMoney(e.new_price)}},{field:"goods_Name",title:"商品名(编号)",align:"center"},{field:"user_name",title:"修改人",align:"center"},{field:"name",title:"修改人姓名",align:"center"},{field:"way",title:"修改时间",align:"center",templet:function(e){return e.change_time?timeStamp(e.change_time):"-"}}]],id:"priceId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId,startDate:de,endDate:re},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 8:ue=r.render({elem:"#openTheDoor",url:"".concat(vApi,"/machine/getDoorRecord"),method:"post",contentType:"application/json",headers:{token:m},cols:[[{field:"info",title:"售货机名",align:"center"},{field:"openType",title:"类型",align:"center"},{field:"username",title:"操作人",align:"center"},{field:"name",title:"操作人姓名",align:"center"},{field:"goods_Name",title:"开门时间",align:"center",templet:function(e){return e.open_time?timeStamp(e.open_time):"-"}}]],id:"openTheDoorId",page:!0,loading:!0,limits:[10,20,50,100],request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId,start_time:ce||null,end_time:le||null},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}});break;case 9:r.render({elem:"#undoTable",url:"".concat(vApi,"/machine/findRemove"),method:"get",headers:{token:m},cols:[[{field:"goodName",title:"商品名",align:"center"},{field:"way",title:"货道",align:"center"},{field:"count",title:"数量",align:"center"},{field:"price",title:"价格",align:"center",templet:function(e){return percentileMoney(e.price)}},{field:"userName",title:"撤货人",align:"center"},{field:"name",title:"撤货人姓名",align:"center"},{field:"removeDate",title:"撤货时间",align:"center"}]],id:"undoId",page:!0,loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{machineId:v.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){s(),403==e.code&&(window.parent.location.href="login.html")}})}});var v=null,y=null;function I(){$(".relationRules").hide()}r.on("tool(machineTable)",function(e){if(event.stopPropagation(),v=e.data,$(".maskHeader span").html(v.info?v.info+"详细信息":"-详细信息"),"operation"===e.event){if(y==e.data.machineId)return $(".ListOperation").fadeOut(),void(y=null);y=e.data.machineId,0!=e.data.actionStatus?$(".Mactivation").addClass("hide"):$(".Mactivation").removeClass("hide"),0!=e.data.openStatus?$(".ListOperation .Mbusiness").html("暂停营业"):$(".ListOperation .Mbusiness").html("营业"),$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}}),$(".ListOperation .set").click(function(){loadingAjax("/machine/findWay","get",{machineId:v.machineId},sessionStorage.token).then(function(e){var n='<option value="">全部</option>';e.data.forEach(function(e){n+='<option value="'.concat(e,'">').concat(e,"</option>")}),$('.shipmentRecord select[name="shipSelect"]').html(n),$('.replenishment select[name="shipSelect"]').html(n),p.render("select")}).catch(function(e){}),$(".setUpCont").show(),$("body").addClass("bodys");var e=null;v.location&&(e=v.location.split(" ")),p.val("setDataVal",{info:v.info,appVersion:v.versions,longitude:v.longitude,latitude:v.latitude,location:v.location,setProvince:e?e[1]:"",setCity:e?e[2]:"",setArea:e?e[3]:"",setRegion:v.area}),$(".navSetCont li").eq(0).show().siblings().hide(),$(".setNav li").eq(0).addClass("active").siblings().removeClass("active"),$(".tabLine").animate({left:$(".setNav li").eq(0).offset().left-20+"px",width:$(".setNav li").eq(0).width()+"px"},1)}),$(".ListOperation .edit").click(function(){console.log(v),$("body").addClass("bodys"),1==v.openStatus?u.msg("温馨提示！该售货机正在营业，不可进行编辑！",{icon:7}):n[396]||u.msg("温馨提示！您没有编辑售货机的权限！",{icon:7});var e=null;v.location&&(e=v.location.split(" ")),$(".editMachineBox .layui-tree-txt").css({color:"#555"}),1==v.machinesource?$(".maxShipClass").show():$(".maxShipClass").hide(),p.val("editmachine",{machineURL:v.machineURL,urlStatus:v.urlStatus,sNumber:v.number,tName:v.info,number:v.machineId,province:v.location?e[0]:"",mapVal:v.location?e[3]:"",area:v.area,longitude:v.longitude,latitude:v.latitude,headPhone:v.chargerPhone,describe:v.description,merchantsName:v.userNum,merchantsNametext:v.merchantName,max_ship:0==v.max_ship?"":v.max_ship}),v.location&&(a(e[0]),console.log(e[0]),$(".city").val(e[1]),i(e[1]),$(".district").val(e[2]),p.render("select")),$(".editMachineCont").show(),$(".editMachineCont").scrollTop(0),v.service_code?($(".ImgCont img").prop("src",v.service_code),$(".ImgCont").show()):($(".ImgCont img").prop("src",""),$(".ImgCont").hide()),1==v.is_service?($(".serviceTitle").show(),$('.listFlex input[name="machineOpen"]').prop("checked",!0),ae=!0):($(".serviceTitle").hide(),$('.listFlex input[name="machineOpen"]').prop("checked",!1),ae=!1),$('.serviceTitle input[name="service_phone"]').val(v.service_phone),v.custom_code?($(".customImgCont img").prop("src",v.custom_code),$(".customImgCont").show()):($(".customImgCont img").prop("src",""),$(".customImgCont").hide()),1==v.is_custom?($(".customTitle").show(),$('.listFlex input[name="customOpen"]').prop("checked",!0),ie=!0):($(".customTitle").hide(),$('.listFlex input[name="customOpen"]').prop("checked",!1),ie=!1),1==v.is_volume?$('.listFlex input[name="sound"]').prop("checked",!0):$('.listFlex input[name="sound"]').prop("checked",!1),1==v.is_light?$('.listFlex input[name="lamp"]').prop("checked",!0):$('.listFlex input[name="lamp"]').prop("checked",!1),c=1,function(e,n){var t=JSON.stringify({merchantId:e.userNum,pageSize:10,pageNum:n});1==n&&(oe=[]);loadingAjax("/sales_manager/getSalesType","post",t,sessionStorage.token,"mask","","",u).then(function(n){!function(e,n){console.log(c);var t="";1==c&&($(".salseCont").html(""),t='<input type="radio" '.concat(0==n.is_sales?"checked":"",' name="salseClassName" value="-99" title="不启用" >\n            <input type="radio" name="salseClassName" ').concat(1==n.is_sales?n.sales_type?"":"checked":"",' value="" title="默认" >'),c++);e.forEach(function(e){t+='<input type="radio" name="salseClassName" '.concat(1==n.is_sales&&v.sales_type==e.sm_classify?"checked":"",' value="').concat(e.sm_classify,'" title="').concat(e.sm_classify,'">')}),$(".salseCont").append(t),p.render()}(oe=oe.concat(n.data.list),e)}).catch(function(e){console.log(e),u.msg(e.message,{icon:2})})}(v,1),$('.customTitle input[name="custom_phone"]').val(v.custom_phone),p.render(),S()}),$(".ListOperation .Mactivation").click(function(){u.confirm("确定激活该设备？",function(e){u.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var n=JSON.stringify({machineId:v.machineId,actionStatus:"1"});loadingAjax("/machine/activeMachine","post",n,m,"mask","","",u).then(function(e){u.msg("激活成功",{icon:1}),f.reload({where:{}})}).catch(function(e){u.msg(res.message,{icon:2})})})}),$(".ListOperation .Mbusiness").click(function(){u.confirm(1!=v.openStatus?"确定营业？":"确定暂停营业？",function(e){var n=1!=v.openStatus?"1":"0";u.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/getStatus","post",JSON.stringify({machineId:v.machineId}),m).then(function(e){console.log(e,"lallalala"),1==e.data.actionStatus?loadingAjax("/pushActive","post",JSON.stringify({machine:v.machineId,action:1!=v.openStatus?"true":"false"}),m).then(function(e){}).catch(function(e){loadingAjax("/machine/activeMachine","post",JSON.stringify({machineId:v.machineId,openStatus:n}),m,"mask").then(function(e){u.msg("操作成功",{icon:1}),f.reload({where:{}})}).catch(function(e){u.msg(e.message,{icon:2})})}):($(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),u.msg("操作失败",{icon:2}))}).catch(function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),u.msg(e.message,{icon:2})})})}),$(".relation").click(function(){console.log(v),v.payType.indexOf("4")>-1?($(".relationRules").show(),function(e){return new Promise(function(n,t){loadingAjax("/classify/findAll","post",JSON.stringify({pageNum:1,pageSize:200,merchantId:e}),sessionStorage.token).then(function(e){var t="";$.each(e.data.list,function(e,n){console.log(o(n.classifyId),n.classifyId),t+='<option value="'.concat(n.classifyId,'">').concat(n.classifyName,"</option>")}),$("#rules").html(t),p.render("select"),n()}).catch(function(e){t(e)})})}(sessionStorage.machineID).then(function(e){p.val("relationRules",{state:0,rulesId:210}),p.render()})):u.msg("您的支付方式不是杉德支付，不能关联分则规则",{icon:7})}),$(".relationBtn").click(function(){var e=p.val("relationRules");console.log(e),I()}),$(".relationRules .cancelBtn").click(function(){I()}),$(".setUpCont .close").click(function(){$(".setUpCont").hide(),$("body").removeClass("bodys")}),$(".editMachineCont .close").click(function(){$("body").removeClass("bodys"),$(".editMachineCont").hide()}),$(".editMachineCont .editCancelBtn").click(function(){$("body").removeClass("bodys"),$(".editMachineCont").hide()});var N=new AMap.Map("machineMap",{resizeEnable:!0}),k=new AMap.Geocoder({city:"",radius:1e3}),C=new AMap.Marker;function S(){var e=$('.listFlex select[name="province"]').val()+$('.listFlex select[name="city"]').val()+$('.listFlex select[name="district"]').val()+$('.listFlex input[name="mapVal"]').val();k.getLocation(e,function(e,n){if("complete"===e&&n.geocodes.length){var t=n.geocodes[0].location;$('.listFlex input[name="longitude"]').val(t.lng),$('.listFlex input[name="latitude"]').val(t.lat),C.setPosition(t),N.add(C),N.setFitView(C)}else u.msg("根据地址查询位置失败",{icon:2})})}function w(){var e=[$('.listFlex input[name="longitude"]').val(),$('.listFlex input[name="latitude"]').val()];N.add(C),C.setPosition(e),N.setFitView(C),k.getAddress(e,function(e,n){if("complete"===e&&n.regeocode){var t=n.regeocode;$('.listFlex input[name="mapVal"]').val(t.addressComponent.street+t.addressComponent.streetNumber),$('.listFlex select[name="province"]').val(t.addressComponent.province),a(t.addressComponent.province),"北京市"==t.addressComponent.province||"天津"==t.addressComponent.province||"上海市"==t.addressComponent.province||"重庆市"==t.addressComponent.province?($('.listFlex select[name="city"]').val("市辖区"),i("市辖区")):($('.listFlex select[name="city"]').val(t.addressComponent.city),i(t.addressComponent.city)),$('.listFlex select[name="district"]').val(t.addressComponent.district),p.render("select")}else u.msg("根据地址查询位置失败",{icon:2})})}N.on("click",function(e){$('.listFlex input[name="longitude"]').val(e.lnglat.lng),$('.listFlex input[name="latitude"]').val(e.lnglat.lat),w()}),$('.listFlex input[name="mapVal"]').blur(function(){S()}),$('.listFlex input[name="longitude"]').blur(function(){w()}),$('.listFlex input[name="latitude"]').blur(function(){w()}),$('.listFlex input[name="userPhone"]').blur(function(){phoneRegular(this,u)}),$('.listFlex input[name="headPhone"]').blur(function(){phoneRegular(this,u)}),$(".editMachineCont .edittBtn").click(function(){if(1!=v.openStatus){var e=p.val("editmachine");if(e.sNumber&&e.tName&&e.number&&e.province&&e.city&&e.district&&e.mapVal&&e.area&&e.merchantsName){if(!$('.serviceTitle input[name="service_phone"]').val()&&!$(".ImgCont img").attr("src")&&ae)return void u.msg("请填写客服电话或上传客服微信二维码",{icon:7});if(!$('.customTitle input[name="custom_phone"]').val()&&!$(".customImgCont img").attr("src")&&ie)return void u.msg("请填写定制电话或上传定制二维码",{icon:7});if($('.listFlex input[name="max_ship"]').val()&&!($('.listFlex input[name="max_ship"]').val()>0&&Number.isInteger(Number($('.listFlex input[name="max_ship"]').val()))))return void u.msg("最大出货数必须是正整数",{icon:7});$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var n=JSON.stringify({number:e.sNumber,machineURL:e.machineURL,urlStatus:e.urlStatus,info:e.tName,machineId:e.number,location:e.province+" "+e.city+" "+e.district+" "+e.mapVal,area:e.area,longitude:e.longitude,latitude:e.latitude,userNum:v.userNum==Number(e.merchantsName)?0:Number(e.merchantsName),chargerPhone:e.headPhone,description:e.describe,is_service:ae?1:0,service_phone:ae?$('.serviceTitle input[name="service_phone"]').val():"",service_code:ae?$(".ImgCont img").attr("src"):"",is_custom:ie?1:0,custom_phone:ie?$('.customTitle input[name="custom_phone"]').val():"",custom_code:ie?$(".customImgCont img").attr("src"):"",is_sales:-99==$('.salseCont input[name="salseClassName"]:checked').val()?0:1,sales_type:-99==$('.salseCont input[name="salseClassName"]:checked').val()?"":$('.salseCont input[name="salseClassName"]:checked').val(),is_volume:$('.listFlex input[name="sound"]').prop("checked")?1:0,is_light:$('.listFlex input[name="lamp"]').prop("checked")?1:0,max_ship:1==v.machinesource?$('.listFlex input[name="max_ship"]').val()?Number($('.listFlex input[name="max_ship"]').val()):null:1});loadingAjax("/machine/updateMachine","post",n,sessionStorage.token,"mask").then(function(e){$(".editMachineCont").hide(),u.msg("编辑成功",{icon:1}),f.reload({where:{}})}).catch(function(e){u.msg(e.message,{icon:2})})}else u.msg("带*为必填",{icon:7})}else u.msg("正在营业的售货机不可进行编辑！",{icon:7})}),$(".fixedAccount").click(function(){$(".fixedAccount").removeClass("active"),$(this).addClass("active"),f.reload({where:{merchantId:$(this).attr("mid")}})});var b=getKeyTime().startTime,x=getKeyTime().endTime;g.render({elem:"#test6",range:!0,value:getKeyTime().keyTimeData,done:function(e,n,t){var a=e.split(" - ");b=a[0],x=a[1]}});var _=getKeyTime().startTime,P=getKeyTime().endTime;g.render({elem:"#test7",range:!0,value:getKeyTime().keyTimeData,done:function(e,n,t){console.log(e);var a=e.split(" - ");console.log(a),_=a[0],P=a[1]}});var T=null;$(".selesPushBtn").click(function(){if(timeFlag(b,x))u.msg("时间选择范围最多三个月",{icon:7});else{var e="".concat(v.info,"(").concat(v.number,")销售详情(").concat(b,"-").concat(x,").xls"),n="".concat(vApi,"/exportMachineOrder?startDate=").concat(b,"&endDate=").concat(x,"&condition=").concat(v.machineId);exportExcel(n,e)}}),$(".selesQueryBtn").click(function(){if(timeFlag(b,x))u.msg("时间选择范围最多三个月",{icon:7});else{var e=p.val("salesDataVal");console.log(e),T.reload({where:{conditionFive:e.shipmentStatus,conditionSix:e.payStatus,conditionSeven:e.payType,conditionTwo:b||null,conditionThree:x||null}})}});var B=null;$(".shipmentPushBtn").click(function(){if(timeFlag(_,P))u.msg("时间选择范围最多三个月",{icon:7});else{var e="".concat(v.info,"(").concat(v.number,")出货记录(").concat(_,"-").concat(P,").xls"),n="".concat(vApi,"/excelShipping?startDate=").concat(_,"&endDate=").concat(P,"&machineId=").concat(v.machineId,"&way=").concat($('.shipmentRecord select[name="shipSelect"]').val(),"&goods_Name=").concat($('.shipmentRecord input[name="shipGoodName"]').val(),"&order_code=").concat($('.shipmentRecord input[name="order_code"]').val());exportExcel(n,e)}}),$(".shipmentQueryBtn").click(function(){timeFlag(_,P)?u.msg("时间选择范围最多三个月",{icon:7}):B.reload({where:{way:$('.shipmentRecord select[name="shipSelect"]').val(),goods_Name:$('.shipmentRecord input[name="shipGoodName"]').val(),order_code:$('.shipmentRecord input[name="order_code"]').val(),start_time:_,end_time:P}})});var A=null,D=A=treeList();0==d.length&&(A=[]),treeFun(h,"test1",f,D,"merchantId","condition",O,"","true");h.render({elem:"#test2",id:"treelistEdit",showLine:!0,onlyIconControl:!0,isJump:!1,edit:!1,data:A,text:{defaultNodeName:"无数据",none:"您没有修改机器所属商户的权限。"},click:function(e){console.log(e),p.val("editmachine",{merchantsName:e.data.id,merchantsNametext:e.data.title});for(var n=$(".editMachineBox .layui-tree-txt"),t=0;t<n.length;t++)n[t].innerHTML===e.data.title?n[t].style.color="#be954a":n[t].style.color="#555"}});function O(e){loadingAjax("/classify/findAll","post",JSON.stringify({pageNum:1,pageSize:200,merchantId:e}),sessionStorage.token).then(function(e){var n='<option value="">全部</option>';$.each(e.data.list,function(e,t){n+='<option value="'.concat(t.classifyId,'">').concat(t.classifyName,"</option>")}),$("#GoodsType").html(n),p.render("select")}).catch(function(e){})}$(".editRefres").click(function(){var e=treeList();JSON.stringify(e)==JSON.stringify(A)?u.msg("已刷新",{icon:1}):(A=e,h.reload("demoId",{data:A}),u.msg("已刷新",{icon:1}))}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),O(sessionStorage.machineID),sessionStorage.machineGoodsId=sessionStorage.machineID,sessionStorage.machineName=sessionStorage.marchantName;var F=null;function M(){F=r.render({elem:"#goodsTable",url:"".concat(vApi,"/goods/findAll"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"goods_images",title:"图片",align:"center",templet:"#imgtmp"},{field:"goods_Name",align:"center",title:"商品名",templet:function(e){return 1==e.mail?"(邮寄)"+e.goods_Name:e.goods_Name}},{field:"classifyName",align:"center",title:"商品类目"},{field:"mail",title:"是否邮寄商品",align:"center",templet:function(e){return 0==e.mail?"否":"是"}},{field:"goods_Core",align:"center",title:"商品编号"},{field:"operation",title:"操作",align:"center",toolbar:"#GoodsbarDemo"}]],id:"goodsID",page:!0,loading:!0,height:"480",request:{pageName:"pageNum",limitName:"pageSize"},where:{condition:sessionStorage.machineGoodsId,conditionFour:"1",machineId:v.machineId},parseData:function(e){return 200==e.code?{code:e.code,msg:"",count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){403==e.code&&(window.parent.location.href="login.html")}})}var L=[];function G(e){L=[];var n=JSON.stringify({machineId:e});loadingAjax("/machine/getGoodWay","post",n,sessionStorage.token,"","","",u).then(function(e){j(e),console.log(e)}).catch(function(e){console.log(e),L=[],[];$(".aisleGoodsCont").html('<div style="text-align: center;">您没有权限访问货道详情！</div>')})}function j(e){L=[],e.data,e.data.forEach(function(e){e.row&&(L[e.row-1]?L[e.row-1].push(e):(L[e.row-1]=[],L[e.row-1].push(e)))}),function(e){var n="";e.forEach(function(e,a){n+='<div class="aisleListCont flexTwo">\n                            <div class="listIndex">\n                                <span>'.concat(a+1,"</span>\n                            </div>"),e.forEach(function(e,i){var o=1===Number(e.status);console.log(o),0!=e.open?n+='<div class="aisleNumderGoods">\n                                    '.concat(o?"":'<i class="layui-icon layui-icon-util icon" title="货道故障"></i>','\n                                    <div class="aisleNumderClick" fireIndex="').concat(a+","+i,'">\n                                    <div class="numderTop">                                   \n                                        <img class="').concat(e.goods_images?"wayImg":"",'" src="').concat(e.goods_images?e.goods_images:t(102),'" alt=""> \n                                    <span>').concat(e.way,'</span>\n                                    </div>\n                                    <div class="price">价格:').concat(percentileMoney(e.price),'</div>\n                                <div class="numderBottom">\n                                        <div class="status1 ').concat(o?"":"redF10",'">').concat(o?"正常":"货道故障",'</div>\n                                        <div title="').concat(e.count,'">数量:').concat(e.count,'</div>\n                                    </div>\n                                    </div>\n                                    <div class="chooseCheck">\n                                        <span >').concat(e.mail?"(邮寄)":""," ").concat(e.goods_Name?e.goods_Name:"-","</span>\n                                    </div>\n                                </div>"):n+='<div class="aisleNumderGoods" >\n                                    '.concat(o?"":'<i class="layui-icon layui-icon-util icon" title="货道故障"></i>','\n                                    <div class="aisleNumderClick" fireIndex="').concat(a+","+i,'">\n                                    <div class="numderTop">\n                                    <img class="').concat(e.goods_images?"wayImg":"",'" src="').concat(e.goods_images?e.goods_images:t(102),'" alt="">\n                                        <span>').concat(e.way,'</span>\n                                    </div>\n                                    <div class="numderBottom">\n                                        <div class="status2">').concat(o?"禁用":"货道故障",'</div>\n                                        <div title="').concat(e.count,'">数量:').concat(e.count,'</div>\n                                    </div>\n                                    </div>  \n                                    <div class="chooseCheck" >\n                                        <span >').concat(1===Number(e.mail)?"(邮寄)":"").concat(e.goods_Name?e.goods_Name:"","</span>\n                                    </div>\n                                </div>")}),n+=" </div>"}),$(".aisleGoodsCont").html(n),p.render("checkbox")}(L)}$(".relative").click(function(){1==H?(U&&popupShow("goodsCont","goodsBox"),F?F.reload({where:{condition:sessionStorage.machineGoodsId}}):M()):u.msg("您不是该设备管理员!",{icon:7})}),$(".goodsCont .queryBtnClick").click(function(){F.reload({where:{conditionTwo:$('.goodsCont input[name="GoodsKyeText"]').val(),conditionThree:$("#GoodsType").val()}})}),$(".aisleGoodsCont").on("mouseenter",".chooseCheck",function(){$(".tipContent").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"}).fadeIn(),$(".tipContent .tipHtml").html($(this).children("span").html())}),$(".aisleGoodsCont").on("mouseleave",".chooseCheck",function(){$(".tipContent").fadeOut()});var R=null;sessionStorage.independentPass="";var J=null;$("body").on("click",".aisleNumderClick",function(){J=$(this).attr("fireIndex").split(","),console.log(J),n[424]?(R=1,U=!1,V=L[J[0]][J[1]],console.log(V),$('.editAisle input[name="goodsName"]').val(V.goods_Name?1==V.mail?"(邮寄)"+V.goods_Name:V.goods_Name:""),$('.editAisle input[name="goodsName"]').attr("IVal",V.goods_Id?V.goods_Id:""),$('.editAisle input[name="price"]').val(V.price?V.price:""),$('.editAisle input[name="count"]').val(V.count),$('.editAisle input[name="total"]').val(V.total),p.val("testVal",{testSele:V.open}),q={machineId:v.machineId,way:V.way,goodId:Number(V.goods_Id),newGoodId:Number(V.goods_Id),count:Number(V.count),total:Number(V.total),open:Number(V.open),replenish:V.count},K(),popupShow("editAisle","editAisleBox")):u.msg("您没有编辑货道的权限!",{icon:7})}),$(".passBtn").click(function(){var e=JSON.stringify({alonePwd:hex_md5($('.iPasswprd input[name="iPassword"]').val())});loadingAjax("/user/verifyAlonePwd","post",e,sessionStorage.token,"mask","iPasswprd","passwordCont",u).then(function(e){sessionStorage.independentPass="true",1==R?(z(),U=!0):2==R&&($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/removeGoodWay","post",JSON.stringify({machineId:v.machineId}),sessionStorage.token,"mask","","").then(function(e){u.msg(e.message,{icon:1}),G(v.machineId)}).catch(function(e){u.msg(e.message,{icon:2})}))}).catch(function(e){console.log(e),u.msg(e.message,{icon:2})})}),$(".iPasswprd .cancelBtn").click(function(){popupHide("iPasswprd","passwordCont")}),$(".editAisle .cancelBtn").click(function(){popupHide("editAisle","editAisleBox")});var V=null,q={};r.on("row(goodsTable)",function(e){console.log(e),1==l?($('.editAisle input[name="goodsName"]').val(1==e.data.mail?"(邮寄)"+e.data.goods_Name:e.data.goods_Name),$('.editAisle input[name="goodsName"]').attr("IVal",e.data.goods_Id),$('.editAisle input[name="price"]').val(e.data.goods_Price),popupHide("goodsCont","goodsBox")):($('.addPanelBody input[name="panelGoodsName"]').val(1==e.data.mail?"(邮寄)"+e.data.goods_Name+"("+e.data.goods_Core+")":e.data.goods_Name+"("+e.data.goods_Core+")"),$('.addPanelBody input[name="panelGoodsName"]').attr("IVal",e.data.goods_Id),popupHide("goodsCont","goodsBox"))});var H=!1,U=!1;function E(){loadingAjax("/machine/findMachineIdUser","get",{machineId:v.machineId},sessionStorage.token).then(function(e){H=e.data}).catch(function(e){H=0,K()})}function K(){!1,$(".editAisle .aisleList input").prop("disabled",!0),$(".editAisle .aisleList select").prop("disabled",!0),p.render("select"),$(".editAisle .ediaisleBtn").hide(),$(".editAisle .maintenanceBtn").show()}function z(){!0,$(".editAisle .aisleList input").prop("disabled",!1),$(".editAisle .aisleList select").prop("disabled",!1),p.render("select"),$(".goodsName").prop("disabled",!0),$(".editAisle .ediaisleBtn").show(),$(".editAisle .maintenanceBtn").hide()}$(".editAisle .maintenanceBtn").click(function(){1==H?sessionStorage.independentPass?(z(),U=!0):popupShow("iPasswprd","passwordCont"):(K(),u.msg("您不是该设备管理员!",{icon:7}))}),$(".editAisle .ediaisleBtn").click(function(){if($('.editAisle input[name="goodsName"]').attr("IVal"))if($('.editAisle input[name="price"]').val())if($('.editAisle input[name="count"]').val()&&$('.editAisle input[name="total"]').val())if(Number($('.aisleList input[name="total"]').val())>=Number($('.aisleList input[name="count"]').val())){var e=JSON.stringify({machineId:v.machineId,way:V.way,goodId:Number(V.goods_Id?V.goods_Id:$('.editAisle input[name="goodsName"]').attr("IVal")),newGoodId:Number($('.editAisle input[name="goodsName"]').attr("IVal")),replenish:V.goods_Id?V.count:0,count:Number($('.editAisle input[name="count"]').val()),total:Number(V.goods_Id?V.total:0),newTotal:Number($('.editAisle input[name="total"]').val()),status:V.open,newStatus:Number($('.editAisle select[name="testSele"]').val()),price:V.goods_Id?V.price+"":"0",newPrice:$('.editAisle input[name="price"]').val()+""});e!=JSON.stringify(q)?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/updateGoodWay","post",e,sessionStorage.token,"mask","editAisle","editAisleBox",u).then(function(e){u.msg(e.message,{icon:1}),G(v.machineId),loadingAjax("/refreshGoods","post","",sessionStorage.token).then(function(e){}).catch(function(e){})}).catch(function(e){console.log(e),u.msg(e.message,{icon:2})})):popupHide("editAisle","editAisleBox")}else u.msg("货道容量不能小于当前数量",{icon:7});else u.msg("数量和容量为为必填",{icon:7});else u.msg("请输入在售价格",{icon:2});else u.msg("请选择商品",{icon:7})});var W=null;$(".aisleDetails").on("click",".addAisle",function(){W=$(this).attr("indexVal"),sessionStorage.independentPass?popupShow("addDetalis","addCont"):popupShow("iPasswprd","passwordCont")}),$(".addCancelBtn").click(function(){popupHide("addDetalis","addCont")}),$(".addDetalisBtn").click(function(){if(""!=$('.addDetalis input[name="addNum"]').val()&&$('.addDetalis input[name="addNum"]').val()>0){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var e=JSON.stringify({machineId:v.machineId,way:Number(W),count:Number($('.addDetalis input[name="addNum"]').val())});loadingAjax("/machine/insertGoodWay","post",e,sessionStorage.token,"mask","addDetalis","addCont",u).then(function(e){console.log(e),u.msg(e.message,{icon:1}),j(e),$('.addDetalis input[name="addNum"]').val(" ")}).catch(function(e){u.msg(e.message,{icon:2})})}else u.msg("数量必须大于0",{icon:7})});var Q=1;$('.addDetalis input[name="addNum"]').keyup(function(){var e=$(this).val();/^\d*$/.test(e)?(Q=$(this).val(),console.log(Q)):(u.msg("只能输入正整数",{icon:7}),$(this).val(Q))}),$(".testNumdev input").keyup(function(){var e=$(this).val();/^\d*$/.test(e)||(u.msg("只能输入正整数",{icon:7}),$(this).val(""))});var Y=[];$(".delBtn").click(function(){Y=[],1;var e=p.val("delDetalis");console.log(e),"{}"!=JSON.stringify(e)?u.confirm("确定删除？",function(n){for(var t in u.close(n),e)Y.push(Number(e[t]));sessionStorage.independentPass?(console.log(Y),function(e){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("api/machine/deleteGoodWay","post",e,sessionStorage.token,"mask","","",u).then(function(e){console.log(e),u.msg(e.message,{icon:1}),j(e)}).catch(function(e){u.msg(e.message,{icon:2})})}(JSON.stringify({machineId:v.machineId,ways:Y}))):popupShow("iPasswprd","passwordCont")}):u.msg("请选择需要删除的货道",{icon:7})});var X=null,Z=null,ee=null,ne=null;function te(e,n){var t=JSON.stringify({machineId:e});loadingAjax("/pay/getMachinePayParam","post",t,sessionStorage.token).then(function(e){loadingAjax("/pay/getPayParam","post",JSON.stringify({merchantId:Number(n)}),sessionStorage.token).then(function(n){var t="";e.data.forEach(function(e,a){var i=+e.id;1===i?Z=e.selectPay.length>0?e.selectPay[0].mpId:0:2===i?X=e.selectPay.length>0?e.selectPay[0].mpId:0:3===i?ee=e.selectPay.length>0?e.selectPay[0].mpId:0:4===i&&(ne=e.selectPay.length>0?e.selectPay[0].mpId:0),1==+e.status&&(t+='<div class="layui-form-item">\n                                        <label class="layui-form-label">'.concat(e.tName,'：</label>\n                                    <div class="layui-input-block">'),0==+e.selectPay.length?t+='<input type="radio" \nlay-filter="'.concat(3===i||4===i?"radioTest3":"radioTest",'" name="').concat(e.id,'" value="').concat("0-0",'" title="无" checked>'):t+='<input type="radio" \nlay-filter="'.concat(3===i||4===i?"radioTest3":"radioTest",'" name="').concat(e.id,'" value="').concat(e.selectPay[0].mpId+"-0",'" title="无" >'),n.data.forEach(function(n,a){i===+n.payType&&(console.log(e&&e.selectPay.length>0&&e.selectPay[0].paramId,n.id),t+='<input type="radio" lay-filter="'.concat(3===i||4===i?"radioTest3":"radioTest",'" \nname="').concat(e.id,'" \nvalue="').concat((e.selectPay.length>0?e.selectPay[0].mpId:0)+"-"+n.id,'" \ntitle="').concat(n.payee,'" ').concat(e.selectPay.length<=0?"":+e.selectPay[0].paramId==+n.id?"checked":""," >"))}),t+="</div>\n                        </div>")}),$("#setPayList").html(t),p.render("radio")}).catch(function(e){console.log(e),u.msg(e.message,{icon:2})})}).catch(function(e){u.msg(e.message,{icon:2})})}$(".paySet .paySetBtn").click(function(){var e=p.val("paySetData");console.log(e)}),p.on("radio(radioTest)",function(e){u.confirm("确定修改收款账户？(温馨提示：工行支付, 杉德支付不能与微信支付、支付宝支付共用)",function(n){u.close(n);var t=e.value.split("-"),a=JSON.stringify({machineId:v.machineId,paramId:+t[1],mpId:+t[0]});loadingAjax("/pay/updateMachinePayParam","post",a,sessionStorage.token).then(function(e){if(u.msg(e.message,{icon:1}),0!=+t[1]&&0!=+ee){var n=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+ee});loadingAjax("/pay/updateMachinePayParam","post",n,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}if(0!=+t[1]&&0!=+ne){var a=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+ne});loadingAjax("/pay/updateMachinePayParam","post",a,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}else te(v.machineId,v.userNum)}).catch(function(e){u.msg(e.message,{icon:2})})},function(){te(v.machineId,v.userNum)})}),p.on("radio(radioTest3)",function(e){console.log(ne),u.confirm("确定修改收款账户？(温馨提示：工行支付, 杉德支付不能与微信支付、支付宝支付共用)",function(n){u.close(n);var t=e.value.split("-"),a=JSON.stringify({machineId:v.machineId,paramId:+t[1],mpId:+t[0]});loadingAjax("/pay/updateMachinePayParam","post",a,sessionStorage.token).then(function(e){if(u.msg(e.message,{icon:1}),0!=+t[1]&&0!=+X){var n=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+X});loadingAjax("/pay/updateMachinePayParam","post",n,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}if(0!=+t[1]&&0!=+Z){var a=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+Z});loadingAjax("/pay/updateMachinePayParam","post",a,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}if(0!=+t[1]&&0!=+ne){var i=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+ne});loadingAjax("/pay/updateMachinePayParam","post",i,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}if(0!=+t[1]&&0!=+ee){var o=JSON.stringify({machineId:v.machineId,paramId:0,mpId:+ee});loadingAjax("/pay/updateMachinePayParam","post",o,sessionStorage.token).then(function(e){te(v.machineId,v.userNum)}).catch(function(e){})}else te(v.machineId,v.userNum)}).catch(function(e){u.msg(e.message,{icon:2})})},function(){te(v.machineId,v.userNum)})});var ae=!1;$(".uploadBtn input").change(function(e){if($(this).val()){var n=this,t=new FormData;t.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:m},data:t,success:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".ImgCont img").prop("src",e.data.src),$(".ImgCont").show()):u.msg(e.message,{icon:7})},error:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),u.msg("上传失败",{icon:2})}})}}),$(".delImgBtn").click(function(){$(".ImgCont img").prop("src",""),$(".ImgCont").hide()}),p.on("switch(machineOpen)",function(e){ae=e.elem.checked,e.elem.checked?$(".serviceTitle").slideDown():$(".serviceTitle").slideUp()});var ie=!1;p.on("switch(customOpen)",function(e){ie=e.elem.checked,e.elem.checked?$(".customTitle").slideDown():$(".customTitle").slideUp()}),$(".uploadBtn2 input").change(function(e){if($(this).val()){var n=this,t=new FormData;t.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:m},data:t,success:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?($(".customImgCont img").prop("src",e.data.src),$(".customImgCont").show()):u.msg(e.message,{icon:7})},error:function(e){$(n).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),u.msg("上传失败",{icon:2})}})}}),$(".delImgBtn2").click(function(){$(".customImgCont img").prop("src",""),$(".customImgCont").hide()});var oe=[];var se=null;var ce=getKeyTime().startTime,le=getKeyTime().endTime;g.render({elem:"#test8",range:!0,value:getKeyTime().keyTimeData,done:function(e,n,t){var a=e.split(" - ");ce=a[0],le=a[1]}}),$(".replenishment .RQueryBtn").click(function(){timeFlag(ce,le)?u.msg("时间选择范围最多三个月",{icon:7}):se.reload({where:{way:$('.replenishment select[name="shipSelect"]').val(),goods_Name:$('.replenishment input[name="replenishmentGoodName"]').val(),start_time:ce||null,end_time:le||null}})}),$(".replenishmentPushBtn").click(function(){if(timeFlag(ce,le))u.msg("时间选择范围最多三个月",{icon:7});else{var e="".concat(v.info,"(").concat(v.number,")补货记录(").concat(ce,"-").concat(le,").xls"),n="".concat(vApi,"/excelReplenish?startDate=").concat(ce,"&endDate=").concat(le,"&machineId=").concat(v.machineId,"&way=").concat($('.replenishment select[name="shipSelect"]').val(),"&goods_Name=").concat($('.replenishment input[name="replenishmentGoodName"]').val());exportExcel(n,e)}});var de=getKeyTime().startTime,re=getKeyTime().endTime;g.render({elem:"#test10",range:!0,value:getKeyTime().keyTimeData,done:function(e,n,t){var a=e.split(" - ");de=a[0],re=a[1]}});var me=null;$(".editQueryBtn").click(function(){timeFlag(de,re)?u.msg("时间选择范围最多三个月",{icon:7}):me.reload({where:{goods_Name:$('.price input[name="priceGoodName"]').val(),startDate:de||null,endDate:re||null}})}),$(".editPircePushBtn").click(function(){if(timeFlag(de,re))u.msg("时间选择范围最多三个月",{icon:7});else{var e=void 0!==$('.price input[name="priceGoodName"]').val()?$('.price input[name="priceGoodName"]').val():"",n="".concat(vApi,"/excelPriceRecord?startDate=").concat(de,"&endDate=").concat(re,"&machineId=").concat(v.machineId,"&goods_Name=").concat(e),t="".concat(v.info,"(").concat(v.number,")修改价格记录(").concat(de,"-").concat(re,").xls");exportExcel(n,t)}});var ue=null;var pe=getKeyTime().startTime,he=getKeyTime().endTime;g.render({elem:"#test9",range:!0,value:getKeyTime().keyTimeData,done:function(e,n,t){var a=e.split(" - ");pe=a[0],he=a[1]}}),$(".openDoorRecord .opeQuery").click(function(){timeFlag(pe,he)?u.msg("时间选择范围最多三个月",{icon:7}):ue.reload({where:{start_time:pe||null,end_time:he||null}})}),$(".openDoorPushBtn").click(function(){if(timeFlag(pe,he))u.msg("时间选择范围最多三个月",{icon:7});else{var e="".concat(v.info,"(").concat(v.number,")开门记录(").concat(pe,"-").concat(he,").xls"),n="".concat(vApi,"/excelDoorRecord?startDate=").concat(pe,"&endDate=").concat(he,"&machineId=").concat(v.machineId);exportExcel(n,e)}}),g.render({elem:"#test101"});var ge=null;$(".invoicePushBtn").click(function(){1==H?loadingAjax("/machine/getGoodReplenish","post",JSON.stringify({machineId:v.machineId}),sessionStorage.token,"","",u).then(function(e){0!=(ge=e.data).good_info.length?(!function(e){var n="";e.forEach(function(e,t){n+='<li class="detaillHeader">\n                        <div class="headerIndex1">\n                            <label for="">'.concat(t+1,'</label>\n                        </div>\n                        <div class="headerGoods">\n                            <label for="">').concat(e.goodName,'</label>\n                        </div>\n                        <div class="headerNum oldNums">\n                            \x3c!-- <label for="">原机货数</label> --\x3e\n                            <input type="number" name="oloNum" value="').concat(e.oldCount,'" disabled>\n                        </div>\n                        <div class="headerNum reNums">\n                            \x3c!-- <label for="">应补货数</label> --\x3e\n                            <input type="number" name="shouldName" value="').concat(e.replenish,'">\n                        </div>\n                        <div class="headerNum newNums">\n                            <input type="number" name="newNum" disabled value="').concat(e.newCount,'">\n                        </div>\n                        <div class="headerNum inNums">\n                            <input type="number" name="panelNam" value="').concat(e.showCount,'">\n                        </div>\n                        <div class="headerNum totalNums">\n                            <input type="number" name="totalNum" disabled value="').concat(e.replenish+e.showCount,'">\n                        </div>\n                     </li>')}),$(".detaillBody").html(n)}(ge.good_info),$(".supplierName").html(ge.supplier+"商品调拨(补货)单"),$('.repairInvoiceBody input[name="iMachineName"]').val("".concat(ge.info,"(").concat(ge.number,")")),$('.repairInvoiceBody input[name="supplier"]').val(ge.supplier),$('.repairInvoiceBody input[name="supplyName"]').val(ge.supplyName),$('.repairInvoiceBody input[name="supplyPhone"]').val(ge.supplyPhone),$('.repairInvoiceBody input[name="checkFlagName"]').val(ge.checkFlagName),$('.repairInvoiceBody input[name="acceptanceName"]').val(ge.acceptanceName),$('.repairInvoiceBody input[name="acceptancePhone"]').val(ge.acceptancePhone),$('.repairInvoiceBody input[name="wareManagement"]').val(ge.wareManagement),$('.repairInvoiceBody input[name="operator"]').val(ge.operator),$('.repairInvoiceBody input[name="consignee"]').val(ge.consignee),popupShow("repairInvoice","repairInvoiceBox")):u.msg("未查询到缺货商品",{icon:7})}).catch(function(e){u.msg(e.message,{icon:7})}):u.msg("您不是该设备管理员!",{icon:7})});var fe=1;$(".detaillBody").on("input",'input[name="shouldName"]',function(){if(!/^\d*$/.test($(this).val()))return u.msg("只能输入正整数",{icon:7}),void $(this).val(fe);fe=$(this).val(),$(this).parent().siblings(".newNums").children().val(Number(fe)+Number($(this).parent().siblings(".oldNums").children().val())),$(this).parent().siblings(".totalNums").children().val(Number(fe)+Number($(this).parent().siblings(".inNums").children().val()))});var ve=1;$(".detaillBody").on("input",'input[name="panelNam"]',function(){if(!/^\d*$/.test($(this).val()))return u.msg("只能输入正整数",{icon:7}),void $(this).val(ve);ve=$(this).val(),$(this).parent().siblings(".totalNums").children().val(Number(ve)+Number($(this).parent().siblings(".reNums").children().val()))}),$(".repairInvoiceFooter .ReBtn").click(function(){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");for(var e=[],n=0;n<ge.good_info.length;n++){var t={goodName:ge.good_info[n].goodName,newCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="newNum"]').val()),oldCount:ge.good_info[n].oldCount,replenish:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="shouldName"]').val()),showCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="panelNam"]').val()),totalCount:Number($(".detaillBody .detaillHeader").eq(n).find('input[name="totalNum"]').val()),id:n+1};e.push(t)}var a=JSON.stringify({machineName:$('.repairInvoiceBody input[name="iMachineName"]').val(),deliverTime:$("#test101").val(),supplier:$('.repairInvoiceBody input[name="supplier"]').val(),supplyName:$('.repairInvoiceBody input[name="supplyName"]').val(),supplyPhone:$('.repairInvoiceBody input[name="supplyPhone"]').val(),checkFlagName:$('.repairInvoiceBody input[name="checkFlagName"]').val(),acceptanceName:$('.repairInvoiceBody input[name="acceptanceName"]').val(),acceptancePhone:$('.repairInvoiceBody input[name="acceptancePhone"]').val(),wareManagement:$('.repairInvoiceBody input[name="wareManagement"]').val(),operator:$('.repairInvoiceBody input[name="operator"]').val(),consignee:$('.repairInvoiceBody input[name="consignee"]').val(),number:ge.number,good_info:e}),i=new XMLHttpRequest;i.open("POST","".concat(vApi,"/machine/exportGoodReplenish"),!0),i.setRequestHeader("token",sessionStorage.token),i.setRequestHeader("Content-Type","application/json;charset=utf-8"),i.responseType="blob",i.onload=function(e){if(200!=i.status)return $(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),void u.msg("服务器请求超时",{icon:2});$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon");var n=i.response,t="".concat(ge.supplier,"商品调拨（补货）单.xls"),a=document.createElement("a");a.download=t,a.style.display="none";var o=new Blob([n]);a.href=URL.createObjectURL(o),document.body.appendChild(a),a.click(),document.body.removeChild(a),popupHide("repairInvoice","repairInvoiceBox")},i.send(a)}),$(".rCancelBtn").click(function(){popupHide("repairInvoice","repairInvoiceBox")}),$(".clearingBtn").click(function(){1==H?u.confirm("确定清除货道故障？",function(e){u.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/clearLockMachineWay","post",JSON.stringify({machineId:v.machineId}),sessionStorage.token,"mask","","",u).then(function(e){u.msg(e.message,{icon:1}),G(v.machineId)}).catch(function(e){u.msg(e.message,{icon:2})})}):u.msg("您不是该设备管理员!",{icon:7})}),$(".pushMachineBtn").click(function(){var e="".concat(vApi,"/excelMachine?merchantId=").concat(sessionStorage.machineGoodsId),n="".concat(sessionStorage.machineName,"售货机列表.xls");exportExcel(e,n)});var $e=null;var ye=null;$(".addpanelBtn").click(function(){1==H?($(".relative1 input").removeClass("cursorDefault"),ye=1,$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",""),$('.addPanelCont input[name="panelGoodsName"]').val(""),$('.addPanelCont input[name="panelGoodsNum"]').val(""),$(".addPanelBox .playHeader span").html("添加展板商品"),popupShow("addPanelCont","addPanelBox")):u.msg("您不是该设备管理员!",{icon:7})}),$(".relative1").click(function(){2!=ye&&(popupShow("goodsCont","goodsBox"),F?F.reload({where:{condition:sessionStorage.machineGoodsId}}):M())}),$(".addPanelCont .panelAddBtn").click(function(){if($('.addPanelCont input[name="panelGoodsName"]').val()&&$('.addPanelCont input[name="panelGoodsNum"]').val()){var e=1==ye?"/machine/newDisplayGood":"/machine/updateDisplayGoodCount",n=JSON.stringify({machineId:v.machineId,goodId:Number($('.addPanelCont input[name="panelGoodsName"]').attr("IVal")),goodCount:Number($('.addPanelCont input[name="panelGoodsNum"]').val())});loadingAjax(e,"post",n,sessionStorage.token,"mask","addPanelCont","addPanelBox",u).then(function(e){u.msg(e.message,{icon:1}),$e.reload({where:{}}),$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",""),$('.addPanelCont input[name="panelGoodsName"]').val(""),$('.addPanelCont input[name="panelGoodsNum"]').val("")}).catch(function(e){u.msg(e.message,{icon:2})})}else u.msg("带*为必填",{icon:7})}),$(".addPanelCont .addPanelCance").click(function(){$(".relative1 input").removeClass("cursorDefault"),popupHide("addPanelCont","addPanelBox")}),r.on("tool(panelTable)",function(e){1==H?"del"==e.event?u.confirm("确定移除？",function(n){u.close(n),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var t=JSON.stringify({machineId:v.machineId,goodId:e.data.goodId});loadingAjax("/machine/removeDisplayGoodCount","post",t,sessionStorage.token,"mask","","",u).then(function(e){u.msg(e.message,{icon:1}),$e.reload({where:{}})}).catch(function(e){u.msg(e.message,{icon:2})})}):"edit"==e.event&&($(".relative1 input").addClass("cursorDefault"),ye=2,$('.addPanelCont input[name="panelGoodsName"]').attr("IVal",e.data.goodId),$('.addPanelCont input[name="panelGoodsName"]').val(e.data.good_name_core),$('.addPanelCont input[name="panelGoodsNum"]').val(e.data.goodCount),$(".addPanelBox .playHeader span").html("编辑展板商品"),popupShow("addPanelCont","addPanelBox")):u.msg("您不是该设备管理员!",{icon:7})}),$(".undoAisleBtn").click(function(){1==H?u.confirm("确定撤销货道?",function(e){u.close(e),R=2,sessionStorage.independentPass?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/machine/removeGoodWay","post",JSON.stringify({machineId:v.machineId}),sessionStorage.token,"mask","","").then(function(e){u.msg(e.message,{icon:1}),G(v.machineId)}).catch(function(e){u.msg(e.message,{icon:2})})):popupShow("iPasswprd","passwordCont")}):u.msg("您不是该设备管理员!",{icon:7})});$(".undoPushBtn").click(function(){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var e="".concat(v.info,"撤货记录.xls"),n="".concat(vApi,"/excelRemove?machineId=").concat(v.machineId);exportExcel(n,e)}),$(".goodsCont").on("mouseenter",".pic102",function(e){$("#pic101").attr("src",$(this).attr("src"));var n=new Image;n.onload=function(){$("#pic101").css({width:this.width>=this.height?"350px":"auto",height:this.height>this.width?"350px":"auto"}).fadeIn("fast"),this.onload=null},n.src=$(this).attr("src")}),$(".goodsCont").on("mouseleave",".pic102",function(){$("#pic101").hide()});var Ie=!0;$("body").on("mouseenter",".wayImg",function(e){$("#pic101").attr("src",$(this).attr("src"));var n=new Image;n.onload=function(){$("#pic101").css({width:this.width>=this.height?"200px":"auto",height:this.height>this.width?"200px":"auto"}).fadeIn("fast"),this.onload=null},n.src=$(this).attr("src")}),$(".wayImg").on("click",".",function(){event.stopPropagation(),Ie=!1}),$("body").on("mouseleave",".wayImg",function(){Ie&&$("#pic101").hide()}),$("#pic101").mouseenter(function(){$("#pic101").show()}),$("#pic101").mouseleave(function(){$("#pic101").hide()}),$("body").click(function(){$(".ListOperation").fadeOut(),y=null})})},598:function(e,n){}});