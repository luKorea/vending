/*! 版权所有，翻版必究 */!function(e){function t(t){for(var i,s,r=t[0],d=t[1],l=t[2],m=0,u=[];m<r.length;m++)s=r[m],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&u.push(n[s][0]),n[s]=0;for(i in d)Object.prototype.hasOwnProperty.call(d,i)&&(e[i]=d[i]);for(c&&c(t);u.length;)u.shift()();return o.push.apply(o,l||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],i=!0,r=1;r<a.length;r++){var d=a[r];0!==n[d]&&(i=!1)}i&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var i={},n={12:0},o=[];function s(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=i,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var r=window.webpackJsonp=window.webpackJsonp||[],d=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var c=d;o.push([262,0]),a()}({262:function(e,t,a){"use strict";a.r(t);a(651);layui.use(["laydate","table","layer","tree"],function(){tooltip(".refreshBtnList",{transition:!0,time:200});var e=window.parent.permissionsData1(),t=permissionsVal1({362:!1,371:!1,369:!1,387:!1},e);function a(){t[362]?$(".uploadBtn").removeClass("hide"):$(".uploadBtn").addClass("hide"),t[371]?$(".ListOperation .edit").removeClass("hide"):$(".ListOperation .edit").addClass("hide"),t[369]?$(".del-btn").removeClass("hide"):$(".del-btn").addClass("hide"),t[387]?$(".auditBtnTwo").removeClass("hide"):$(".auditBtnTwo").addClass("hide")}a();var i=sessionStorage.token,n=layui.layer,o=layui.form,s=layui.laydate,r=layui.tree,d=getKeyTime().startTime,l=getKeyTime().endTime;s.render({elem:"#test6",range:!0,value:getKeyTime().keyTimeData,done:function(e,t,a){console.log(e);var i=e.split(" - ");console.log(i),d=i[0],l=i[1]}});var c=layui.table,m=c.render({elem:"#moneyData",url:"".concat(vApi,"/advertising/selectAdvertising"),method:"post",contentType:"application/json",headers:{token:i},cols:[[{type:"checkbox"},{field:"img",width:120,title:"微缩图",templet:"#imgtmp",align:"center"},{field:"name",width:150,title:"素材名",align:"center"},{field:"size",width:100,title:"大小(MB)",align:"center"},{field:"advertisingAttribute",align:"center",width:150,title:"素材属性",templet:function(e){return 0==e.advertisingAttribute?"图片":"视频"}},{field:"advertisingType",align:"center",width:150,title:"素材类别",templet:function(e){return 0==e.advertisingType?"横屏":"竖屏"}},{field:"duration",width:100,title:"播放时长",align:"center"},{field:"checkStatus",align:"center",width:160,title:"审核状态",templet:function(e){return 0==e.checkStatus?"未审核":1==e.checkStatus?"待审核":2==e.checkStatus?"审核通过":"审核不通过"}},{field:"advertisingStatus",align:"center",width:160,title:"素材状态",templet:function(e){return"1"==e.advertisingStatus?"启用":"不启用"}},{field:"addUser",width:160,title:"创建人 ",align:"center"},{field:"creationTime",width:180,title:"创建时间",align:"center"},{field:"operation",right:0,width:150,title:"操作",toolbar:"#barDemo",align:"center",fixed:"right"}]],page:!0,id:"tableId",loading:!0,height:"full-200",request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:Number(sessionStorage.machineID),startTime:d,endTime:l},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data.list}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){a(),fixedFun(),403==e.code?window.parent.location.href="login.html":405==e.code&&$(".hangContent").show()}});$(".keyQueryBtn").click(function(){if(timeFlag(d,l))n.msg("时间选择范围最多三个月",{icon:7});else{var e=o.val("KeyValData");console.log(e),m.reload({where:{keyWord:e.name,attribute:e.attribute,type:e.type,checkStatus:e.checkStatus,minSize:e.minSize,maxSize:e.maxSize,status:e.advertisingStatus,startTime:d,endTime:l}})}}),$(".uploadBtn").click(function(){$(".uploadTitle").fadeIn(),$(".titleBox").removeClass("margin0")}),$(".titleHeader button").click(function(){$(".uploadTitle").fadeOut(),$(".titleBox").addClass("margin0")}),$(".issue").click(function(){popupHide("uploadTitle","titleBox"),popupShow("uploadMaterialCont","uploadMateriaBox")}),$(".uploadMateriaFooter .cancel-btn").click(function(){popupHide("uploadMaterialCont","uploadMateriaBox")}),$(".del-btn").click(function(){var e=c.checkStatus("tableId");console.log(e),console.log;var t=null;e.data.length>0?(t=e.data.map(function(e,t){return e.vid}),console.log(t),n.confirm("确定删除？",function(e){n.close(e),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),loadingAjax("/advertising/deleteAdvertising","post",JSON.stringify({list:t}),sessionStorage.token,"mask","","",n).then(function(e){n.msg(e.message,{icon:1}),m.reload({where:{}})}).catch(function(e){202==e.code?(n.msg(e.message,{icon:7}),m.reload({where:{}})):n.msg(e.message,{icon:7})})})):n.msg("请选择要删除的素材",{icon:7})}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".on-left").show()}),$(".on-left").click(function(){$(".left-mian").show(),$(".on-left").hide()});var u=null,g=null,p=null,f=null,h=null;function v(e,t,a,i,o,s,r,d,l){var c=JSON.stringify({vid:e,name:t,advertisingAttribute:a,advertisingStatus:i,advertisingType:o,duration:s,img:r,url:l,size:d});loadingAjax("/advertising/updateAdvertising","post",c,sessionStorage.token,"mask","editMaterialCont","uploadMateriaBox",n).then(function(e){m.reload({where:{}}),g=null,n.msg(e.message,{icon:1})}).catch(function(e){n.msg(e.message,{icon:2})})}c.on("tool(moneyData)",function(e){if(u=e.data,event.stopPropagation(),"operation"===e.event){if(h==e.data.vid)return $(".ListOperation").fadeOut(),void(h=null);h=e.data.vid,$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}}),$(".ListOperation .edit").click(function(){popupShow("editMaterialCont","uploadMateriaBox"),o.val("editValData",{materialName:u.name,materiaAttribute:u.advertisingAttribute,materiaType:u.advertisingType,materiaStatus:u.advertisingStatus}),"0"==u.checkStatus?($('.editCont select[name="materiaAttribute"]').prop("disabled",""),$('.editCont select[name="materiaType"]').prop("disabled",""),o.render(),$(".materiaDowEdit").show().children().show(),"0"==u.advertisingAttribute?($(".editImgBtn").show().siblings(".editVideoBtn").hide(),$(".materiaImgEdit img").attr("src",u.img).show().siblings().hide()):($(".editVideoBtn").show().siblings(".editImgBtn").hide(),$(".materiaImgEdit video").attr("src",u.img).show().siblings().hide())):($('.editCont select[name="materiaAttribute"]').prop("disabled",!0),$('.editCont select[name="materiaType"]').prop("disabled",!0),o.render(),$(".editImgBtn").hide(),$(".editVideoBtn").hide(),$(".materiaDowEdit").hide().children().hide(),$(".materiaImgEdit img").hide().siblings().hide())}),$(".ListOperation .Tpreview").click(function(){u.img.indexOf("mp4")>-1?$(".imgCont video").attr("src",u.img).show().siblings().hide():$(".imgCont img").attr("src",u.img).show().siblings().hide(),popupShow("materialPreview","previewBox")}),$(".submitAuditBtn").click(function(){var e=c.checkStatus("tableId");console.log(e);var t=[];e.data.length>0?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e.data.forEach(function(e,a){var i={id:e.vid,status:"1"};t.push(i),console.log(t)}),I("1",t,"/advertising/submitAdvertisingStatus")):n.msg("请选择需要提交审核的素材",{icon:7})}),$(".approvedBtn").click(function(){var e=c.checkStatus("tableId"),t=[];e.data.length>0?n.confirm("确定审核通过？",function(a){n.close(a),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e.data.forEach(function(e,a){var i={id:e.vid,status:"2"};t.push(i)}),I("0",t,"/advertising/checkAdvertisingStatus")}):n.msg("请选择需要通过审核的素材",{icon:7})}),$(".noPassBtn").click(function(){var e=c.checkStatus("tableId"),t=[];e.data.length>0?n.confirm("确定审核不通过？",function(a){n.close(a),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),e.data.forEach(function(e,a){var i={id:e.vid,status:"3"};t.push(i)}),I("0",t,"/advertising/checkAdvertisingStatus")}):n.msg("请选择需要不通过审核的素材",{icon:7})}),$(".editConfirmBtn").click(function(){var e=o.val("editValData");e.materialName?($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),"0"==u.checkStatus?loadingAjax("/advertising/findAdvertising","post",JSON.stringify({id:u.vid}),sessionStorage.token,"","","",n).then(function(t){"0"==t.data?(g=u.img,p=p?p.slice(0,4):u.size,g.indexOf("jpg")>1||g.indexOf("png")>1||g.indexOf("gif")>1&&"0"==e.materiaAttribute||g.indexOf("mp4")>1&&"1"==e.materiaAttribute?v(u.vid,e.materialName,e.materiaAttribute,e.materiaStatus,e.materiaType,f,g,p,u.url):n.msg("素材属性不正确",{icon:7})):n.confirm("检测到当前素材只能修改素材名和状态，是否继续修改？",function(t){v(u.vid,e.materialName,e.materiaAttribute,e.materiaStatus,e.materiaType,u.duration,u.img,u.size,u.url),n.close(t)})}).catch(function(e){n.msg(e.message,{icon:2})}):v(u.vid,e.materialName,e.materiaAttribute,e.materiaStatus,e.materiaType,u.duration,u.img,u.size,u.url)):n.msg("素材名不能空",{icon:7})}),o.on("select(EditSelect)",function(e){console.log(e.value),"0"==e.value?($(".editImgBtn").show().siblings(".editVideoBtn").hide(),$(".materiaImgEdit img").show().siblings().hide()):($(".editVideoBtn").show().siblings(".editImgBtn").hide(),$(".materiaImgEdit video").show().siblings().hide())}),$('.editImgBtn input[name="editImg"]').change(function(e){var t=this;p=e.target.files[0].size/1024/1024+"";var a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:i},data:a,success:function(e){console.log(e),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),0==e.code?(g=e.data.src,$(".materiaImgEdit img").attr("src",g),$(".materiaImgEdit video").attr("src",""),$(t).val()):403==e.code?window.parent.location.href="login.html":n.msg(e.message,{icon:2})},error:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("图片上传失败",{icon:2})}})}),$('.editVideoBtn input[name="editVideo"]').change(function(e){p=e.target.files[0].size/1024/1024+"";var t=this,a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:i},data:a,success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),0==e.code?(g=e.data.src,$(".materiaImgEdit video").attr("src",g),$(".materiaImgEdit img").attr("src",""),$("#EditVideo")[0].addEventListener("loadedmetadata",function(){f=parseInt(this.duration),console.log(f)}),$(t).val()):403==e.code?window.history.go(-1):n.msg(e.message)},error:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("视频上传失败",{icon:2})}})}),$(".editCancelBtn").click(function(){popupHide("editMaterialCont","uploadMateriaBox")}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()}),o.on("select(myAttribute)",function(e){"0"==e.value?($(".VideoBtn").hide(),$(".ImgBtn").fadeIn(),$(".materiaDow video").hide(),k||y?($(".materiaDow").show(),$(".materiaDow img").show()):$(".materiaDow").hide()):"1"==e.value?($(".ImgBtn").hide(),$(".VideoBtn").fadeIn(),$(".materiaDow img").hide(),k||y?($(".materiaDow").show(),$(".materiaDow video").show()):$(".materiaDow").hide()):($(".ImgBtn").fadeOut(),$(".VideoBtn").fadeOut(),$(".materiaDow").hide())});var k=null,w=null,y=null;$('.ImgBtn input[name="ImgFile"]').change(function(e){$(".materiaImg img").attr("src",""),base64(e.target.files[0],".materiaImg img"),$(".materiaImg video").hide(),$(".materiaDow").show(),$(".materiaDow img").show(),k=e.target.files[0],w=e.target.files[0].size/1024/1024+"",$(this).val("")});var b=null;function I(e,t,a){loadingAjax(a,"post",JSON.stringify({data:t,type:e}),sessionStorage.token,"mask","","",n).then(function(e){n.msg(e.message,{icon:1}),m.reload({where:{}})}).catch(function(e){202==e.code?(n.msg(e.message,{icon:7}),m.reload({where:{}})):n.msg(e.message,{icon:2})})}$('.VideoBtn input[name="videoFile"]').change(function(e){var t=$(this);$(".materiaImg video").attr("src",""),$(".materiaImg img").hide();var a=new FormData;a.append("file",e.target.files[0]),w=e.target.files[0].size/1024/1024+"",console.log(w),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),processData:!1,contentType:!1,headers:{token:i},data:a,success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),console.log(e),0==e.code?($(".materiaDow").show(),$(".materiaDow video").show(),$(".materiaImg video").attr("src",e.data.src),y=e.data.src,$("#video")[0].addEventListener("loadedmetadata",function(){b=parseInt(this.duration),console.log(b)}),t.val("")):n.msg(e.msg)},error:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("上传视频失败",{icon:2})}})}),$(".confirmBtn").click(function(){var e=o.val("uploadValData");if(console.log(e),e.materiaAttribute&&e.materiaType&&e.materialName)if(y||k){$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon");var t=new FormData;t.append("file",k),console.log(222),setTimeout(function(){"0"==e.materiaAttribute&&$.ajax({type:"post",url:"".concat(vApi,"/fileUpload"),async:!1,processData:!1,contentType:!1,headers:{token:i},data:t,success:function(e){if(console.log(e),0!=e.code)return n.msg(e.message),!1;y=e.data.src},error:function(e){return $(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),n.msg("上传图片失败",{icon:icon}),!1}});var a=JSON.stringify({advertisingAttribute:e.materiaAttribute,advertisingStatus:e.materiaStatus,advertisingType:e.materiaType,duration:b,img:y,name:e.materialName,size:w.slice(0,4),merchantId:sessionStorage.machineID});loadingAjax("/advertising/saveAdvertising","post",a,sessionStorage.token,"mask","uploadMaterialCont","uploadMateriaBox",n).then(function(e){m.reload({where:{}}),n.msg(e.message,{icon:1}),o.val("uploadValData",{materialName:"",materiaAttribute:"",materiaType:"",materiaStatus:""}),$(".uploadMaterialCont .materiaImg video").hide(),$(".uploadMaterialCont .materiaDow").hide(),$(".uploadMaterialCont .materiaDow img").hide(),$(".uploadMaterialCont .ImgBtn").hide(),$(".uploadMaterialCont .VideoBtn").hide(),y=null,k=null}).catch(function(e){n.msg(e.message,{icon:2})})},300)}else n.msg("请上传图片或视频",{icon:7});else n.msg("带*为必填",{icon:7})});var S=treeList();treeFun(r,"test1",m,S,"merchantId"),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".refreshBtn").click(function(){location.reload()}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(S)?(S=e,treeFun(r,"test1",m,S,"merchantId"),m.reload({where:{merchantId:Number(sessionStorage.machineID)}}),n.msg("已刷新",{icon:1})):n.msg("已刷新",{icon:1})});var C=!0;$(".data-list").on("mouseenter",".pic102",function(e){$("#pic101").attr("src",$(this).attr("src"));var t=new Image;t.onload=function(){$("#pic101").css({width:this.width>=this.height?"350px":"auto",height:this.height>this.width?"350px":"auto"}).fadeIn("fast"),this.onload=null},t.src=$(this).attr("src")}),$(".data-list").on("click",".pic102",function(){event.stopPropagation(),C=!1}),$(".data-list").on("mouseleave",".pic102",function(){C&&$("#pic101").hide()}),$("#pic101").click(function(){event.stopPropagation()}),$("body").click(function(){C=!0,$("#pic101").hide(),$(".ListOperation").fadeOut(),h=null}),$("#pic101").mouseenter(function(){$("#pic101").show()}),$("#pic101").mouseleave(function(){C&&$("#pic101").hide()})})},651:function(e,t){}});