/*! 版权所有，翻版必究 */!function(e){function a(a){for(var i,o,d=a[0],y=a[1],c=a[2],l=0,s=[];l<d.length;l++)o=d[l],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&s.push(n[o][0]),n[o]=0;for(i in y)Object.prototype.hasOwnProperty.call(y,i)&&(e[i]=y[i]);for(r&&r(a);s.length;)s.shift()();return p.push.apply(p,c||[]),t()}function t(){for(var e,a=0;a<p.length;a++){for(var t=p[a],i=!0,d=1;d<t.length;d++){var y=t[d];0!==n[y]&&(i=!1)}i&&(p.splice(a--,1),e=o(o.s=t[0]))}return e}var i={},n={30:0},p=[];function o(a){if(i[a])return i[a].exports;var t=i[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=e,o.c=i,o.d=function(e,a,t){o.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,a){if(1&a&&(e=o(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var i in e)o.d(t,i,function(a){return e[a]}.bind(null,i));return t},o.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(a,"a",a),a},o.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},o.p="";var d=window.webpackJsonp=window.webpackJsonp||[],y=d.push.bind(d);d.push=a,d=d.slice();for(var c=0;c<d.length;c++)a(d[c]);var r=y;p.push([268,0]),t()}({268:function(e,a,t){"use strict";t.r(a);t(661);layui.use(["table","form","layer","tree"],function(){tooltip(".refreshBtnList",{transition:!0,time:200});var e=layui.table,a=layui.layer,t=(a=layui.layer,layui.util,layui.tree),i=layui.form,n=null,p=e.render({elem:"#payList",url:"".concat(vApi,"/pay/getPayParam"),method:"post",contentType:"application/json",headers:{token:sessionStorage.token},cols:[[{field:"1",width:80,title:"",templet:"#imgtmp",event:"rank",align:"center"},{field:"rank",width:80,title:"排序",align:"center"},{field:"payName",width:180,title:"支付类型",align:"center"},{field:"app_id",width:300,title:"微信公众号id/支付宝商户id",align:"center"},{field:"merchantName",width:250,title:"所属商户",align:"center"},{field:"payee",width:280,title:"收款方",align:"center"},{field:"update_user",width:200,title:"最后修改人",align:"center"},{field:"update_time",width:250,title:"最后修改时间",align:"center",templet:function(e){return e.update_time?timeStamp(e.update_time):"-"}},{field:"operation",right:0,width:150,align:"center",title:"操作",toolbar:"#barDemo",fixed:"right"}]],id:"tablePayId",loading:!0,request:{pageName:"pageNum",limitName:"pageSize"},where:{merchantId:Number(sessionStorage.machineID)},parseData:function(e){return 200==e.code?{code:e.code,msg:e.message,count:e.data.total,data:e.data}:{code:e.code,msg:e.message}},response:{statusCode:200},done:function(e){n=e.data,fixedFun(),403==e.code&&(window.parent.location.href="login.html")}});$(".refreshBtn").click(function(){location.reload()}),$("body").bind("keydown",function(e){116==e.keyCode&&f5Fun()}),$(".playHeader .close").click(function(){$(this).parent().parent().addClass("margin0"),$(this).parents(".maskContnet").fadeOut()});var o=null,d=null;e.on("tool(payList)",function(e){if(event.stopPropagation(),o=e.data,"operation"===e.event){if(d==e.data.id)return $(".ListOperation").fadeOut(),void(d=null);d=e.data.id,$(".ListOperation").fadeIn(),$(".ListOperation").css({left:$(this).offset().left-35+"px",top:$(this).offset().top+35+"px"})}else if("rank"==e.event){if(1==e.data.rank)return;console.log(e),console.log(n);var t=JSON.stringify({merchantId:Number(y),topId:e.data.id,bottomId:n[e.data.rank-2].id});loadingAjax("/pay/sortPayParam","post",t,sessionStorage.token,"","","",a).then(function(e){a.msg("修改成功",{icon:1}),p.reload({where:{}})}).catch(function(e){console.log(res),a.msg("修改失败",{icon:1})})}}),$(".ListOperation .edit").click(function(){"微信"==o.payName?($(".changePay .WeChat").show(),$(".changePay .Alipay").hide(),$(".changePay .IcbcPay").hide(),s=o.cert_dir):"支付宝"==o.payName?($(".changePay .WeChat").hide(),$(".changePay .IcbcPay").hide(),$(".changePay .Alipay").show()):3==o.payType?($(".changePay .IcbcPay").show(),$(".changePay .WeChat").hide(),$(".changePay .Alipay").hide()):($(".changePay .WeChat").hide(),$(".changePay .Alipay").hide(),$(".changePay .IcbcPay").hide()),i.val("SetPay",{typeIndex:o.payType,payee:o.payee,officialId:"微信"==o.payName?o.app_id:"",MerchantsId:"微信"==o.payName?o.mchId:"",app_key:"微信"==o.payName?o.app_key:"",MerchantsKey:"微信"==o.payName?o.app_private_key:"",aliPayId:"支付宝"==o.payName?o.app_id:"",alipay_public_key:"支付宝"==o.payName?o.alipay_public_key:"",app_private_key:"支付宝"==o.payName?o.app_private_key:"",mchId:3==o.payType?o.mchId:"",app_id:3==o.payType?o.app_id:"",ICBC_app_key:3==o.payType?o.app_key:"",ICBC_alipay_public_key:3==o.payType?o.alipay_public_key:"",ICBC_app_private_key:3==o.payType?o.app_private_key:""}),popupShow("changePay","changeBox")}),$(".ListOperation .del").click(function(){a.confirm("确定删除？",function(e){a.close(e);var t=JSON.stringify({merchantId:Number(y),id:o.id});loadingAjax("/pay/deletePayParam","post",t,sessionStorage.token,"","","",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}})}).catch(function(e){a.msg(e.message,{icon:2})})})}),$(".changeBody .cancel_btn").click(function(){popupHide("changePay","changeBox")}),$(".changeBody .submit_btn").click(function(){var e=i.val("SetPay");if("2"==e.typeIndex){if(!(e.payee&&e.officialId&&e.MerchantsId&&e.app_key&&e.MerchantsKey))return void a.msg("带*为必填",{icon:7})}else if("1"==e.typeIndex){if(!(e.payee&&e.aliPayId&&e.alipay_public_key&&e.app_private_key))return void a.msg("带*为必填",{icon:7})}else if("3"==e.typeIndex){if(!(e.payee&&e.mchId&&e.app_id&&e.ICBC_app_key&&e.ICBC_alipay_public_key&&e.ICBC_app_private_key))return void a.msg("带*为必填",{icon:7})}else if(!e.payee||!e.aliPayId)return void a.msg("带*为必填",{icon:7});if($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2==e.typeIndex)var t=JSON.stringify({app_id:e.officialId,mchId:e.MerchantsId,app_key:e.app_key}),n="/pay/testWxPay";else if(1==e.typeIndex)t=JSON.stringify({app_id:e.aliPayId,app_private_key:e.app_private_key,alipay_public_key:e.alipay_public_key}),n="/pay/testAliPay";else if(3==e.typeIndex){var d=JSON.stringify({alipay_public_key:e.ICBC_alipay_public_key,mchId:e.mchId,app_id:e.app_id,app_key:e.ICBC_app_key,app_private_key:e.ICBC_app_private_key});return void loadingAjax("/pay/testICBCPay","post",d,sessionStorage.token,"mask","","",a).then(function(t){var n=JSON.stringify({merchantId:y,id:o.id,payee:e.payee,payType:e.typeIndex,alipay_public_key:e.ICBC_alipay_public_key,mchId:e.mchId,app_id:e.app_id,app_key:e.ICBC_app_key,app_private_key:e.ICBC_app_private_key});loadingAjax("/pay/updatePayParam","post",n,sessionStorage.token,"mask","changePay","changeBox",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}}),i.val("addPay",{typeIndex:"",payee:"",alipay_public_key:"",mchId:"",app_id:"",app_key:"",app_private_key:""})}).catch(function(e){a.msg(e.message,{icon:2})})}).catch(function(e){a.msg(e.message,{icon:2})})}loadingAjax(n,"post",t,sessionStorage.token,"mask","","",a).then(function(t){var n=JSON.stringify({merchantId:y,id:o.id,payee:e.payee,payType:e.typeIndex,app_id:"2"==e.typeIndex?e.officialId:e.aliPayId,app_key:"2"==e.typeIndex?e.app_key:"",mchId:"2"==e.typeIndex?e.MerchantsId:"",alipay_public_key:"1"==e.typeIndex?e.alipay_public_key:"",app_private_key:"1"==e.typeIndex?e.app_private_key:e.MerchantsKey,cert_dir:2==e.typeIndex?s:null});loadingAjax("/pay/updatePayParam","post",n,sessionStorage.token,"mask","changePay","changeBox",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}}),i.val("SetPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:""})}).catch(function(e){a.msg(e.message,{icon:2})})}).catch(function(e){a.msg(e.message,{icon:2})})});var y=sessionStorage.machineID,c=treeList();t.render({elem:"#test1",id:"treelist",showLine:!0,onlyIconControl:!0,data:c,spread:!0,text:{defaultNodeName:"无数据",none:"您没有权限，请联系管理员授权!"},click:function(e){console.log(e),p.reload({where:{merchantId:e.data.id}}),y=e.data.id;for(var a=$("#test1 .layui-tree-txt"),t=0;t<a.length;t++)a[t].innerHTML===e.data.title?a[t].style.color="#be954a":a[t].style.color="#555"}}),$(".sidebar i").click(function(){$(".left-mian").hide(),$(".onLeft").show()}),$(".onLeft").click(function(){$(".left-mian").show(),$(".onLeft").hide()});var r=JSON.stringify({status:1});loadingAjax("/pay/getAllPayType","post",r,sessionStorage.token).then(function(e){console.log(e);var a='<option value="">请选择</option>';e.data.forEach(function(e,t){1==e.status&&(a+='<option value="'.concat(e.id,'">').concat(e.name,"</option>"))}),$("#editTypeSelect").html(a),$("#addTypeSelect").html(a),i.render("select")}).catch(function(e){}),$(".addBtnClick").click(function(){popupShow("addePay","addBox")});i.on("select(addSelect)",function(e){console.log(e.value),1==e.value?($(".addePay .WeChat").hide(),$(".addePay .IcbcPay").hide(),$(".addePay .Alipay").show()):2==e.value?($(".addePay .WeChat").show(),$(".addePay .Alipay").hide(),$(".addePay .IcbcPay").hide()):3==e.value?($(".addePay .IcbcPay").show(),$(".addePay .WeChat").hide(),$(".addePay .Alipay").hide()):($(".addePay .IcbcPay").hide(),$(".addePay .WeChat").hide(),$(".addePay .Alipay").hide())}),$(".addePay .submit_btn").click(function(){var e=i.val("addPay");if("2"==e.typeIndex){if(!(e.payee&&e.officialId&&e.MerchantsId&&e.app_key&&e.MerchantsKey))return void a.msg("带*为必填",{icon:7});if(!l)return void a.msg("请上传微信证书",{icon:7})}else if("1"==e.typeIndex){if(!(e.payee&&e.aliPayId&&e.alipay_public_key&&e.app_private_key))return void a.msg("带*为必填",{icon:7})}else if("3"==e.typeIndex){if(!(e.payee&&e.mchId&&e.app_id&&e.ICBC_app_key&&e.ICBC_alipay_public_key&&e.ICBC_app_private_key))return void a.msg("带*为必填",{icon:7})}else if(!e.payee||!e.typeIndex)return void a.msg("带*为必填",{icon:7});if($(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),2!=e.typeIndex&&1!=e.typeIndex&&3!=e.typeIndex){var t=JSON.stringify({merchantId:y,payee:e.payee,payType:e.typeIndex});loadingAjax("/pay/newPayParam","post",t,sessionStorage.token,"mask","addePay","addBox",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}}),i.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:"",MerchantsKey:""})}).catch(function(e){console.log(e),a.msg(e.message,{icon:2})})}if(2==e.typeIndex)var n=JSON.stringify({app_id:e.officialId,mchId:e.MerchantsId,app_key:e.app_key}),o="/pay/testWxPay";else if(1==e.typeIndex)n=JSON.stringify({app_id:e.aliPayId,app_private_key:e.app_private_key,alipay_public_key:e.alipay_public_key}),o="/pay/testAliPay";else if(3==e.typeIndex){var d=JSON.stringify({alipay_public_key:e.ICBC_alipay_public_key,mchId:e.mchId,app_id:e.app_id,app_key:e.ICBC_app_key,app_private_key:e.ICBC_app_private_key});return void loadingAjax("/pay/testICBCPay","post",d,sessionStorage.token,"mask","","",a).then(function(t){var n=JSON.stringify({merchantId:y,payee:e.payee,payType:e.typeIndex,alipay_public_key:e.ICBC_alipay_public_key,mchId:e.mchId,app_id:e.app_id,app_key:e.ICBC_app_key,app_private_key:e.ICBC_app_private_key,cert_dir:2==e.typeIndex?l:null});loadingAjax("/pay/newPayParam","post",n,sessionStorage.token,"mask","addePay","addBox",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}}),i.val("addPay",{typeIndex:"",payee:"",ICBC_alipay_public_key:"",mchId:"",app_id:"",ICBC_app_key:"",ICBC_app_private_key:""}),$(".uploadFlag").html("未上传"),l=null}).catch(function(e){a.msg(e.message,{icon:2})})}).catch(function(e){a.msg(e.message,{icon:2})})}loadingAjax(o,"post",n,sessionStorage.token,"mask","","",a).then(function(t){var n=JSON.stringify({merchantId:y,payee:e.payee,payType:e.typeIndex,app_id:"2"==e.typeIndex?e.officialId:e.aliPayId,app_key:"2"==e.typeIndex?e.app_key:"",mchId:"2"==e.typeIndex?e.MerchantsId:"",alipay_public_key:"1"==e.typeIndex?e.alipay_public_key:"",app_private_key:"1"==e.typeIndex?e.app_private_key:e.MerchantsKey});loadingAjax("/pay/newPayParam","post",n,sessionStorage.token,"mask","addePay","addBox",a).then(function(e){a.msg(e.message,{icon:1}),p.reload({where:{}}),i.val("addPay",{typeIndex:"",payee:"",officialId:"",MerchantsId:"",app_key:"",aliPayId:"",alipay_public_key:"",app_private_key:"",MerchantsKey:""})}).catch(function(e){a.msg(e.message,{icon:2})})}).catch(function(e){a.msg(e.message,{icon:2})})}),$(".addePay .cancel_btn").click(function(){popupHide("addePay","addBox")}),$(".refreshBtnList").click(function(){var e=treeList();JSON.stringify(e)!=JSON.stringify(c)?(c=e,t.reload("treelist",{data:c}),p.reload({where:{merchantId:Number(sessionStorage.machineID)}})):a.msg("已刷新",{icon:1})});var l=null,s=null;function _(e,t,i){$.ajax({type:"post",url:"".concat(vApi,"/uploading"),processData:!1,contentType:!1,timeout:6e4,headers:{token:token},data:e,success:function(e){$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),$(i).val(""),0==e.code?(a.msg("上传成功",{icon:1}),1==t?(l=e.data.src,$(".uploadFlag").html("已上传")):2==t&&(s=e.data.src)):a.msg(e.message,{icon:7})},error:function(e){$(i).val(""),$(".mask").fadeOut(),$(".maskSpan").removeClass("maskIcon"),a.msg("上传失败",{icon:2})}})}$('.addBody .WeChat input[name="addUpload"]').change(function(e){if($(this).val()){var a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),_(a,1,this)}}),$('.changePay .WeChat input[name="addUpload"]').change(function(e){if($(this).val()){var a=new FormData;a.append("file",e.target.files[0]),$(".mask").fadeIn(),$(".maskSpan").addClass("maskIcon"),_(a,2,this)}}),$("body").click(function(){$(".ListOperation").fadeOut(),d=null})})},661:function(e,a){}});